<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>【GoWeb框架-Gin框架】路由、请求参数、响应、模板渲染、会话、中间件 | Miraclo</title><meta name="author" content="Miraclo"><meta name="copyright" content="Miraclo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="笔记引用：码神之路 https:&#x2F;&#x2F;www.mszlu.com  一、认识Gin框架 框架是一系列工具的集合，能让开发变的便捷。 学习框架的目的就是为了提供项目的开发效率，使我们更加专注业务，而不是和业务无关的底层代码。 1. go流行的web框架 如果学习过其他语言，可能知道Java用的比较多的是Spring框架，PHP用的比较多的是Laravel，python用的多的是Django，都在各自"><meta property="og:type" content="article"><meta property="og:title" content="【GoWeb框架-Gin框架】路由、请求参数、响应、模板渲染、会话、中间件"><meta property="og:url" content="http://unicorn-acc.github.io/posts/23688.html"><meta property="og:site_name" content="Miraclo"><meta property="og:description" content="笔记引用：码神之路 https:&#x2F;&#x2F;www.mszlu.com  一、认识Gin框架 框架是一系列工具的集合，能让开发变的便捷。 学习框架的目的就是为了提供项目的开发效率，使我们更加专注业务，而不是和业务无关的底层代码。 1. go流行的web框架 如果学习过其他语言，可能知道Java用的比较多的是Spring框架，PHP用的比较多的是Laravel，python用的多的是Django，都在各自"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://w.wallhaven.cc/full/zy/wallhaven-zyxvqy.jpg"><meta property="article:published_time" content="2023-03-28T12:35:22.000Z"><meta property="article:modified_time" content="2023-07-31T06:40:11.089Z"><meta property="article:author" content="Miraclo"><meta property="article:tag" content="Golang"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://w.wallhaven.cc/full/zy/wallhaven-zyxvqy.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://unicorn-acc.github.io/posts/23688"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:2e3},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:800,languages:{author:"作者: Miraclo",link:"链接: ",source:"来源: Miraclo",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"【GoWeb框架-Gin框架】路由、请求参数、响应、模板渲染、会话、中间件",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-07-31 06:40:11"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,a){0!==a&&(a=864e5*a,t={value:t,expiry:(new Date).getTime()+a},localStorage.setItem(e,JSON.stringify(t)))},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!((new Date).getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=o=>new Promise((t,e)=>{const a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};e=saveToLocal.get("theme"),"dark"===e?activateDarkMode():"light"===e&&activateLightMode(),e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/mouth.css"><link rel="stylesheet" href="/css/codecolor.css"><link rel="stylesheet" href="//s1.hdslb.com/bfs/static/jinkela/long/font/medium.css"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload='this.media="screen"'><meta name="generator" content="Hexo 6.0.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./img/avatar.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">157</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">40</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-film"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i><span></span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://w.wallhaven.cc/full/zy/wallhaven-zyxvqy.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Miraclo</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-film"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i><span></span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">【GoWeb框架-Gin框架】路由、请求参数、响应、模板渲染、会话、中间件</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2023-03-28T12:35:22.000Z" title="发表于 2023-03-28 12:35:22">2023-03-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Golang/">Golang</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Golang/Golang%E6%A1%86%E6%9E%B6/">Golang框架</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>27分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="【GoWeb框架-Gin框架】路由、请求参数、响应、模板渲染、会话、中间件"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote><p>笔记引用：码神之路 <a target="_blank" rel="noopener" href="https://www.mszlu.com">https://www.mszlu.com</a></p></blockquote><h1 id="一认识gin框架">一、认识Gin框架</h1><p>框架是一系列工具的集合，能让开发变的便捷。</p><p>学习框架的目的就是为了提供项目的开发效率，使我们更加专注业务，而不是和业务无关的底层代码。</p><h2 id="go流行的web框架">1. go流行的web框架</h2><p>如果学习过其他语言，可能知道Java用的比较多的是Spring框架，PHP用的比较多的是Laravel，python用的多的是Django，都在各自的语言中具有强大的统治力。</p><p><code>go</code>从诞生之初就带有浓重的开源属性，其原生库已经很强大，即使不依赖框架，也能进行高性能开发，又因为其语言并没有一定的设计标准，所以较为灵活，也就诞生了众多的框架，各具有特色，满足不同的喜好。</p><h3 id="gin的github地址">Gin的Github地址</h3><p>1.1 Gin</p><p>地址：<a target="_blank" rel="noopener" href="https://github.com/gin-gonic/gin">https://github.com/gin-gonic/gin</a></p><p>号称最快的go语言web框架，目前是go官方的推荐框架（https://go.dev/doc/tutorial/）</p><p>1.2 iris</p><p>地址：<a target="_blank" rel="noopener" href="https://github.com/kataras/iris">https://github.com/kataras/iris</a></p><p>性能比gin高一些，支持MVC，但这款框架评价不太好，使用上问题较多，近些年很少去选择使用</p><p>1.3 Beego</p><p>地址：<a target="_blank" rel="noopener" href="https://github.com/beego/beego">https://github.com/beego/beego</a></p><p>国人开发，最早的go web框架之一，工具集比较完善，性能较差，据传言作者是php转行，所以框架带有浓厚的php特色，早期国内使用的多，目前少有人选择</p><p>1.4 fiber</p><p>地址：<a target="_blank" rel="noopener" href="https://github.com/gofiber/fiber">https://github.com/gofiber/fiber</a></p><p>2020年发布的框架，发展迅速，建立在fasthttp之上，性能目前最高，受Express启发，比较简洁，上手较快，和gin类似。</p><blockquote><p>当然还有其他一些框架，但从star数上，以及流行程度上看，gin一骑绝尘，gin的好处在于其简洁，扩展性，稳定性以及性能都比较出色。</p></blockquote><p><strong>go的框架其实是可以理解为库，并不是用了某一个框架就不能用别的框架，可以选择性的使用各个库中的优秀组件，进行组合</strong></p><h2 id="gin介绍">2. gin介绍</h2><p>特性：</p><p><strong>快速</strong></p><p>基于 Radix 树的路由，小内存占用。没有反射。可预测的 API 性能。</p><p><strong>支持中间件</strong></p><p>传入的 HTTP 请求可以由一系列中间件和最终操作来处理。 例如：Logger，Authorization，GZIP，最终操作 DB。</p><p><strong>Crash 处理</strong></p><p>Gin 可以 catch 一个发生在 HTTP 请求中的 panic 并 recover 它。这样，你的服务器将始终可用。例如，你可以向 Sentry 报告这个 panic！</p><p><strong>JSON 验证</strong></p><p>Gin 可以解析并验证请求的 JSON，例如检查所需值的存在。</p><p><strong>路由组</strong></p><p>更好地组织路由。是否需要授权，不同的 API 版本…… 此外，这些组可以无限制地嵌套而不会降低性能。</p><p><strong>错误管理</strong></p><p>Gin 提供了一种方便的方法来收集 HTTP 请求期间发生的所有错误。最终，中间件可以将它们写入日志文件，数据库并通过网络发送。</p><p><strong>内置渲染</strong></p><p>Gin 为 JSON，XML 和 HTML 渲染提供了易于使用的 API。</p><p><strong>可扩展性</strong></p><p>新建一个中间件非常简单。</p><h2 id="快速入门">3. 快速入门</h2><p>go版本需求：go1.13及以上</p><p>环境：windows 11</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 初始化一个目录</span><br>D:\<span class="hljs-keyword">go</span>\project&gt;mkdir ginlearn<br>D:\<span class="hljs-keyword">go</span>\project&gt;cd ginlearn<br><span class="hljs-comment">// 1. 这是目录是工作区，初始化工作区 go work init</span><br>D:\<span class="hljs-keyword">go</span>\project\ginlearn&gt;<span class="hljs-keyword">go</span> work init<br><span class="hljs-comment">// 2. 创建对应模块，比如这边创建helloworld模块</span><br>D:\<span class="hljs-keyword">go</span>\project\ginlearn&gt;mkdir helloworld<br>D:\<span class="hljs-keyword">go</span>\project\ginlearn&gt;cd helloworld<br><span class="hljs-comment">// 3. 模块初始化 go mod init name (name要求：example.com/m)</span><br>D:\<span class="hljs-keyword">go</span>\project\ginlearn\helloworld&gt;<span class="hljs-keyword">go</span> mod init test.com/helloworld<br><span class="hljs-keyword">go</span>: creating <span class="hljs-built_in">new</span> <span class="hljs-keyword">go</span>.mod: module test.com/helloworld<br>D:\<span class="hljs-keyword">go</span>\project\ginlearn\helloworld&gt;cd ..<br><span class="hljs-comment">// 4. 在工作区目录将helloworld模块加入到工作区里</span><br>D:\<span class="hljs-keyword">go</span>\project\ginlearn&gt;<span class="hljs-keyword">go</span> work use ./helloworld<br></code></pre></td></tr></table></figure><p>使用goland（vscode）打开</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Unicorn-acc/blogimgs/imgs04/image-20230327163110766.png"></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">PS D:\<span class="hljs-keyword">go</span>\project\ginlearn&gt; cd .\helloworld\<br>#下载并安装gin<br>PS D:\<span class="hljs-keyword">go</span>\project\ginlearn\helloworld&gt; <span class="hljs-keyword">go</span> get -u github.com/gin-gonic/gin<br></code></pre></td></tr></table></figure><p>示例程序：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>	<span class="hljs-string">&quot;log&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	r := gin.Default()<br>	<span class="hljs-comment">//curl http://localhost:8080/hello Get</span><br>	<span class="hljs-comment">// 期望返回json：&#123;&quot;name&quot;:&quot;hello world,Gin&quot;&#125;</span><br>	r.GET(<span class="hljs-string">&quot;/hello&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		<span class="hljs-comment">// 可以返回：数组 map list 结构体</span><br>		<span class="hljs-comment">// gin.H:  type H map[string]any</span><br>		ctx.JSON(<span class="hljs-number">200</span>, gin.H&#123;<br>			<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;hello world,Gin&quot;</span>,<br>		&#125;)<br>	&#125;)<br>	err := r.Run(<span class="hljs-string">&quot;:8080&quot;</span>) <span class="hljs-comment">// 监听并在 0.0.0.0:8080 上启动服务</span><br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;       <span class="hljs-comment">//  r.Run可以不用err接收</span><br>		log.Fatalln(err)<br>	&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>运行后，postman进行测试</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Unicorn-acc/blogimgs/imgs04/image-20230327164202000.png" style="zoom:67%"></p><p><strong>简单的代码就实现了一个http的服务</strong></p><hr><h1 id="二路由">二、路由</h1><p>路由是URI到函数的映射。</p><p>一个URI含: <code>http://localhost:8080/user/find?id=11</code></p><ul><li>协议，比如http，https等</li><li>ip端口或者域名，比如127.0.0.1:8080或者<code>www.test.com</code></li><li>path，比如 /path</li><li>query，比如 ?query</li></ul><p>同时访问的时候，还需要指明HTTP METHOD，比如</p><ul><li>GET：GET方法请求一个指定资源的表示形式. 使用GET的请求应该只被用于获取数据.</li><li>POST：POST方法用于将实体提交到指定的资源，通常会导致在服务器上的状态变化</li><li>HEAD：HEAD方法请求一个与GET请求的响应相同的响应，但没有响应体.</li><li>PUT：PUT方法用请求有效载荷替换目标资源的所有当前表示</li><li>DELETE：DELETE方法删除指定的资源</li><li>CONNECT：CONNECT方法建立一个到由目标资源标识的服务器的隧道。</li><li>OPTIONS：OPTIONS方法用于描述目标资源的通信选项。</li><li>TRACE：TRACE方法沿着到目标资源的路径执行一个消息环回测试。</li><li>PATCH：PATCH方法用于对资源应用部分修改。</li></ul><blockquote><p>使用的时候，应该尽量遵循其语义</p></blockquote><h2 id="restful-api规范">1. RESTful API规范</h2><p>RESTful API 的规范建议我们使用特定的HTTP方法来对服务器上的资源进行操作。</p><p>比如：</p><ol type="1"><li>GET，表示读取服务器上的资源</li><li>POST，表示在服务器上创建资源</li><li>PUT,表示更新或者替换服务器上的资源</li><li>DELETE，表示删除服务器上的资源</li><li>PATCH，表示更新/修改资源的一部分</li></ol><h2 id="请求方法">2. 请求方法</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/get&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>    ctx.JSON(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;get&quot;</span>)<br>&#125;)<br>r.POST(<span class="hljs-string">&quot;/post&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>    ctx.JSON(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;post&quot;</span>)<br>&#125;)<br>r.DELETE(<span class="hljs-string">&quot;/delete&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>    ctx.JSON(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;delete&quot;</span>)<br>&#125;)<br>r.PUT(<span class="hljs-string">&quot;/put&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>    ctx.JSON(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;put&quot;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><p>如果想要支持所有：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">r.Any(<span class="hljs-string">&quot;/any&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>    ctx.JSON(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;any&quot;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><p>如果想要支持其中的几种：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/hello&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>    <span class="hljs-comment">//数组 map list 结构体</span><br>    ctx.JSON(<span class="hljs-number">200</span>, gin.H&#123;<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;hello world&quot;</span>,<br>    &#125;)<br>&#125;)<br>r.POST(<span class="hljs-string">&quot;/hello&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>    <span class="hljs-comment">//数组 map list 结构体</span><br>    ctx.JSON(<span class="hljs-number">200</span>, gin.H&#123;<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;hello world&quot;</span>,<br>    &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="uri">3. URI</h2><p>URI书写的时候，我们不需要关心scheme和authority这两部分，我们主要通过path和query两部分的书写来进行资源的定位。</p><ul><li><strong>静态url</strong>，比如<code>/hello</code>，<code>/user/find</code></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">r.POST(<span class="hljs-string">&quot;/user/find&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>	&#125;)<br></code></pre></td></tr></table></figure><ul><li><strong>路径参数</strong>，比如<code>/user/find/:id</code></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">r.POST(<span class="hljs-string">&quot;/user/find/:id&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		param := ctx.Param(<span class="hljs-string">&quot;id&quot;</span>)<br>		ctx.JSON(<span class="hljs-number">200</span>, param)<br>	&#125;)<br></code></pre></td></tr></table></figure><p><strong>模糊匹配</strong>，比如<code>/user/*path</code></p><ul><li>path作为路径参数，匹配后面所有路径（例如：<code>/user/find/111</code>，返回<code>/find/111</code>）</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">r.POST(<span class="hljs-string">&quot;/user/*path&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		param := ctx.Param(<span class="hljs-string">&quot;path&quot;</span>)<br>		ctx.JSON(<span class="hljs-number">200</span>, param)<br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="处理函数">4. 处理函数</h2><p>定义：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> HandlerFunc <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(*Context)</span></span><br></code></pre></td></tr></table></figure><p>通过上下文的参数，获取http的请求参数，响应http请求等。</p><p>举例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/hello&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>    ctx.JSON(<span class="hljs-number">200</span>, gin.H&#123;<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;hello world,Gin&quot;</span>,<br>    &#125;)<br>&#125;)<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">	这里的func(ctx *gin.Context)&#123;&#125;方法体就是处理请求的函数</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h2 id="分组路由-r.group">5. 分组路由 r.Group</h2><p>在进行开发的时候，我们往往要进行模块的划分，比如用户模块，以user开发，商品模块，以goods开头。</p><p>或者进行多版本开发，不同版本之间路径是一致的，这种时候，就可以用到分组路由了。</p><p>比如</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go">ug := r.Group(<span class="hljs-string">&quot;/user&quot;</span>)<br>&#123;<br>    ug.GET(<span class="hljs-string">&quot;find&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.JSON(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;user find&quot;</span>)<br>    &#125;)<br>    ug.POST(<span class="hljs-string">&quot;save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.JSON(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;user save&quot;</span>)<br>    &#125;)<br>&#125;<br>gg := r.Group(<span class="hljs-string">&quot;/goods&quot;</span>)<br>&#123;<br>    gg.GET(<span class="hljs-string">&quot;find&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.JSON(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;goods find&quot;</span>)<br>    &#125;)<br>    gg.POST(<span class="hljs-string">&quot;save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.JSON(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;goods save&quot;</span>)<br>    &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="三请求参数-ctx-gin.context">三、请求参数 (ctx *gin.Context)</h1><h2 id="get请求参数">1. Get请求参数</h2><p>使用Get请求传参时，类似于这样 <code>http://localhost:8080/user/save?id=11&amp;name=zhangsan</code>。</p><p>如何获取呢？</p><h3 id="普通参数-ctx.query">1.1 普通参数 ctx.Query</h3><p>request url: <code>http://localhost:8080/user/save?id=11&amp;name=zhangsan</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>    id := ctx.Query(<span class="hljs-string">&quot;id&quot;</span>)<br>    name := ctx.Query(<span class="hljs-string">&quot;name&quot;</span>)<br>    ctx.JSON(<span class="hljs-number">200</span>, gin.H&#123;<br>        <span class="hljs-string">&quot;id&quot;</span>:   id,<br>        <span class="hljs-string">&quot;name&quot;</span>: name,<br>    &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><p>如果参数不存在，就给一个默认值：<code>ctx.DefaultQuery("address", "北京")</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		id := ctx.Query(<span class="hljs-string">&quot;id&quot;</span>)<br>		name := ctx.Query(<span class="hljs-string">&quot;name&quot;</span>)<br>		address := ctx.DefaultQuery(<span class="hljs-string">&quot;address&quot;</span>, <span class="hljs-string">&quot;北京&quot;</span>)<br>		ctx.JSON(<span class="hljs-number">200</span>, gin.H&#123;<br>			<span class="hljs-string">&quot;id&quot;</span>:      id,<br>			<span class="hljs-string">&quot;name&quot;</span>:    name,<br>			<span class="hljs-string">&quot;address&quot;</span>: address,<br>		&#125;)<br>	&#125;)<br></code></pre></td></tr></table></figure><p>判断参数是否存在：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		id, ok := ctx.GetQuery(<span class="hljs-string">&quot;id&quot;</span>)<br>		address, aok := ctx.GetQuery(<span class="hljs-string">&quot;address&quot;</span>)<br>		ctx.JSON(<span class="hljs-number">200</span>, gin.H&#123;<br>			<span class="hljs-string">&quot;id&quot;</span>:      id,<br>			<span class="hljs-string">&quot;idok&quot;</span>:    ok,<br>			<span class="hljs-string">&quot;address&quot;</span>: address,<br>			<span class="hljs-string">&quot;aok&quot;</span>:     aok,<br>		&#125;)<br>	&#125;)<br></code></pre></td></tr></table></figure><p>id是数值类型，上述获取的都是string类型，<strong>根据类型获取</strong>：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>	Id   <span class="hljs-type">int64</span>  <span class="hljs-string">`form:&quot;id&quot;`</span> <span class="hljs-comment">// 请求参数需要和字段绑定，用tag来表示这个字段绑定哪个请求参数</span><br>	Name <span class="hljs-type">string</span> <span class="hljs-string">`form:&quot;name&quot;`</span><br>&#125;<br>r.GET(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		<span class="hljs-keyword">var</span> user User<br>		err := ctx.BindQuery(&amp;user)<br>		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>			log.Println(err)<br>		&#125;<br>		ctx.JSON(<span class="hljs-number">200</span>, user)<br>&#125;)<br></code></pre></td></tr></table></figure><p>也可以：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		<span class="hljs-keyword">var</span> user User<br>		err := ctx.ShouldBindQuery(&amp;user)<br>		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>			log.Println(err)<br>		&#125;<br>		ctx.JSON(<span class="hljs-number">200</span>, user)<br>	&#125;)<br></code></pre></td></tr></table></figure><p>区别：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>	Id      <span class="hljs-type">int64</span>  <span class="hljs-string">`form:&quot;id&quot;`</span><br>	Name    <span class="hljs-type">string</span> <span class="hljs-string">`form:&quot;name&quot;`</span><br>	Address <span class="hljs-type">string</span> <span class="hljs-string">`form:&quot;address&quot; binding:&quot;required&quot;`</span><br>&#125;<br></code></pre></td></tr></table></figure><p>当bind是必须的时候，ShouldBindQuery会报错，开发者自行处理，状态码不变。</p><p>BindQuery则报错的同时，会将状态码改为400。所以一般建议是使用Should开头的bind。</p><h3 id="数组参数-queryarray">1.2 数组参数 QueryArray</h3><p>请求url：<code>http://localhost:8080/user/save?address=Beijing&amp;address=shanghai</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		address := ctx.QueryArray(<span class="hljs-string">&quot;address&quot;</span>)<br>		ctx.JSON(<span class="hljs-number">200</span>, address)<br>	&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		address, ok := ctx.GetQueryArray(<span class="hljs-string">&quot;address&quot;</span>)<br>		fmt.Println(ok)<br>		ctx.JSON(<span class="hljs-number">200</span>, address)<br>	&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		<span class="hljs-keyword">var</span> user User<br>		ctx.ShouldBindQuery(&amp;user)<br>		ctx.JSON(<span class="hljs-number">200</span>, user)<br>	&#125;)<br><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>	Id      <span class="hljs-type">int64</span>    <span class="hljs-string">`form:&quot;id&quot;`</span><br>	Name    <span class="hljs-type">string</span>   <span class="hljs-string">`form:&quot;name&quot;`</span><br>	Address []<span class="hljs-type">string</span> <span class="hljs-string">`form:&quot;address&quot; binding:&quot;required&quot;`</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="map参数-querymap">1.3 map参数 QueryMap</h3><p>请求url：<code>http://localhost:8080/user/save?addressMap[home]=Beijing&amp;addressMap[company]=shanghai</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		addressMap := ctx.QueryMap(<span class="hljs-string">&quot;addressMap&quot;</span>)<br>		ctx.JSON(<span class="hljs-number">200</span>, addressMap)<br>	&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		addressMap, _ := ctx.GetQueryMap(<span class="hljs-string">&quot;addressMap&quot;</span>)<br>		ctx.JSON(<span class="hljs-number">200</span>, addressMap)<br>	&#125;)<br></code></pre></td></tr></table></figure><p><strong>map参数 bind并没有支持</strong></p><h2 id="post请求参数">2. Post请求参数</h2><p>post请求一般是表单参数和json参数</p><h3 id="表单参数-ctx.postform">2.1 表单参数 ctx.PostForm</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Unicorn-acc/blogimgs/imgs04/image-20221121163103752.9bd84f58.png"></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go">r.POST(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		id := ctx.PostForm(<span class="hljs-string">&quot;id&quot;</span>)<br>		name := ctx.PostForm(<span class="hljs-string">&quot;name&quot;</span>)<br>		address := ctx.PostFormArray(<span class="hljs-string">&quot;address&quot;</span>)<br>		addressMap := ctx.PostFormMap(<span class="hljs-string">&quot;addressMap&quot;</span>)<br>		ctx.JSON(<span class="hljs-number">200</span>, gin.H&#123;<br>			<span class="hljs-string">&quot;id&quot;</span>:         id,<br>			<span class="hljs-string">&quot;name&quot;</span>:       name,<br>			<span class="hljs-string">&quot;address&quot;</span>:    address,<br>			<span class="hljs-string">&quot;addressMap&quot;</span>: addressMap,<br>		&#125;)<br>	&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go">r.POST(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		<span class="hljs-keyword">var</span> user User<br>		err := ctx.ShouldBind(&amp;user)<br>		<span class="hljs-comment">// 注意这种情况下bind还是不支持map参数，需要手动GetPostFormMap然后赋值</span><br>		addressMap, _ := ctx.GetPostFormMap(<span class="hljs-string">&quot;addressMap&quot;</span>)<br>		user.AddressMap = addressMap<br>		fmt.Println(err)<br>		ctx.JSON(<span class="hljs-number">200</span>, user)<br>	&#125;)<br><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>	Id         <span class="hljs-type">int64</span>             <span class="hljs-string">`form:&quot;id&quot;`</span><br>	Name       <span class="hljs-type">string</span>            <span class="hljs-string">`form:&quot;name&quot;`</span><br>	Address    []<span class="hljs-type">string</span>          <span class="hljs-string">`form:&quot;address&quot; binding:&quot;required&quot;`</span><br>	AddressMap <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span> <span class="hljs-string">`form:addressMap`</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="json参数">2.2 json参数</h3><p>postman请求参数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&#123;<br>    &quot;id&quot;:1111,<br>    &quot;name&quot;:&quot;zhangsan&quot;,<br>    &quot;address&quot;: [<br>        &quot;beijing&quot;,<br>        &quot;shanghai&quot;<br>    ],<br>    &quot;addressMap&quot;:&#123;<br>        &quot;home&quot;:&quot;beijing&quot;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>这种情况下bind支持map参数</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go">r.POST(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		<span class="hljs-keyword">var</span> user User<br>		err := ctx.ShouldBindJSON(&amp;user)<br>		fmt.Println(err)<br>		ctx.JSON(<span class="hljs-number">200</span>, user)<br>	&#125;)<br><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>	Id         <span class="hljs-type">int64</span>             <span class="hljs-string">`form:&quot;id&quot;`</span><br>	Name       <span class="hljs-type">string</span>            <span class="hljs-string">`form:&quot;name&quot;`</span><br>	Address    []<span class="hljs-type">string</span>          <span class="hljs-string">`form:&quot;address&quot; binding:&quot;required&quot;`</span><br>	AddressMap <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span> <span class="hljs-string">`form:addressMap`</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="路径参数restful风格">3. 路径参数（RESTful风格）</h2><p>请求url：<code>http://localhost:8080/user/save/111</code></p><p>① <code>ctx.Param()</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">r.POST(<span class="hljs-string">&quot;/user/save/:id&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		ctx.JSON(<span class="hljs-number">200</span>, ctx.Param(<span class="hljs-string">&quot;id&quot;</span>))<br>	&#125;)<br></code></pre></td></tr></table></figure><p>② <code>ctx.ShouldBindUri()</code>：结构体需要加入uri的tag</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go">r.POST(<span class="hljs-string">&quot;/user/save/:id/:name&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		<span class="hljs-keyword">var</span> user User<br>		ctx.ShouldBindUri(&amp;user)<br>		ctx.JSON(<span class="hljs-number">200</span>, user)<br>	&#125;)<br><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>	Id   <span class="hljs-type">int64</span>  <span class="hljs-string">`json:&quot;id&quot; uri:&quot;id&quot;`</span><br>	Name <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;name&quot; uri:&quot;name&quot;`</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="文件参数-multipartform">4. 文件参数 MultipartForm</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go">r.POST(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>    <span class="hljs-comment">//</span><br>    form, err := ctx.MultipartForm()<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Println(err)<br>    &#125;<br>    files := form.File <span class="hljs-comment">// 可能会有多个文件，要用for循环遍历</span><br>    <span class="hljs-keyword">for</span> _, fileArray := <span class="hljs-keyword">range</span> files &#123;<br>        <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> fileArray &#123;<br>            ctx.SaveUploadedFile(v, <span class="hljs-string">&quot;./&quot;</span>+v.Filename)<br>        &#125;<br><br>    &#125;<br>    ctx.JSON(<span class="hljs-number">200</span>, form.Value)<br>&#125;)<br></code></pre></td></tr></table></figure><h1 id="四响应">四、响应</h1><h2 id="字符串方式-ctx.string">1. 字符串方式 ctx.String</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		ctx.String(http.StatusOK, <span class="hljs-string">&quot;this is a %s&quot;</span>, <span class="hljs-string">&quot;ms string response&quot;</span>)<br>	&#125;)<br></code></pre></td></tr></table></figure><h2 id="json方式-ctx.json">2. JSON方式 ctx.JSON</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		ctx.JSON(http.StatusOK, gin.H&#123;<br>			<span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">true</span>,<br>		&#125;)<br>	&#125;)<br></code></pre></td></tr></table></figure><h2 id="xml方式-ctx.xml">3. XML方式 ctx.XML</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> XmlUser <span class="hljs-keyword">struct</span> &#123;<br>	Id   <span class="hljs-type">int64</span>  <span class="hljs-string">`xml:&quot;id&quot;`</span><br>	Name <span class="hljs-type">string</span> <span class="hljs-string">`xml:&quot;name&quot;`</span><br>&#125;<br>r.GET(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		u := XmlUser&#123;<br>			Id:   <span class="hljs-number">11</span>,<br>			Name: <span class="hljs-string">&quot;zhangsan&quot;</span>,<br>		&#125;<br>		ctx.XML(http.StatusOK, u)<br>	&#125;)<br></code></pre></td></tr></table></figure><h2 id="文件格式-ctx.fileattachment">4. 文件格式 ctx.FileAttachment</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		<span class="hljs-comment">//ctx.File(&quot;./1.png&quot;) // 返回文件1.png</span><br>    	<span class="hljs-comment">// 如果返回文件重新定义名字，使用FileAttachment</span><br>		ctx.FileAttachment(<span class="hljs-string">&quot;./1.png&quot;</span>, <span class="hljs-string">&quot;2.png&quot;</span>)<br>	&#125;)<br></code></pre></td></tr></table></figure><h2 id="设置http响应头-ctx.header">5. 设置http响应头 ctx.Header</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		ctx.Header(<span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;headertest&quot;</span>)<br>	&#125;)<br></code></pre></td></tr></table></figure><h2 id="重定向-ctx.redirect">6. 重定向 ctx.Redirect</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		ctx.Redirect(http.StatusMovedPermanently, <span class="hljs-string">&quot;http://www.baidu.com&quot;</span>)<br>	&#125;)<br></code></pre></td></tr></table></figure><h2 id="yaml方式-ctx.yaml">7. YAML方式 ctx.YAML</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user/save&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		ctx.YAML(<span class="hljs-number">200</span>, gin.H&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;ms&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">19</span>&#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><h1 id="五模板渲染">五、模板渲染</h1><p>模板是golang语言的一个标准库，使用场景很多，gin框架同样支持模板</p><h2 id="基本使用-ctx.html">1. 基本使用 ctx.HTML</h2><p>定义一个存放模板文件的<code>templates</code>文件夹，新建文件：<code>index.tmpl</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>gin_templates<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>&#123;&#123;.title&#125;&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>后端代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>	<span class="hljs-string">&quot;log&quot;</span><br>	<span class="hljs-string">&quot;net/http&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	r := gin.Default()<br><br>	<span class="hljs-comment">// 加载模板（模板解析）</span><br>	r.LoadHTMLFiles(<span class="hljs-string">&quot;templates/index.tmpl&quot;</span>)<br><br>	r.GET(<span class="hljs-string">&quot;/index&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		<span class="hljs-comment">// HTML请求  	模板的渲染</span><br>		ctx.HTML(http.StatusOK, <span class="hljs-string">&quot;index.tmpl&quot;</span>, gin.H&#123;<br>			<span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;hello 模板&quot;</span>, <span class="hljs-comment">// 为模板内容赋值</span><br>		&#125;)<br>	&#125;)<br><br>	err := r.Run(<span class="hljs-string">&quot;:8080&quot;</span>) <span class="hljs-comment">// 监听并在 0.0.0.0:8080 上启动服务</span><br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;       <span class="hljs-comment">//  r.Run可以不用err接收</span><br>		log.Fatalln(err)<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="多个模板渲染">2. 多个模板渲染</h2><p>如果有多个模板，可以统一进行渲染</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 模板解析,解析templates目录下的所有模板文件</span><br>	r.LoadHTMLGlob(<span class="hljs-string">&quot;templates/**&quot;</span>)<br></code></pre></td></tr></table></figure><p>如果目录为<code>templates/post/index.tmpl</code>和<code>templates/user/index.tmpl</code>这种，可以</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// **/* 代表所有子目录下的所有文件</span><br>router.LoadHTMLGlob(<span class="hljs-string">&quot;templates/**/*&quot;</span>)<br></code></pre></td></tr></table></figure><p>后端代码</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// r.LoadHTMLGlob(&quot;templates/**&quot;)</span><br>r.LoadHTMLFiles(<span class="hljs-string">&quot;templates/index.tmpl&quot;</span>, <span class="hljs-string">&quot;templates/user.tmpl&quot;</span>)<br><br>r.GET(<span class="hljs-string">&quot;/index&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>    <span class="hljs-comment">// HTML请求</span><br>    <span class="hljs-comment">// 模板的渲染</span><br>    ctx.HTML(http.StatusOK, <span class="hljs-string">&quot;index.tmpl&quot;</span>, gin.H&#123;<br>        <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;hello 模板&quot;</span>, <span class="hljs-comment">// 为模板内容赋值</span><br>    &#125;)<br>&#125;)<br>r.GET(<span class="hljs-string">&quot;/user&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>    <span class="hljs-comment">// HTML请求</span><br>    <span class="hljs-comment">// 模板的渲染</span><br>    ctx.HTML(http.StatusOK, <span class="hljs-string">&quot;index.tmpl&quot;</span>, gin.H&#123;<br>        <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;hello 模板&quot;</span>, <span class="hljs-comment">// 为模板内容赋值</span><br>    &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="自定义模板函数">3. 自定义模板函数</h2><ul><li>自定义模板函数一定要放在模板解析<code>LoadHTMLGlob</code>之前</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// gin框架给模板添加自定义函数</span><br>	r.SetFuncMap(template.FuncMap&#123;<br>		<span class="hljs-comment">// k:v</span><br>		<span class="hljs-string">&quot;safe&quot;</span>: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(str <span class="hljs-type">string</span>)</span></span> template.HTML &#123;<br>			<span class="hljs-comment">// 函数作用：原样输出，不要进行转义</span><br>			<span class="hljs-keyword">return</span> template.HTML(str)<br>		&#125;,<br>	&#125;)<br><br>	<span class="hljs-comment">// 模板解析,解析templates目录下的所有模板文件</span><br>	r.LoadHTMLGlob(<span class="hljs-string">&quot;templates/**&quot;</span>)<br><br>	r.GET(<span class="hljs-string">&quot;/index&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>		<span class="hljs-comment">// HTML请求</span><br>		<span class="hljs-comment">// 模板的渲染</span><br>		c.HTML(http.StatusOK, <span class="hljs-string">&quot;index.tmpl&quot;</span>, gin.H&#123;<br>			<span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;&lt;a href=&#x27;http://baidu.com&#x27;&gt;跳转到其他地方&lt;/a&gt;&quot;</span>,<br>		&#125;)<br>	&#125;)<br></code></pre></td></tr></table></figure><p>模板<code>index.tmpl</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go">&lt;!DOCTYPE html&gt;<br>&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br>&lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;title&gt;gin_templates&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&#123;&#123;.title | safe&#125;&#125;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><h2 id="静态文件处理">4. 静态文件处理</h2><p>如果在模板中引入静态文件，比如样式文件</p><p><code>static/index.css</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span>&#123;<br>    <span class="hljs-attribute">background-color</span>: aqua;<br>&#125;<br></code></pre></td></tr></table></figure><p>模板文件中进行引入</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;<br>    &lt;meta name=<span class="hljs-string">&quot;viewport&quot;</span> content=<span class="hljs-string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;<br>    &lt;title&gt;gin_templates&lt;/title&gt;<br>    &lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;/css/index.css&quot;</span>&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&#123;&#123;.title&#125;&#125;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br></code></pre></td></tr></table></figure><p>加载静态文件</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 加载静态文件</span><br>r.Static(<span class="hljs-string">&quot;/css&quot;</span>, <span class="hljs-string">&quot;./static/css&quot;</span>)<br></code></pre></td></tr></table></figure><h1 id="六会话">六、会话</h1><p>会话控制涉及到cookie和session的使用</p><h2 id="cookie">1. cookie</h2><ol type="1"><li>HTTP是无状态协议，服务器不能记录浏览器的访问状态，也就是说服务器不能区分两次请求是否由同一个客户端发出</li><li>Cookie就是解决HTTP协议无状态的方案之一</li><li>Cookie实际上就是服务器保存在浏览器上的一段信息。浏览器有了Cookie之后，每次向服务器发送请求时都会同时将该信息发送给服务器，服务器收到请求后，就可以根据该信息处理请求</li><li>Cookie由服务器创建，并发送给浏览器，最终由浏览器保存</li></ol><h3 id="设置cookie">1.1 设置cookie</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> SetCookie(name, value <span class="hljs-type">string</span>, maxAge <span class="hljs-type">int</span>, path, domain <span class="hljs-type">string</span>, secure<br></code></pre></td></tr></table></figure><p>参数说明：</p><table><colgroup><col style="width:10%"><col style="width:8%"><col style="width:81%"></colgroup><thead><tr class="header"><th>参数名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr class="odd"><td>name</td><td>string</td><td>cookie名字</td></tr><tr class="even"><td>value</td><td>string</td><td>cookie值</td></tr><tr class="odd"><td>maxAge</td><td>int</td><td>有效时间，单位是秒，MaxAge=0 忽略MaxAge属性，MaxAge&lt;0 相当于删除cookie, 通常可以设置-1代表删除，MaxAge&gt;0 多少秒后cookie失效</td></tr><tr class="even"><td>path</td><td>string</td><td>cookie路径</td></tr><tr class="odd"><td>domain</td><td>string</td><td>cookie作用域</td></tr><tr class="even"><td>secure</td><td>bool</td><td>Secure=true，那么这个cookie只能用https协议发送给服务器</td></tr><tr class="odd"><td>httpOnly</td><td>bool</td><td>设置HttpOnly=true的cookie不能被js获取到</td></tr></tbody></table><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/cookie&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>		<span class="hljs-comment">// 设置cookie</span><br>		c.SetCookie(<span class="hljs-string">&quot;site_cookie&quot;</span>, <span class="hljs-string">&quot;cookievalue&quot;</span>, <span class="hljs-number">3600</span>, <span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>)<br>	&#125;)<br></code></pre></td></tr></table></figure><h3 id="读取cookie">1.2 读取cookie</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/read&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>		<span class="hljs-comment">// 根据cookie名字读取cookie值</span><br>		data, err := c.Cookie(<span class="hljs-string">&quot;site_cookie&quot;</span>)<br>		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>			log.Println(err)<br>			<span class="hljs-comment">// 直接返回cookie值</span><br>			c.String(<span class="hljs-number">200</span>, err.Error())<br>			<span class="hljs-keyword">return</span><br>		&#125;<br>		c.String(<span class="hljs-number">200</span>, data)<br>	&#125;)<br></code></pre></td></tr></table></figure><h3 id="删除cookie">1.3 删除cookie</h3><p>通过将cookie的MaxAge设置为-1, 达到删除cookie的目的。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/del&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>		<span class="hljs-comment">// 设置cookie  MaxAge设置为-1，表示删除cookie</span><br>		c.SetCookie(<span class="hljs-string">&quot;site_cookie&quot;</span>, <span class="hljs-string">&quot;cookievalue&quot;</span>, <span class="hljs-number">-1</span>, <span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>)<br>		c.String(<span class="hljs-number">200</span>,<span class="hljs-string">&quot;删除cookie&quot;</span>)<br>	&#125;)<br></code></pre></td></tr></table></figure><h2 id="session">2. Session</h2><p>在Gin框架中，我们可以依赖 <a target="_blank" rel="noopener" href="https://github.com/gin-contrib/sessions">gin-contrib/sessionsopen in new window</a> 中间件处理session。</p><p>安装session包</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">go</span> get github.com/gin-contrib/sessions<br></code></pre></td></tr></table></figure><p>官方文档例子：<code>基于cookie</code></p><h3 id="官方demo">2.1 官方demo</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;fmt&quot;</span><br>	<span class="hljs-string">&quot;github.com/gin-contrib/sessions&quot;</span><br>	<span class="hljs-string">&quot;github.com/gin-contrib/sessions/cookie&quot;</span><br>	<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	r := gin.Default()<br>	<span class="hljs-comment">// 创建基于cookie的存储引擎，secret 参数是用于加密的密钥</span><br>	store := cookie.NewStore([]<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;secret&quot;</span>))<br>	<span class="hljs-comment">// 设置session中间件，参数mysession，指的是session的名字，也是cookie的名字</span><br>	<span class="hljs-comment">// store是前面创建的存储引擎，我们可以替换成其他存储引擎</span><br>	r.Use(sessions.Sessions(<span class="hljs-string">&quot;mysession&quot;</span>, store))<br><br>	r.GET(<span class="hljs-string">&quot;/hello&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>		<span class="hljs-comment">// 初始化session对象</span><br>		session := sessions.Default(c)<br>		<span class="hljs-comment">// 通过session.Get读取session值</span><br>		<span class="hljs-comment">// session是键值对格式数据，因此需要通过key查询数据</span><br>		<span class="hljs-keyword">if</span> session.Get(<span class="hljs-string">&quot;hello&quot;</span>) != <span class="hljs-string">&quot;world&quot;</span> &#123;<br>			fmt.Println(<span class="hljs-string">&quot;没读到&quot;</span>)<br>			<span class="hljs-comment">// 设置session数据</span><br>			session.Set(<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>)<br>			session.Save() <span class="hljs-comment">// 保存session</span><br>		&#125;<br>		c.JSON(<span class="hljs-number">200</span>, gin.H&#123;<span class="hljs-string">&quot;hello&quot;</span>: session.Get(<span class="hljs-string">&quot;hello&quot;</span>)&#125;)<br>	&#125;)<br>	r.Run(<span class="hljs-string">&quot;:8080&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="多session的demo">2.2 多session的demo</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;github.com/gin-contrib/sessions&quot;</span><br>	<span class="hljs-string">&quot;github.com/gin-contrib/sessions/cookie&quot;</span><br>	<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	r := gin.Default()<br>	store := cookie.NewStore([]<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;secret&quot;</span>))<br>	sessionNames := []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>&#125;<br>	r.Use(sessions.SessionsMany(sessionNames, store))<br><br>	r.GET(<span class="hljs-string">&quot;/hello&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>		sessionA := sessions.DefaultMany(c, <span class="hljs-string">&quot;a&quot;</span>)<br>		sessionB := sessions.DefaultMany(c, <span class="hljs-string">&quot;b&quot;</span>)<br><br>		<span class="hljs-keyword">if</span> sessionA.Get(<span class="hljs-string">&quot;hello&quot;</span>) != <span class="hljs-string">&quot;world!&quot;</span> &#123;<br>			sessionA.Set(<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;world!&quot;</span>)<br>			sessionA.Save()<br>		&#125;<br><br>		<span class="hljs-keyword">if</span> sessionB.Get(<span class="hljs-string">&quot;hello&quot;</span>) != <span class="hljs-string">&quot;world?&quot;</span> &#123;<br>			sessionB.Set(<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;world?&quot;</span>)<br>			sessionB.Save()<br>		&#125;<br><br>		c.JSON(<span class="hljs-number">200</span>, gin.H&#123;<br>			<span class="hljs-string">&quot;a&quot;</span>: sessionA.Get(<span class="hljs-string">&quot;hello&quot;</span>),<br>			<span class="hljs-string">&quot;b&quot;</span>: sessionB.Get(<span class="hljs-string">&quot;hello&quot;</span>),<br>		&#125;)<br>	&#125;)<br>	r.Run(<span class="hljs-string">&quot;:8080&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="基于redis存储引擎的session">2.2 基于redis存储引擎的session</h3><p>如果我们想将session数据保存到redis中，只要将session的存储引擎改成redis即可。</p><p>使用redis作为存储引擎的例子：</p><p>首先安装redis存储引擎的包</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">go</span> get github.com/gin-contrib/sessions/redis<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;github.com/gin-contrib/sessions&quot;</span><br>	<span class="hljs-string">&quot;github.com/gin-contrib/sessions/redis&quot;</span><br>	<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	r := gin.Default()<br>	<span class="hljs-comment">// 初始化基于redis的存储引擎</span><br>	<span class="hljs-comment">// 参数说明：</span><br>	<span class="hljs-comment">//    第1个参数 - redis最大的空闲连接数</span><br>	<span class="hljs-comment">//    第2个参数 - 数通信协议tcp或者udp</span><br>	<span class="hljs-comment">//    第3个参数 - redis地址, 格式，host:port</span><br>	<span class="hljs-comment">//    第4个参数 - redis密码</span><br>	<span class="hljs-comment">//    第5个参数 - session加密密钥</span><br>	store, _ := redis.NewStore(<span class="hljs-number">10</span>, <span class="hljs-string">&quot;tcp&quot;</span>, <span class="hljs-string">&quot;localhost:6379&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, []<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;secret&quot;</span>))<br>	r.Use(sessions.Sessions(<span class="hljs-string">&quot;mysession&quot;</span>, store))<br><br>	r.GET(<span class="hljs-string">&quot;/incr&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>		session := sessions.Default(c)<br>		<span class="hljs-keyword">var</span> count <span class="hljs-type">int</span><br>		v := session.Get(<span class="hljs-string">&quot;count&quot;</span>)<br>		<span class="hljs-keyword">if</span> v == <span class="hljs-literal">nil</span> &#123;<br>			count = <span class="hljs-number">0</span><br>		&#125; <span class="hljs-keyword">else</span> &#123;<br>			count = v.(<span class="hljs-type">int</span>)<br>			count++<br>		&#125;<br>		session.Set(<span class="hljs-string">&quot;count&quot;</span>, count)<br>		session.Save()<br>		c.JSON(<span class="hljs-number">200</span>, gin.H&#123;<span class="hljs-string">&quot;count&quot;</span>: count&#125;)<br>	&#125;)<br>	r.Run(<span class="hljs-string">&quot;:8080&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="七中间件">七、中间件</h1><p>在Gin框架中，<strong>中间件</strong>（Middleware）指的是可以拦截 <strong>http请求-响应</strong> 生命周期的特殊函数，在请求-响应生命周期中可以注册多个中间件，每个中间件执行不同的功能，一个中间执行完再轮到下一个中间件执行。</p><p><strong>中间件的常见应用场景如下：</strong></p><ul><li>请求限速</li><li>api接口签名处理</li><li>权限校验</li><li>统一错误处理</li></ul><p>Gin支持设置全局中间件和针对路由分组设置中间件，设置全局中间件意思就是<strong>会拦截所有请求，针对分组路由设置中间件</strong>，意思就是仅对这个分组下的路由起作用。</p><h2 id="中间件使用">1. 中间件使用</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go">r := gin.New()<br><span class="hljs-comment">// 通过use设置全局中间件</span><br><span class="hljs-comment">// 设置日志中间件，主要用于打印请求日志</span><br>r.Use(gin.Logger())<br><span class="hljs-comment">// 设置Recovery中间件，主要用于拦截panic错误，不至于导致进程崩掉</span><br>r.Use(gin.Recovery())<br>r.GET(<span class="hljs-string">&quot;/test&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>    <span class="hljs-built_in">panic</span>(errors.New(<span class="hljs-string">&quot;test error&quot;</span>))<br>&#125;)<br>r.Run(<span class="hljs-string">&quot;:8080&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="自定义中间件">2. 自定义中间件</h2><p>使用Use可以使用gin自带的中间件或者其他第三方中间件，也可以自己开发中间件</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-comment">// 导入gin包</span><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>	<span class="hljs-string">&quot;log&quot;</span><br>	<span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-comment">// 自定义个日志中间件</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Logger</span><span class="hljs-params">()</span></span> gin.HandlerFunc &#123;<br>	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>		t := time.Now()<br><br>		<span class="hljs-comment">// 可以通过上下文对象，设置一些依附在上下文对象里面的键/值数据</span><br>		c.Set(<span class="hljs-string">&quot;example&quot;</span>, <span class="hljs-string">&quot;12345&quot;</span>)<br><br>		<span class="hljs-comment">// 在这里处理请求到达控制器函数之前的逻辑</span><br>     <br>		<span class="hljs-comment">// 调用下一个中间件，或者控制器处理函数，具体得看注册了多少个中间件。</span><br>		c.Next()<br><br>		<span class="hljs-comment">// 在这里可以处理请求返回给用户之前的逻辑</span><br>		latency := time.Since(t)<br>		log.Print(latency)<br><br>		<span class="hljs-comment">// 例如，查询请求状态吗</span><br>		status := c.Writer.Status()<br>		log.Println(status)<br>	&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	r := gin.New()<br>	<span class="hljs-comment">// 注册上面自定义的日志中间件</span><br>	r.Use(Logger())<br><br>	r.GET(<span class="hljs-string">&quot;/test&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>		<span class="hljs-comment">// 查询我们之前在日志中间件，注入的键值数据</span><br>		example := c.MustGet(<span class="hljs-string">&quot;example&quot;</span>).(<span class="hljs-type">string</span>)<br>		<span class="hljs-comment">// it would print: &quot;12345&quot;</span><br>		log.Println(example)<br>	&#125;)<br><br>	<span class="hljs-comment">// Listen and serve on 0.0.0.0:8080</span><br>	r.Run(<span class="hljs-string">&quot;:8080&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><hr><p>自定义一个简单的中间件</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;fmt&quot;</span><br>	<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><br><span class="hljs-comment">// 自定义个日志中间件</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Logger</span><span class="hljs-params">()</span></span> gin.HandlerFunc &#123;<br>	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>		fmt.Println(<span class="hljs-string">&quot;my custom middle&quot;</span>)<br>	&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	r := gin.New()<br>	<span class="hljs-comment">// 通过use设置全局中间件</span><br>	<span class="hljs-comment">// 设置日志中间件，主要用于打印请求日志</span><br>	r.Use(Logger())<br><br>	r.GET(<span class="hljs-string">&quot;/testMyMid&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>		ctx.JSON(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;success&quot;</span>)<br>	&#125;)<br>	r.Run(<span class="hljs-string">&quot;:8080&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://Unicorn-acc.github.io">Miraclo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://unicorn-acc.github.io/posts/23688.html">http://unicorn-acc.github.io/posts/23688.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://Unicorn-acc.github.io" target="_blank">Miraclo</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Golang/">Golang</a></div><div class="post_share"><div class="social-share" data-image="https://w.wallhaven.cc/full/zy/wallhaven-zyxvqy.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/49550.html"><img class="prev-cover" src="https://w.wallhaven.cc/full/1p/wallhaven-1p1qjg.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">【GoWeb框架-Gorm框架】快速入门、模型定义、增删改查、事务和Hook、socpe\智能选择字段\子查询\关联操作</div></div></a></div><div class="next-post pull-right"><a href="/posts/25056.html"><img class="next-cover" src="https://w.wallhaven.cc/full/p9/wallhaven-p9273e.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">【Golang修养之路】Go垃圾回收：三色标记法、混合写屏障机制</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/16244.html" title="【Golang 快速入门3】Go Modules + 生态拓展"><img class="cover" src="https://w.wallhaven.cc/full/x6/wallhaven-x619o3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-24</div><div class="title">【Golang 快速入门3】Go Modules + 生态拓展</div></div></a></div><div><a href="/posts/25056.html" title="【Golang修养之路】Go垃圾回收：三色标记法、混合写屏障机制"><img class="cover" src="https://w.wallhaven.cc/full/p9/wallhaven-p9273e.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-26</div><div class="title">【Golang修养之路】Go垃圾回收：三色标记法、混合写屏障机制</div></div></a></div><div><a href="/posts/16215.html" title="【Golang修养之路】GMP协程调度器原理及GMP设计思想"><img class="cover" src="https://w.wallhaven.cc/full/p9/wallhaven-p9273e.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-29</div><div class="title">【Golang修养之路】GMP协程调度器原理及GMP设计思想</div></div></a></div><div><a href="/posts/53840.html" title="【Golang 快速入门2】高级语法：反射 + 并发"><img class="cover" src="https://w.wallhaven.cc/full/kx/wallhaven-kx3p1q.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-24</div><div class="title">【Golang 快速入门2】高级语法：反射 + 并发</div></div></a></div><div><a href="/posts/35945.html" title="【Go爬虫】Go爬取静态数据、动态数据、并发爬取"><img class="cover" src="https://w.wallhaven.cc/full/zy/wallhaven-zyxvqy.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-26</div><div class="title">【Go爬虫】Go爬取静态数据、动态数据、并发爬取</div></div></a></div><div><a href="/posts/43853.html" title="【Go项目】Gin+Gorm实现简单备忘录"><img class="cover" src="https://w.wallhaven.cc/full/kx/wallhaven-kx3p1q.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-29</div><div class="title">【Go项目】Gin+Gorm实现简单备忘录</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E8%AE%A4%E8%AF%86gin%E6%A1%86%E6%9E%B6"><span class="toc-text">一、认识Gin框架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#go%E6%B5%81%E8%A1%8C%E7%9A%84web%E6%A1%86%E6%9E%B6"><span class="toc-text">1. go流行的web框架</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#gin%E7%9A%84github%E5%9C%B0%E5%9D%80"><span class="toc-text">Gin的Github地址</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gin%E4%BB%8B%E7%BB%8D"><span class="toc-text">2. gin介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">3. 快速入门</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E8%B7%AF%E7%94%B1"><span class="toc-text">二、路由</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#restful-api%E8%A7%84%E8%8C%83"><span class="toc-text">1. RESTful API规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95"><span class="toc-text">2. 请求方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#uri"><span class="toc-text">3. URI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-text">4. 处理函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E8%B7%AF%E7%94%B1-r.group"><span class="toc-text">5. 分组路由 r.Group</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0-ctx-gin.context"><span class="toc-text">三、请求参数 (ctx *gin.Context)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#get%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-text">1. Get请求参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E5%8F%82%E6%95%B0-ctx.query"><span class="toc-text">1.1 普通参数 ctx.Query</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E5%8F%82%E6%95%B0-queryarray"><span class="toc-text">1.2 数组参数 QueryArray</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#map%E5%8F%82%E6%95%B0-querymap"><span class="toc-text">1.3 map参数 QueryMap</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#post%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-text">2. Post请求参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E5%8F%82%E6%95%B0-ctx.postform"><span class="toc-text">2.1 表单参数 ctx.PostForm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#json%E5%8F%82%E6%95%B0"><span class="toc-text">2.2 json参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0restful%E9%A3%8E%E6%A0%BC"><span class="toc-text">3. 路径参数（RESTful风格）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8F%82%E6%95%B0-multipartform"><span class="toc-text">4. 文件参数 MultipartForm</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E5%93%8D%E5%BA%94"><span class="toc-text">四、响应</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%96%B9%E5%BC%8F-ctx.string"><span class="toc-text">1. 字符串方式 ctx.String</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#json%E6%96%B9%E5%BC%8F-ctx.json"><span class="toc-text">2. JSON方式 ctx.JSON</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xml%E6%96%B9%E5%BC%8F-ctx.xml"><span class="toc-text">3. XML方式 ctx.XML</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F-ctx.fileattachment"><span class="toc-text">4. 文件格式 ctx.FileAttachment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AEhttp%E5%93%8D%E5%BA%94%E5%A4%B4-ctx.header"><span class="toc-text">5. 设置http响应头 ctx.Header</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91-ctx.redirect"><span class="toc-text">6. 重定向 ctx.Redirect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#yaml%E6%96%B9%E5%BC%8F-ctx.yaml"><span class="toc-text">7. YAML方式 ctx.YAML</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93"><span class="toc-text">五、模板渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8-ctx.html"><span class="toc-text">1. 基本使用 ctx.HTML</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93"><span class="toc-text">2. 多个模板渲染</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E6%9D%BF%E5%87%BD%E6%95%B0"><span class="toc-text">3. 自定义模板函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-text">4. 静态文件处理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E4%BC%9A%E8%AF%9D"><span class="toc-text">六、会话</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#cookie"><span class="toc-text">1. cookie</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AEcookie"><span class="toc-text">1.1 设置cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96cookie"><span class="toc-text">1.2 读取cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4cookie"><span class="toc-text">1.3 删除cookie</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#session"><span class="toc-text">2. Session</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%98%E6%96%B9demo"><span class="toc-text">2.1 官方demo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9Asession%E7%9A%84demo"><span class="toc-text">2.2 多session的demo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8Eredis%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E7%9A%84session"><span class="toc-text">2.2 基于redis存储引擎的session</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">七、中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%BD%BF%E7%94%A8"><span class="toc-text">1. 中间件使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">2. 自定义中间件</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By Miraclo</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">人只有在走上坡路的时候才会累和迷茫。</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if(window.MathJax)MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset();else{window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"ams"},chtml:{scale:1.1},options:{renderActions:{findScript:[10,t=>{for(const n of document.querySelectorAll('script[type^="math/tex"]')){var e=!!n.type.match(/; *mode=display/),e=new t.options.MathItem(n.textContent,t.inputJax[0],e),a=document.createTextNode("");n.parentNode.replaceChild(a,n),e.start={node:a,delim:"",n:0},e.end={node:a,delim:"",n:0},t.math.push(e)}},""],insertScript:[200,()=>{document.querySelectorAll("mjx-container").forEach(t=>{t.hasAttribute("display")?btf.wrap(t,"div",{class:"mathjax-overflow"}):btf.wrap(t,"span",{class:"mathjax-overflow"})})},"",!1]}}};const a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js",a.id="MathJax-script",a.async=!0,document.head.appendChild(a)}</script></div><link rel="stylesheet" href="/css/Lete.css"><script src="/js/custom.js"></script><script src="/js/mouth.js"></script><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div class="js-pjax"><script async>for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration","1s"),arr[i].setAttribute("data-wow-delay","1ms"),arr[i].setAttribute("data-wow-offset","100"),arr[i].setAttribute("data-wow-iteration","1")</script><script async>for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script></body></html>
<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>【Go项目】Gin+Gorm实现简单备忘录 | Miraclo</title><meta name="author" content="Miraclo"><meta name="copyright" content="Miraclo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Gin+Gorm实现简单备忘录  视频链接：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1GT4y1R7tX Github地址：https:&#x2F;&#x2F;github.com&#x2F;CocaineCong&#x2F;TodoList 自己做了一遍的Gin+Gorm备忘录项目：https:&#x2F;&#x2F;github.com&#x2F;Unicorn-acc&#x2F;Golang-Project&#x2F;tree&#x2F;main&#x2F;GoProjec"><meta property="og:type" content="article"><meta property="og:title" content="【Go项目】Gin+Gorm实现简单备忘录"><meta property="og:url" content="http://unicorn-acc.github.io/posts/43853.html"><meta property="og:site_name" content="Miraclo"><meta property="og:description" content="Gin+Gorm实现简单备忘录  视频链接：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1GT4y1R7tX Github地址：https:&#x2F;&#x2F;github.com&#x2F;CocaineCong&#x2F;TodoList 自己做了一遍的Gin+Gorm备忘录项目：https:&#x2F;&#x2F;github.com&#x2F;Unicorn-acc&#x2F;Golang-Project&#x2F;tree&#x2F;main&#x2F;GoProjec"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://w.wallhaven.cc/full/vq/wallhaven-vqmyq3.jpg"><meta property="article:published_time" content="2023-03-29T21:55:22.000Z"><meta property="article:modified_time" content="2023-03-29T14:48:07.777Z"><meta property="article:author" content="Miraclo"><meta property="article:tag" content="Golang"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://w.wallhaven.cc/full/vq/wallhaven-vqmyq3.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://unicorn-acc.github.io/posts/43853"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:2e3},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:800,languages:{author:"作者: Miraclo",link:"链接: ",source:"来源: Miraclo",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"【Go项目】Gin+Gorm实现简单备忘录",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-03-29 14:48:07"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,a){0!==a&&(a=864e5*a,t={value:t,expiry:(new Date).getTime()+a},localStorage.setItem(e,JSON.stringify(t)))},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!((new Date).getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=o=>new Promise((t,e)=>{const a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};e=saveToLocal.get("theme"),"dark"===e?activateDarkMode():"light"===e&&activateLightMode(),e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/mouth.css"><link rel="stylesheet" href="/css/codecolor.css"><link rel="stylesheet" href="//s1.hdslb.com/bfs/static/jinkela/long/font/medium.css"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload='this.media="screen"'><meta name="generator" content="Hexo 6.0.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./img/avatar.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">153</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">35</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-film"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i><span></span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://w.wallhaven.cc/full/vq/wallhaven-vqmyq3.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Miraclo</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-film"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i><span></span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">【Go项目】Gin+Gorm实现简单备忘录</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2023-03-29T21:55:22.000Z" title="发表于 2023-03-29 21:55:22">2023-03-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Golang/">Golang</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Golang/Golang%E5%AE%9E%E6%88%98/">Golang实战</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>29分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="【Go项目】Gin+Gorm实现简单备忘录"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="gingorm实现简单备忘录">Gin+Gorm实现简单备忘录</h1><blockquote><p>视频链接：https://www.bilibili.com/video/BV1GT4y1R7tX</p><p>Github地址：<a target="_blank" rel="noopener" href="https://github.com/CocaineCong/TodoList">https://github.com/CocaineCong/TodoList</a></p><p>自己做了一遍的Gin+Gorm备忘录项目：<a target="_blank" rel="noopener" href="https://github.com/Unicorn-acc/Golang-Project/tree/main/GoProject_todolist">https://github.com/Unicorn-acc/Golang-Project/tree/main/GoProject_todolist</a></p></blockquote><p><strong>此项目使用<code>Gin</code>+<code>Gorm</code> ，基于<code>RESTful API</code>实现的一个备忘录</strong>。</p><p><strong>规范是非常重要的，此项目非常适合小白入门学习<code>web开发</code></strong></p><p>接口文档内容：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Unicorn-acc/blogimgs/imgs04/image-20230329214006383.png" style="zoom:80%"></p><h2 id="项目主要功能介绍">项目主要功能介绍</h2><ul><li>用户注册登录 ( jwt-go鉴权 )</li><li>新增/删除/修改/查询 备忘录</li><li>存储每条备忘录的浏览次数</li><li>分页功能</li></ul><h2 id="一项目初始化">一、项目初始化</h2><p>创建项目文件的方式看<code>gin</code>部分：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 初始化一个目录</span><br>D:\<span class="hljs-keyword">go</span>\project&gt;mkdir ginlearn<br>D:\<span class="hljs-keyword">go</span>\project&gt;cd ginlearn<br><span class="hljs-comment">// 1. 这是目录是工作区，初始化工作区 go work init</span><br>D:\<span class="hljs-keyword">go</span>\project\ginlearn&gt;<span class="hljs-keyword">go</span> work init<br><span class="hljs-comment">// 2. 创建对应模块，比如这边创建helloworld模块</span><br>D:\<span class="hljs-keyword">go</span>\project\ginlearn&gt;mkdir helloworld<br>D:\<span class="hljs-keyword">go</span>\project\ginlearn&gt;cd helloworld<br><span class="hljs-comment">// 3. 模块初始化 go mod init name (name要求：example.com/m)</span><br>D:\<span class="hljs-keyword">go</span>\project\ginlearn\helloworld&gt;<span class="hljs-keyword">go</span> mod init test.com/helloworld<br><span class="hljs-keyword">go</span>: creating <span class="hljs-built_in">new</span> <span class="hljs-keyword">go</span>.mod: module test.com/helloworld<br>D:\<span class="hljs-keyword">go</span>\project\ginlearn\helloworld&gt;cd ..<br><span class="hljs-comment">// 4. 在工作区目录将helloworld模块加入到工作区里</span><br>D:\<span class="hljs-keyword">go</span>\project\ginlearn&gt;<span class="hljs-keyword">go</span> work use ./helloworld<br></code></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Unicorn-acc/blogimgs/imgs04/image-20230329132820519.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">TodoList/<br>├── api<br>├── cache<br>├── conf<br>├── middleware<br>├── model<br>├── pkg<br>│  ├── e<br>│  └──  util<br>├── routes<br>├── serializer<br>└── service<br></code></pre></td></tr></table></figure><ul><li>api : 用于定义接口函数</li><li>cache : 放置redis缓存</li><li>conf : 用于存储配置文件</li><li>middleware : 应用中间件</li><li>model : 应用数据库模型</li><li>pkg/e : 封装错误码</li><li>pkg/logging : 日志打印</li><li>pkg/util : 工具函数</li><li>routes : 路由逻辑处理</li><li>serializer : 将数据序列化为 json 的函数</li><li>service : 接口函数的实现</li></ul><h2 id="二项目配置和数据库连接">二、项目配置和数据库连接</h2><p>一些依赖的导入</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 导入读取ini的组件：go get gopkg.in/ini.v1</span><br><span class="hljs-comment">// 导入gorm：go get gorm.io/gorm</span><br><span class="hljs-comment">// 导入gin： go get github.com/gin-gonic/gin</span><br><span class="hljs-comment">// 安装MySQL驱动 :go get gorm.io/driver/mysql</span><br></code></pre></td></tr></table></figure><p>一、配置文件：<strong>conf/config.ini</strong></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># debug开发模式,release生产模式</span><br><span class="hljs-section">[service]</span><br><span class="hljs-attr">AppMode</span> = debug<br><span class="hljs-attr">HttpPort</span> = :<span class="hljs-number">3000</span><br><span class="hljs-comment"># 运行端口号 3000端口</span><br><br><span class="hljs-section">[redis]</span><br><span class="hljs-attr">RedisDb</span> = redis<br><span class="hljs-attr">RedisAddr</span> = <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">6379</span><br><span class="hljs-comment"># redis ip地址和端口号</span><br>RedisPw =<br><span class="hljs-comment"># redis 密码</span><br><span class="hljs-attr">RedisDbName</span> = <span class="hljs-number">2</span><br><span class="hljs-comment"># redis 名字</span><br><br><span class="hljs-section">[mysql]</span><br><span class="hljs-attr">Db</span> = mysql<br><span class="hljs-attr">DbHost</span> = <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br><span class="hljs-comment"># mysql ip地址</span><br><span class="hljs-attr">DbPort</span> = <span class="hljs-number">3306</span><br><span class="hljs-comment"># mysql 端口号</span><br><span class="hljs-attr">DbUser</span> = root<br><span class="hljs-comment"># mysql 用户名</span><br><span class="hljs-attr">DbPassWord</span> = <span class="hljs-number">123456</span><br><span class="hljs-comment"># mysql 密码</span><br><span class="hljs-attr">DbName</span> = todolist<br><span class="hljs-comment"># mysql 名字</span><br></code></pre></td></tr></table></figure><p>在<code>conf.go</code>中读取配置文件到变量中，在<code>Init()</code>函数中进行读取</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// config.conf.go</span><br><span class="hljs-keyword">package</span> config<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;gopkg.in/ini.v1&quot;</span><br>	<span class="hljs-string">&quot;log&quot;</span><br>	<span class="hljs-string">&quot;strings&quot;</span><br>	<span class="hljs-string">&quot;todoList.com/todoList/model&quot;</span><br>)<br><br><span class="hljs-comment">// 将配置文件内容读取出来</span><br><span class="hljs-keyword">var</span> (<br>	AppMode  <span class="hljs-type">string</span><br>	HttpPort <span class="hljs-type">string</span><br><br>	RedisDb     <span class="hljs-type">string</span><br>	RedisAddr   <span class="hljs-type">string</span><br>	RedisPw     <span class="hljs-type">string</span><br>	RedisDbName <span class="hljs-type">string</span><br><br>	Db         <span class="hljs-type">string</span><br>	DbHost     <span class="hljs-type">string</span><br>	DbPort     <span class="hljs-type">string</span><br>	DbUser     <span class="hljs-type">string</span><br>	DbPassWord <span class="hljs-type">string</span><br>	DbName     <span class="hljs-type">string</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Init</span><span class="hljs-params">()</span></span> &#123;<br>	<span class="hljs-comment">// go get gopkg.in/ini.v1 ； 记得要在todolist包下</span><br>	<span class="hljs-comment">// 加载文件</span><br>	file, err := ini.Load(<span class="hljs-string">&quot;./config/config.ini&quot;</span>)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		log.Println(<span class="hljs-string">&quot;配置文件读取错误，请检查文件路径&quot;</span>, err)<br>	&#125;<br>	LoadServer(file)<br>	LoadMysql(file) <span class="hljs-comment">// 读取Mysql配置文件</span><br>	<span class="hljs-comment">// 将Mysql配置文件传给model.init， 让它去做数据库的连接</span><br>	<span class="hljs-comment">// 导入gorm：go get github.com/jinzhu/gorm</span><br>	path := strings.Join([]<span class="hljs-type">string</span>&#123;DbUser, <span class="hljs-string">&quot;:&quot;</span>, DbPassWord, <span class="hljs-string">&quot;@tcp(&quot;</span>, DbHost, <span class="hljs-string">&quot;:&quot;</span>, DbPort, <span class="hljs-string">&quot;)/&quot;</span>, DbName, <span class="hljs-string">&quot;?charset=utf8mb4&amp;parseTime=true&quot;</span>&#125;, <span class="hljs-string">&quot;&quot;</span>)<br>	model.DataBase(path)<br>&#125;<br><br><span class="hljs-comment">// 从file中加载文件信息</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoadServer</span><span class="hljs-params">(file *ini.File)</span></span> &#123;<br>	<span class="hljs-comment">/*	config.ini:</span><br><span class="hljs-comment">		# debug开发模式,release生产模式</span><br><span class="hljs-comment">		[service]</span><br><span class="hljs-comment">		AppMode = debug</span><br><span class="hljs-comment">		HttpPort = :3000</span><br><span class="hljs-comment">	*/</span><br>	<span class="hljs-comment">// 这句话的意思是选中[service]中的AppMode信息，然后转为string类型赋值给变量</span><br>	AppMode = file.Section(<span class="hljs-string">&quot;service&quot;</span>).Key(<span class="hljs-string">&quot;AppMode&quot;</span>).String()<br>	HttpPort = file.Section(<span class="hljs-string">&quot;service&quot;</span>).Key(<span class="hljs-string">&quot;HttpPort&quot;</span>).String()<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoadMysql</span><span class="hljs-params">(file *ini.File)</span></span> &#123;<br>	Db = file.Section(<span class="hljs-string">&quot;mysql&quot;</span>).Key(<span class="hljs-string">&quot;Db&quot;</span>).String()<br>	DbHost = file.Section(<span class="hljs-string">&quot;mysql&quot;</span>).Key(<span class="hljs-string">&quot;DbHost&quot;</span>).String()<br>	DbPort = file.Section(<span class="hljs-string">&quot;mysql&quot;</span>).Key(<span class="hljs-string">&quot;DbPort&quot;</span>).String()<br>	DbUser = file.Section(<span class="hljs-string">&quot;mysql&quot;</span>).Key(<span class="hljs-string">&quot;DbUser&quot;</span>).String()<br>	DbPassWord = file.Section(<span class="hljs-string">&quot;mysql&quot;</span>).Key(<span class="hljs-string">&quot;DbPassWord&quot;</span>).String()<br>	DbName = file.Section(<span class="hljs-string">&quot;mysql&quot;</span>).Key(<span class="hljs-string">&quot;DbName&quot;</span>).String()<br>&#125;<br><br></code></pre></td></tr></table></figure><p>读取到Mysql的配置文件后，调用<code>model/init.go</code>进行数据库的连接</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> model<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;fmt&quot;</span><br>	<span class="hljs-string">&quot;gorm.io/driver/mysql&quot;</span><br>	<span class="hljs-string">&quot;gorm.io/gorm&quot;</span><br>	<span class="hljs-string">&quot;gorm.io/gorm/logger&quot;</span><br>	<span class="hljs-string">&quot;gorm.io/gorm/schema&quot;</span><br>	<span class="hljs-string">&quot;log&quot;</span><br>	<span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> DB *gorm.DB<br><br><span class="hljs-comment">// 根据配置文件进行Mysql连接</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DataBase</span><span class="hljs-params">(conn <span class="hljs-type">string</span>)</span></span> &#123;<br>	fmt.Println(conn)<br><br>	db, err := gorm.Open(mysql.New(mysql.Config&#123;<br>		DSN:                       conn,  <span class="hljs-comment">// DSN data source name</span><br>		DefaultStringSize:         <span class="hljs-number">256</span>,   <span class="hljs-comment">// string 类型字段的默认长度</span><br>		DisableDatetimePrecision:  <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 禁用 datetime 精度，MySQL 5.6 之前的数据库不支持</span><br>		DontSupportRenameIndex:    <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 重命名索引时采用删除并新建的方式，MySQL 5.7 之前的数据库和 MariaDB 不支持重命名索引</span><br>		DontSupportRenameColumn:   <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 用 `change` 重命名列，MySQL 8 之前的数据库和 MariaDB 不支持重命名列</span><br>		SkipInitializeWithVersion: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 根据版本自动配置</span><br>	&#125;), &amp;gorm.Config&#123; <span class="hljs-comment">// &amp;gorm.Config添加额外配置</span><br>		<span class="hljs-comment">// 打印日志</span><br>		Logger: logger.Default.LogMode(logger.Info),<br>		NamingStrategy: schema.NamingStrategy&#123;<br>			SingularTable: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 表明不加s</span><br>		&#125;,<br>	&#125;)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;数据库连接错误&quot;</span>)<br>	&#125;<br>	log.Println(<span class="hljs-string">&quot;数据库连接成功&quot;</span>)<br>	<span class="hljs-comment">// 设置数据库参数</span><br>	mysqldb, _ := db.DB()<br>	mysqldb.SetMaxIdleConns(<span class="hljs-number">20</span>)                  <span class="hljs-comment">//  设置连接池</span><br>	mysqldb.SetMaxOpenConns(<span class="hljs-number">100</span>)                 <span class="hljs-comment">//最大连接数</span><br>	mysqldb.SetConnMaxLifetime(time.Second * <span class="hljs-number">30</span>) <span class="hljs-comment">// 设置最大连接时间</span><br>	DB = db<br>	migration()<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="三数据库建表">三、数据库建表</h2><p>建立两张表：<code>User</code>和<code>Task</code>表</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> model<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;gorm.io/gorm&quot;</span><br><br><span class="hljs-comment">// User 用户模型</span><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>	gorm.Model            <span class="hljs-comment">// Model会一共ID,CreateAt, UpdateAt, DeleteAt</span><br>	UserName       <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;unique&quot;`</span><br>	PasswordDigest <span class="hljs-type">string</span> <span class="hljs-comment">// 存储的是密文，也就是加密后的密码</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> model<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;gorm.io/gorm&quot;</span><br><br><span class="hljs-comment">// 任务模型</span><br><span class="hljs-keyword">type</span> Task <span class="hljs-keyword">struct</span> &#123;<br>	gorm.Model<br>	User      User   <span class="hljs-string">`gorm:&quot;ForeignKey:Uid&quot;`</span><br>	Uid       <span class="hljs-type">uint</span>   <span class="hljs-string">`gorm:&quot;not null&quot;`</span><br>	Title     <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;index;not null&quot;`</span><br>	Status    <span class="hljs-type">int</span>    <span class="hljs-string">`gorm:&quot;default:0&quot;`</span>     <span class="hljs-comment">// 备忘录状态:0 未完成 ； 1 已完成</span><br>	Content   <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;type:longtext&quot;`</span> <span class="hljs-comment">// 内容</span><br>	StartTime <span class="hljs-type">int64</span>  <span class="hljs-comment">// 备忘录开始时间</span><br>	EndTime   <span class="hljs-type">int64</span>  <span class="hljs-string">`gorm:&quot;default:0&quot;`</span> <span class="hljs-comment">// 备忘录完成时间</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>新建<code>magirate.go</code>实现自动迁移模式</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> model<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;log&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">migration</span><span class="hljs-params">()</span></span> &#123;<br>	<span class="hljs-comment">// 自动迁移模式</span><br>	err := DB.Set(<span class="hljs-string">&quot;gorm:table_options&quot;</span>, <span class="hljs-string">&quot;charset=utf8mb4&quot;</span>).<br>		AutoMigrate(&amp;User&#123;&#125;, &amp;Task&#123;&#125;)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		log.Println(<span class="hljs-string">&quot;表迁移失败&quot;</span>)<br>		<span class="hljs-keyword">return</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>然后在<code>model.init.go</code>中创建完DB后进行调用迁移方法</p><h2 id="四用户注册与登录">四、用户注册与登录</h2><p>依赖配置：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 导入session相关的依赖</span><br><span class="hljs-keyword">go</span> get github.com/gin-contrib/sessions<br><span class="hljs-comment">// 导入对用户密码加密的包</span><br><span class="hljs-keyword">go</span> get golang.org/x/crypto/bcrypt<br><span class="hljs-comment">// 导入生成JWT令牌的包</span><br><span class="hljs-keyword">go</span> get github.com/dgrijalva/jwt-<span class="hljs-keyword">go</span><br></code></pre></td></tr></table></figure><h3 id="用户注册功能">1、用户注册功能</h3><p>①先编写全局路由</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// routes.routes.go</span><br><span class="hljs-keyword">package</span> routes<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;github.com/gin-contrib/sessions&quot;</span><br>	<span class="hljs-string">&quot;github.com/gin-contrib/sessions/cookie&quot;</span><br>	<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>	<span class="hljs-string">&quot;todoList.com/todoList/api&quot;</span><br>)<br><br><span class="hljs-comment">// 路由配置</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewRouter</span><span class="hljs-params">()</span></span> *gin.Engine &#123;<br>	r := gin.Default() <span class="hljs-comment">//生成了一个WSGI应用程序实例</span><br>	store := cookie.NewStore([]<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;something-very-secret&quot;</span>))<br>	r.Use(sessions.Sessions(<span class="hljs-string">&quot;mysession&quot;</span>, store))<br>	<span class="hljs-comment">// 编写分组路由</span><br>	v1 := r.Group(<span class="hljs-string">&quot;/api/v1&quot;</span>)<br>	&#123;<br>		v1.POST(<span class="hljs-string">&quot;user/register&quot;</span>, api.UserRegister)<br>	&#125;<br>	<span class="hljs-keyword">return</span> r<br>&#125;<br></code></pre></td></tr></table></figure><p>②然后再api包下建一个user.go的Controller层处理这个请求</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> api<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>	<span class="hljs-string">&quot;todoList.com/todoList/service&quot;</span><br>)<br><br><span class="hljs-comment">// 接收的是gin的上下文：*gin.Context</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">UserRegister</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>	<span class="hljs-comment">//相当于创建了一个UserRegisterService对象，调用这个对象中的Register方法。</span><br>	<span class="hljs-keyword">var</span> userRegisterService service.UserService<br>	<span class="hljs-comment">// shouldBind：上下文对UserService对象进行了绑定</span><br>	<span class="hljs-keyword">if</span> err := ctx.ShouldBind(&amp;userRegisterService); err == <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-comment">// 绑定没有失败的话，调用service中的方法进行注册</span><br>		res := userRegisterService.Register()<br>		ctx.JSON(<span class="hljs-number">200</span>, res)<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		ctx.JSON(<span class="hljs-number">400</span>, err)<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>③再service.go中实现这个被调用的方法<code>userRegisterService.Register()</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> service<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;todoList.com/todoList/model&quot;</span><br>	<span class="hljs-string">&quot;todoList.com/todoList/serializer&quot;</span><br>)<br><br><span class="hljs-comment">// UserService 用户注册服务（用于gin上下文进行参数绑定的类）</span><br><span class="hljs-keyword">type</span> UserService <span class="hljs-keyword">struct</span> &#123;<br>	UserName <span class="hljs-type">string</span> <span class="hljs-string">`form:&quot;user_name&quot; json:&quot;user_name&quot; binding:&quot;required,min=3,max=15&quot; example:&quot;FanOne&quot;`</span><br>	Password <span class="hljs-type">string</span> <span class="hljs-string">`form:&quot;password&quot; json:&quot;password&quot; binding:&quot;required,min=5,max=16&quot; example:&quot;FanOne666&quot;`</span><br>&#125;<br><br><span class="hljs-comment">// 用户注册的方法</span><br><span class="hljs-comment">// 返回值是json，所以调用了序列化包下的通用接口</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(service *UserService)</span></span> Register() serializer.Response &#123;<br>	<span class="hljs-keyword">var</span> user model.User<br>	<span class="hljs-keyword">var</span> count <span class="hljs-type">int64</span><br>	<span class="hljs-comment">// 根据绑定的用户名查找数据库是否有相同的，取一个放到user中</span><br>	model.DB.Model(&amp;model.User&#123;&#125;).Where(<span class="hljs-string">&quot;user_name = ?&quot;</span>, service.UserName).<br>		First(&amp;user).Count(&amp;count)<br>	<span class="hljs-keyword">if</span> count == <span class="hljs-number">1</span> &#123;<br>		<span class="hljs-comment">// 说明已经存在该用户名了,返回注册失败</span><br>		<span class="hljs-keyword">return</span> serializer.Response&#123;<br>			Status: <span class="hljs-number">400</span>,<br>			Msg:    <span class="hljs-string">&quot;数据库已存在该用户名!&quot;</span>,<br>		&#125;<br>	&#125;<br>	user.UserName = service.UserName<br>	<span class="hljs-comment">// 对用户的密码进行加密</span><br>	<span class="hljs-keyword">if</span> err := user.SetPassword(service.Password); err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-keyword">return</span> serializer.Response&#123; <span class="hljs-comment">// 用户密码加密错误，返回注册失败</span><br>			Status: <span class="hljs-number">400</span>,<br>			Msg:    <span class="hljs-string">&quot;用户名密码加密错误&quot;</span> + err.Error(),<br>		&#125;<br>	&#125;<br>    <br>	<span class="hljs-comment">// 往表中插入用户信息</span><br>	<span class="hljs-keyword">if</span> err := model.DB.Create(&amp;user).Error; err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-keyword">return</span> serializer.Response&#123; <span class="hljs-comment">// 插入数据库错误，返回注册失败</span><br>			Status: <span class="hljs-number">400</span>,<br>			Msg:    <span class="hljs-string">&quot;数据库操作错误&quot;</span> + err.Error(),<br>		&#125;<br>	&#125;<br>	<span class="hljs-comment">// 返回注册成功响应</span><br>	<span class="hljs-keyword">return</span> serializer.Response&#123;<br>		Status: <span class="hljs-number">200</span>,<br>		Msg:    <span class="hljs-string">&quot;用户注册成功!&quot;</span>,<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>返回类型是一个通用返回类<code>Response</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// serializer.common.go</span><br><span class="hljs-keyword">package</span> serializer<br><br><span class="hljs-comment">// 基础序列化器</span><br><span class="hljs-keyword">type</span> Response <span class="hljs-keyword">struct</span> &#123;<br>	Status <span class="hljs-type">int</span>         <span class="hljs-string">`json:&quot;status&quot;`</span><br>	Data   <span class="hljs-keyword">interface</span>&#123;&#125; <span class="hljs-string">`json:&quot;data&quot;`</span><br>	Msg    <span class="hljs-type">string</span>      <span class="hljs-string">`json:&quot;msg&quot;`</span><br>	Error  <span class="hljs-type">string</span>      <span class="hljs-string">`json:&quot;error&quot;`</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>中间涉及密码的加密<code>user.SetPassword(service.Password)</code>：写在<code>Model.user.go</code>中</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 设置密码</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(user *User)</span></span> SetPassword(password <span class="hljs-type">string</span>) <span class="hljs-type">error</span> &#123;<br>	<span class="hljs-comment">// 传入类型是[]byte, 和一个加密难度</span><br>	bytes, err := bcrypt.GenerateFromPassword([]<span class="hljs-type">byte</span>(password), <span class="hljs-number">12</span>)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-keyword">return</span> err<br>	&#125;<br>	user.PasswordDigest = <span class="hljs-type">string</span>(bytes)<br>	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-comment">// 校验密码</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(user *User)</span></span> CheckPassword(password <span class="hljs-type">string</span>) <span class="hljs-type">bool</span> &#123;<br>	err := bcrypt.CompareHashAndPassword([]<span class="hljs-type">byte</span>(user.PasswordDigest), []<span class="hljs-type">byte</span>(password))<br>	<span class="hljs-keyword">return</span> err == <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure></blockquote><p>④最后在<code>main.go</code>主函数中启动<code>gin</code>服务，并用postman进行测试</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;todoList.com/todoList/config&quot;</span><br>	<span class="hljs-string">&quot;todoList.com/todoList/routes&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	config.Init()<br>	r := routes.NewRouter()<br>	_ = r.Run(config.HttpPort) <span class="hljs-comment">// 运行在 配置文件设置的端口上</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>运行结果</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Unicorn-acc/blogimgs/imgs04/image-20230329154803851.png"></p><hr><h3 id="用户登录">2、用户登录</h3><p>和上面用户注册流程一样</p><p>①完善路由</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">v1.POST(<span class="hljs-string">&quot;user/login&quot;</span>, api.UserLogin)<br></code></pre></td></tr></table></figure><p>②<code>api.user.go</code>中实现路由方法</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">UserLogin</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>	<span class="hljs-keyword">var</span> userLogin service.UserService<br>    <span class="hljs-comment">// 将上下文数据传到用户类中</span><br>	<span class="hljs-keyword">if</span> err := ctx.ShouldBind(&amp;userLogin); err == <span class="hljs-literal">nil</span> &#123;<br>		res := userLogin.Login()<br>		ctx.JSON(<span class="hljs-number">200</span>, res)<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		ctx.JSON(<span class="hljs-number">400</span>, err)<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>③<code>service.user.go</code>中实现用户登录方法<code>userLogin.Login()</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(service *UserService)</span></span> Login() serializer.Response &#123;<br>	<span class="hljs-keyword">var</span> user model.User<br>	<span class="hljs-comment">// 1. 在数据库中查看有没有用户</span><br>	<span class="hljs-keyword">if</span> err := model.DB.Where(<span class="hljs-string">&quot;user_name = ?&quot;</span>, service.UserName).<br>		First(&amp;user).Error; err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-comment">// 当 First、Last、Take 方法找不到记录时，GORM 会返回 ErrRecordNotFound 错误，</span><br>		<span class="hljs-comment">// 可以通过对比gorm.ErrRecordNotFound进行判断，或者使用Find和Limit的组合进行查询。</span><br>		<span class="hljs-keyword">if</span> err == gorm.ErrRecordNotFound &#123;<br>			<span class="hljs-keyword">return</span> serializer.Response&#123;<br>				Status: <span class="hljs-number">400</span>,<br>				Msg:    <span class="hljs-string">&quot;用户不存在，请先注册&quot;</span>,<br>			&#125;<br>		&#125;<br>		<span class="hljs-comment">// 如果不是用户不存在，是其他不可抗拒的因素导致的错误</span><br>		<span class="hljs-keyword">return</span> serializer.Response&#123;<br>			Status: <span class="hljs-number">400</span>,<br>			Msg:    <span class="hljs-string">&quot;数据库错误&quot;</span>,<br>		&#125;<br>	&#125;<br>	<span class="hljs-comment">// 2. 用户存在，验证密码是否想用</span><br>	<span class="hljs-keyword">if</span> user.CheckPassword(service.Password) == <span class="hljs-literal">false</span> &#123;<br>		<span class="hljs-keyword">return</span> serializer.Response&#123;<br>			Status: <span class="hljs-number">400</span>,<br>			Msg:    <span class="hljs-string">&quot;密码错误&quot;</span>,<br>		&#125;<br>	&#125;<br>	<span class="hljs-comment">// 3. 用户验证通过</span><br>	<span class="hljs-comment">// 发一个token给浏览器，为了其他功能需要身份验证所给请前端存储的</span><br>	<span class="hljs-comment">// 例如：创建一个备忘录，就需要知道这是哪一个用户创建的备忘录</span><br>	token, err := util.GenerateToken(user.ID, service.UserName, <span class="hljs-number">0</span>)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-keyword">return</span> serializer.Response&#123;<br>			Status: <span class="hljs-number">500</span>,<br>			Msg:    <span class="hljs-string">&quot;Token签名分发错误&quot;</span>,<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> serializer.Response&#123;<br>		Status: <span class="hljs-number">200</span>,<br>		Data:   serializer.TokenData&#123;User: serializer.BuildUser(user), Token: token&#125;,<br>		Msg:    <span class="hljs-string">&quot;登录成功&quot;</span>,<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>中间涉及token的创建和返回Response中绑定token</p><p>①token的生成与验证</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// util.utils.go</span><br><span class="hljs-keyword">package</span> util<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;github.com/dgrijalva/jwt-go&quot;</span><br>	<span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> JWTsecret = []<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;ABAB&quot;</span>)<br><br><span class="hljs-comment">// 加密的数据（签名）</span><br><span class="hljs-keyword">type</span> Claims <span class="hljs-keyword">struct</span> &#123;<br>	Id        <span class="hljs-type">uint</span>   <span class="hljs-string">`json:&quot;id&quot;`</span><br>	Username  <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;username&quot;`</span><br>	Authority <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;authority&quot;`</span><br>	jwt.StandardClaims<br>&#125;<br><br><span class="hljs-comment">// GenerateToken 签发用户Token</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GenerateToken</span><span class="hljs-params">(id <span class="hljs-type">uint</span>, username <span class="hljs-type">string</span>, authority <span class="hljs-type">int</span>)</span></span> (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) &#123;<br>	<span class="hljs-comment">// 设置token过期时间</span><br>	nowTime := time.Now()<br>	expireTime := nowTime.Add(<span class="hljs-number">24</span> * time.Hour)<br>	claims := Claims&#123;<br>		Id:        id,<br>		Username:  username,<br>		Authority: authority,<br>		StandardClaims: jwt.StandardClaims&#123;<br>			ExpiresAt: expireTime.Unix(),<br>			Issuer:    <span class="hljs-string">&quot;to-do-list&quot;</span>,<br>		&#125;,<br>	&#125;<br>	tokenClaims := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)<br>	token, err := tokenClaims.SignedString(JWTsecret)<br>	<span class="hljs-keyword">return</span> token, err<br>&#125;<br><br><span class="hljs-comment">// ParseToken 验证用户token</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ParseToken</span><span class="hljs-params">(token <span class="hljs-type">string</span>)</span></span> (*Claims, <span class="hljs-type">error</span>) &#123;<br>	tokenClaims, err := jwt.ParseWithClaims(token, &amp;Claims&#123;&#125;, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(token *jwt.Token)</span></span> (<span class="hljs-keyword">interface</span>&#123;&#125;, <span class="hljs-type">error</span>) &#123;<br>		<span class="hljs-keyword">return</span> JWTsecret, <span class="hljs-literal">nil</span><br>	&#125;)<br>	<span class="hljs-keyword">if</span> tokenClaims != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-keyword">if</span> claims, ok := tokenClaims.Claims.(*Claims); ok &amp;&amp; tokenClaims.Valid &#123;<br>			<span class="hljs-keyword">return</span> claims, <span class="hljs-literal">nil</span><br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>&#125;<br></code></pre></td></tr></table></figure><p>②返回结果中绑定token</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//Data:   serializer.TokenData&#123;User: serializer.BuildUser(user), Token: token&#125;,</span><br><span class="hljs-comment">// serializer.user.go</span><br><span class="hljs-keyword">package</span> serializer<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;todoList.com/todoList/model&quot;</span><br><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>	ID       <span class="hljs-type">uint</span>   <span class="hljs-string">`json:&quot;id&quot; form:&quot;id&quot; example:&quot;1&quot;`</span>                    <span class="hljs-comment">// 用户ID</span><br>	UserName <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;user_name&quot; form:&quot;user_name&quot; example:&quot;FanOne&quot;`</span> <span class="hljs-comment">// 用户名</span><br>	CreateAt <span class="hljs-type">int64</span>  <span class="hljs-string">`json:&quot;create_at&quot; form:&quot;create_at&quot;`</span>                  <span class="hljs-comment">// 创建</span><br>&#125;<br><br><span class="hljs-comment">// BuildUser 序列化用户</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BuildUser</span><span class="hljs-params">(user model.User)</span></span> User &#123;<br>	<span class="hljs-keyword">return</span> User&#123;<br>		ID:       user.ID,<br>		UserName: user.UserName,<br>		CreateAt: user.CreatedAt.Unix(),<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></blockquote><p>运行结果</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Unicorn-acc/blogimgs/imgs04/image-20230329162336924.png" style="zoom:80%"></p><h2 id="五jwt中间件">五、JWT中间件</h2><p>随着前后端分离的发展，以及数据中心的建立，越来越多的公司会创建一个中心服务器，服务于各种产品线。</p><p>而这些产品线上的产品，它们可能有着各种终端设备，包括但不仅限于浏览器、桌面应用、移动端应用、平板应用、甚至智能家居</p><p>实际上，不同的产品线通常有自己的服务器，产品内部的数据一般和自己的服务器交互。</p><p>但中心服务器仍然有必要存在，因为同一家公司的产品总是会存在共享的数据，比如用户数据</p><p>这些设备与中心服务器之间会进行http通信</p><p>一般来说，中心服务器至少承担着认证和授权的功能，例如登录：各种设备发送消息到中心服务器，然后中心服务器响应一个身份令牌</p><p>当这种结构出现后，就出现一个问题：<strong>它们之间还能使用传统的cookie方式传递令牌信息吗？</strong></p><p>其实，也是可以的，因为cookie在传输中无非是一个消息头而已，只不过浏览器对这个消息头有特殊处理罢了。</p><p>但浏览器之外的设备肯定不喜欢cookie，因为浏览器有着对cookie完善的管理机制，但是在其他设备上，就需要开发者自己手动处理了</p><p>jwt的出现就是为了解决这个问题</p><hr><p>jwt全称<code>Json Web Token</code>，强行翻译过来就是<code>json格式的互联网令牌</code></p><p>它要解决的问题，就是为多种终端设备，提供<strong>统一的、安全的</strong>令牌格式</p><p><strong>jwt只是一个令牌格式而已，你可以把它存储到cookie，也可以存储到localstorage，没有任何限制！</strong></p><p>同样的，对于传输，你可以使用任何传输方式来传输jwt，一般来说，我们会使用消息头来传输它</p><p>比如，当登录成功后，服务器可以给客户端响应一个jwt：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK<br>...<br>set-cookie:token=jwt令牌<br>authorization:jwt令牌<br>...<br><br><span class="language-css">&#123;..., token:jwt令牌&#125;</span><br></code></pre></td></tr></table></figure><p>可以看到，jwt令牌可以出现在响应的任何一个地方，客户端和服务器自行约定即可。</p><blockquote><p>当然，它也可以出现在响应的多个地方，比如为了充分利用浏览器的cookie，同时为了照顾其他设备，也可以让jwt出现在set-cookie和authorization或body中，尽管这会增加额外的传输量。</p></blockquote><p>当客户端拿到令牌后，它要做的只有一件事：存储它。</p><p>你可以存储到任何位置，比如手机文件、PC文件、localstorage、cookie</p><p>当后续请求发生时，你只需要将它作为请求的一部分发送到服务器即可。</p><p>虽然jwt没有明确要求应该如何附带到请求中，但通常我们会使用如下的格式：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/api/resources</span> <span class="hljs-meta">HTTP/1.1</span><br>...<br><span class="hljs-attribute">authorization</span><span class="hljs-punctuation">: </span>bearer jwt令牌<br>...<br></code></pre></td></tr></table></figure><hr><p>引入JWT模块，要实现用户身份认证</p><p>① 在<code>routes.routes.go</code>中进行请求的拦截</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> routes<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;github.com/gin-contrib/sessions&quot;</span><br>	<span class="hljs-string">&quot;github.com/gin-contrib/sessions/cookie&quot;</span><br>	<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>	<span class="hljs-string">&quot;todoList.com/todoList/api&quot;</span><br>	<span class="hljs-string">&quot;todoList.com/todoList/middleware&quot;</span><br>)<br><br><span class="hljs-comment">// 路由配置</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewRouter</span><span class="hljs-params">()</span></span> *gin.Engine &#123;<br>	r := gin.Default() <span class="hljs-comment">//生成了一个WSGI应用程序实例</span><br>	store := cookie.NewStore([]<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;something-very-secret&quot;</span>))<br>	r.Use(sessions.Sessions(<span class="hljs-string">&quot;mysession&quot;</span>, store))<br>	<span class="hljs-comment">// 编写分组路由</span><br>	v1 := r.Group(<span class="hljs-string">&quot;/api/v1&quot;</span>)<br>	&#123;<br>		v1.POST(<span class="hljs-string">&quot;user/register&quot;</span>, api.UserRegister)<br>		v1.POST(<span class="hljs-string">&quot;user/login&quot;</span>, api.UserLogin)<br>        <span class="hljs-comment">/////////////////////////////////////////</span><br>		authed := v1.Group(<span class="hljs-string">&quot;/&quot;</span>)<br>        <span class="hljs-comment">// 进行权限验证，验证通过才有权限进行访问下面的路由</span><br>		authed.Use(middleware.JWT()) <br>		&#123;<br>			authed.POST(<span class="hljs-string">&quot;task&quot;</span>, api.CreateTask)<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> r<br>&#125;<br></code></pre></td></tr></table></figure><p>②<code>JWT()</code>实现的具体方法：<strong>验证Token</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// middleware.JWT()</span><br><span class="hljs-keyword">package</span> middleware<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>	<span class="hljs-string">&quot;time&quot;</span><br>	<span class="hljs-string">&quot;todoList.com/todoList/pkg/util&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">JWT</span><span class="hljs-params">()</span></span> gin.HandlerFunc &#123;<br>	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>		<span class="hljs-keyword">var</span> code <span class="hljs-type">int</span><br>		token := c.GetHeader(<span class="hljs-string">&quot;Authorization&quot;</span>)<br>		<span class="hljs-keyword">if</span> token == <span class="hljs-string">&quot;&quot;</span> &#123;<br>			code = <span class="hljs-number">400</span> <span class="hljs-comment">// 返回400， 因为传入的token不对</span><br>		&#125; <span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-comment">// 对token进行解析</span><br>			claim, err := util.ParseToken(token)<br>			<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>				code = <span class="hljs-number">403</span> <span class="hljs-comment">// forbid, token解析有误，无权限，是假的</span><br>			&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> time.Now().Unix() &gt; claim.ExpiresAt &#123;<br>				code = <span class="hljs-number">401</span> <span class="hljs-comment">// Token无效，已经国企了</span><br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">if</span> code != <span class="hljs-number">200</span> &#123;<br>			c.JSON(<span class="hljs-number">400</span>, gin.H&#123;<br>				<span class="hljs-string">&quot;status&quot;</span>: code,<br>				<span class="hljs-string">&quot;msg&quot;</span>:    <span class="hljs-string">&quot;Token解析错误&quot;</span>,<br>			&#125;)<br>			c.Abort()<br>			<span class="hljs-keyword">return</span><br>		&#125;<br>		c.Next()<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p></p><h2 id="六创建备忘录增">六、创建备忘录（增）</h2><p>创建过程和user的创建过程相同</p><p>① routers.routers.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">authed.Use(middleware.JWT()) <span class="hljs-comment">// 进行权限验证，验证通过才有权限进行访问下面的路由</span><br>&#123;<br>    authed.POST(<span class="hljs-string">&quot;task&quot;</span>, api.CreateTask)<br>&#125;<br></code></pre></td></tr></table></figure><p>② <code>api.tasks.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> api<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>	<span class="hljs-string">&quot;log&quot;</span><br>	<span class="hljs-string">&quot;todoList.com/todoList/pkg/util&quot;</span><br>	<span class="hljs-string">&quot;todoList.com/todoList/service&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CreateTask</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>	<span class="hljs-keyword">var</span> createTaskservice service.CreateTaskService<br>	<span class="hljs-comment">// 进行身份的验证</span><br>	claim, _ := util.ParseToken(c.GetHeader(<span class="hljs-string">&quot;Authorization&quot;</span>))<br><br>	<span class="hljs-keyword">if</span> err := c.ShouldBind(&amp;createTaskservice); err == <span class="hljs-literal">nil</span> &#123;<br>		res := createTaskservice.Create(claim.Id)<br>		c.JSON(<span class="hljs-number">200</span>, res)<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		c.JSON(<span class="hljs-number">400</span>, err)<br>		log.Println(<span class="hljs-string">&quot;createTask err : &quot;</span>, err)<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>③<code>service.task.go</code>创建一个接收参数的服务类，然后实现Create方法</p><blockquote><p>这里犯了一个错误：<font color="red"> 在给结构体属性加<code>tag</code>的时候<code>json:"title"</code>的<code>:</code>中间不能有空格，也就是<code>tag</code>部分不能是灰色的，不然属性就赋值不上，而且<code>err</code>还是为<code>nil</code></font></p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> service<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;time&quot;</span><br>	<span class="hljs-string">&quot;todoList.com/todoList/model&quot;</span><br>	<span class="hljs-string">&quot;todoList.com/todoList/serializer&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> CreateTaskService <span class="hljs-keyword">struct</span> &#123;<br>	Title   <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;title&quot; form:&quot;title&quot;`</span><br>	Content <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;content&quot; form:&quot;content&quot;`</span><br>	Status  <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;status&quot; form:&quot;status&quot;`</span> <span class="hljs-comment">// 0未做 1已做</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(service *CreateTaskService)</span></span> Create(id <span class="hljs-type">uint</span>) serializer.Response &#123;<br>	<span class="hljs-keyword">var</span> user model.User<br>	model.DB.First(&amp;user, id)<br>	task := model.Task&#123;<br>		User:      user,<br>		Uid:       user.ID,<br>		Title:     service.Title,<br>		Content:   service.Content,<br>		Status:    <span class="hljs-number">0</span>,<br>		StartTime: time.Now().Unix(),<br>	&#125;<br>	code := <span class="hljs-number">200</span><br>	err := model.DB.Create(&amp;task).Error<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		code = <span class="hljs-number">500</span><br>		<span class="hljs-keyword">return</span> serializer.Response&#123;<br>			Status: code,<br>			Msg:    <span class="hljs-string">&quot;创建备忘录失败&quot;</span>,<br>			Error:  err.Error(),<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> serializer.Response&#123;<br>		Status: code,<br>		Data:   serializer.BuildTask(task),<br>		Msg:    <span class="hljs-string">&quot;创建备忘录成功&quot;</span>,<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>运行结果</p><ul><li>请求头中要设置<code>Authorization:&#123;&#123;token&#125;&#125;</code>，其中<code>token</code>是<code>postman</code>中设置的环境变量，是用户登录成功后返回给浏览器的<code>token</code></li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Unicorn-acc/blogimgs/imgs04/image-20230329184949111.png" style="zoom:67%"></p><blockquote><p>错误的结果：<code>title</code>和<code>content</code>没有内容，<code>gin</code>框架没有成功对结构体进行赋值</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Unicorn-acc/blogimgs/imgs04/image-20230329171923826.png" style="zoom:67%"></p></blockquote><hr><h2 id="七展示一条备忘录查">七、展示一条备忘录（查）</h2><p>① 建立路由：<code>routes.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewRouter</span><span class="hljs-params">()</span></span> *gin.Engine &#123;<br>	r := gin.Default() <span class="hljs-comment">//生成了一个WSGI应用程序实例</span><br>	store := cookie.NewStore([]<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;something-very-secret&quot;</span>))<br>	r.Use(sessions.Sessions(<span class="hljs-string">&quot;mysession&quot;</span>, store))<br>	<span class="hljs-comment">// 编写分组路由</span><br>	v1 := r.Group(<span class="hljs-string">&quot;/api/v1&quot;</span>)<br>	&#123;<br>		v1.POST(<span class="hljs-string">&quot;user/register&quot;</span>, api.UserRegister)<br>		v1.POST(<span class="hljs-string">&quot;user/login&quot;</span>, api.UserLogin)<br>		authed := v1.Group(<span class="hljs-string">&quot;/&quot;</span>)<br>		authed.Use(middleware.JWT()) <span class="hljs-comment">// 进行权限验证，验证通过才有权限进行访问下面的路由</span><br>		&#123;<br>			authed.POST(<span class="hljs-string">&quot;task&quot;</span>, api.CreateTask)<br>         <span class="hljs-comment">//////////////////////////</span><br>         <span class="hljs-comment">// 这一条</span><br>         <span class="hljs-comment">//////////////////////////</span><br>			authed.GET(<span class="hljs-string">&quot;task/:id&quot;</span>, api.GetTaskById)<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> r<br>&#125;<br></code></pre></td></tr></table></figure><p>②实现处理路由的方法 <code>api.tasks.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetTaskById</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>	<span class="hljs-keyword">var</span> GetTaskservice service.ShowTaskService<br>	<span class="hljs-comment">// 进行身份的验证</span><br>	claim, _ := util.ParseToken(c.GetHeader(<span class="hljs-string">&quot;Authorization&quot;</span>))<br><br>	<span class="hljs-keyword">if</span> err := c.ShouldBind(&amp;GetTaskservice); err == <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-comment">// claim.Id是token中取到的用户id， c.Param(&quot;id&quot;)是前端传递的参数：备忘录id</span><br>		res := GetTaskservice.GetById(claim.Id, c.Param(<span class="hljs-string">&quot;id&quot;</span>))<br>		c.JSON(<span class="hljs-number">200</span>, res)<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		c.JSON(<span class="hljs-number">400</span>, err)<br>		log.Println(<span class="hljs-string">&quot;createTask err : &quot;</span>, err)<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>③实现一个<code>GetTaskservice</code>服务类，然后定义该类的方法，该类中没有任何属性（因为是<code>get</code>请求）</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> ShowTaskService <span class="hljs-keyword">struct</span> &#123;<br>	<span class="hljs-comment">// Get请求，因此这个服务内容是空的</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(service *ShowTaskService)</span></span> GetById(uid <span class="hljs-type">uint</span>, tid <span class="hljs-type">string</span>) serializer.Response &#123;<br>	<span class="hljs-comment">// 1.查询到备忘录信息</span><br>	<span class="hljs-keyword">var</span> task model.Task<br>	code := <span class="hljs-number">200</span><br>	err := model.DB.First(&amp;task, tid).Error<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		code = <span class="hljs-number">500</span><br>		<span class="hljs-keyword">return</span> serializer.Response&#123;<br>			Status: code,<br>			Msg:    <span class="hljs-string">&quot;查询备忘录失败&quot;</span>,<br>		&#125;<br>	&#125;<br>	<span class="hljs-comment">// 如果查询的备忘录不是当前用户的，返回查询失败</span><br>	<span class="hljs-keyword">if</span> task.Uid != uid &#123;<br>		code = <span class="hljs-number">500</span><br>		<span class="hljs-keyword">return</span> serializer.Response&#123;<br>			Status: code,<br>			Msg:    <span class="hljs-string">&quot;未查询到当前用户的备忘录信息&quot;</span>,<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> serializer.Response&#123;<br>		Status: code,<br>		Data:   serializer.BuildTask(task),<br>		Msg:    <span class="hljs-string">&quot;查询成功&quot;</span>,<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>涉及到一个序列化 <code>Data: serializer.BuildTask(task),</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> serializer<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;todoList.com/todoList/model&quot;</span><br><br><span class="hljs-keyword">type</span> Task <span class="hljs-keyword">struct</span> &#123;<br>	ID      <span class="hljs-type">uint</span>   <span class="hljs-string">`json:&quot;id&quot; example:&quot;1&quot;`</span>       <span class="hljs-comment">// 任务ID</span><br>	Title   <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;title&quot; example:&quot;吃饭&quot;`</span>   <span class="hljs-comment">// 题目</span><br>	Content <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;content&quot; example:&quot;睡觉&quot;`</span> <span class="hljs-comment">// 内容</span><br>	<span class="hljs-comment">// View      uint64 `json:&quot;view&quot; example:&quot;32&quot;`    // 浏览量</span><br>	Status    <span class="hljs-type">int</span>   <span class="hljs-string">`json:&quot;status&quot; example:&quot;0&quot;`</span> <span class="hljs-comment">// 状态(0未完成，1已完成)</span><br>	CreatedAt <span class="hljs-type">int64</span> <span class="hljs-string">`json:&quot;created_at&quot;`</span><br>	StartTime <span class="hljs-type">int64</span> <span class="hljs-string">`json:&quot;start_time&quot;`</span><br>	EndTime   <span class="hljs-type">int64</span> <span class="hljs-string">`json:&quot;end_time&quot;`</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BuildTask</span><span class="hljs-params">(item model.Task)</span></span> Task &#123;<br>	<span class="hljs-keyword">return</span> Task&#123;<br>		ID:      item.ID,<br>		Title:   item.Title,<br>		Content: item.Content,<br>		Status:  item.Status,<br>		<span class="hljs-comment">// View:      item.View(),</span><br>		CreatedAt: item.CreatedAt.Unix(),<br>		StartTime: item.StartTime,<br>		EndTime:   item.EndTime,<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Unicorn-acc/blogimgs/imgs04/image-20230329180458170.png"></p><h2 id="八展示所有的备忘录查">八、展示所有的备忘录（查）</h2><p>①<code>routes.go</code>写路由</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">authed.GET(<span class="hljs-string">&quot;tasks&quot;</span>, api.GetAllTaskById)<br></code></pre></td></tr></table></figure><p>② <code>api.tasks.go</code> 写处理函数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetAllTaskById</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>	<span class="hljs-keyword">var</span> getListTaskService service.GetListTaskService<br>	<span class="hljs-comment">// 进行身份的验证</span><br>	claim, _ := util.ParseToken(c.GetHeader(<span class="hljs-string">&quot;Authorization&quot;</span>))<br>    <span class="hljs-comment">// 绑定pagesize 和 pagenum 参数</span><br>	<span class="hljs-keyword">if</span> err := c.ShouldBind(&amp;getListTaskService); err == <span class="hljs-literal">nil</span> &#123;<br>		res := getListTaskService.GetAllById(claim.Id)<br>		c.JSON(<span class="hljs-number">200</span>, res)<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		c.JSON(<span class="hljs-number">400</span>, err)<br>		log.Println(<span class="hljs-string">&quot;GetAllTaskById err : &quot;</span>, err)<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>③ service.task.go 实现查询服务</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> GetListTaskService <span class="hljs-keyword">struct</span> &#123;<br>	PageNum  <span class="hljs-type">int</span> <span class="hljs-string">`json:&quot;page_num&quot; form:&quot;page_num&quot;`</span><br>	PageSize <span class="hljs-type">int</span> <span class="hljs-string">`json:&quot;page_size&quot; form:&quot;page_size&quot;`</span><br>&#125;<br><br><span class="hljs-comment">// 展示用户的所有备忘录</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(service *GetListTaskService)</span></span> GetAllById(uid <span class="hljs-type">uint</span>) serializer.Response &#123;<br>	<span class="hljs-keyword">var</span> tasks []model.Task<br>	<span class="hljs-keyword">var</span> count <span class="hljs-type">int64</span> = <span class="hljs-number">0</span><br>	<span class="hljs-keyword">if</span> service.PageSize == <span class="hljs-number">0</span> &#123;<br>		service.PageSize = <span class="hljs-number">15</span> <span class="hljs-comment">// 如果传来的页面大小是0，默认为15</span><br>	&#125;<br>	<span class="hljs-comment">// 多表查询</span><br>	<span class="hljs-comment">// 先找到是哪一个user，聚合函数查看一共多少条，然后进行分页操作</span><br>	model.DB.Model(&amp;model.Task&#123;&#125;).Preload(<span class="hljs-string">&quot;User&quot;</span>).Where(<span class="hljs-string">&quot;uid = ?&quot;</span>, uid).Count(&amp;count).<br>		Limit(service.PageSize).Offset((service.PageNum - <span class="hljs-number">1</span>) * service.PageSize).Find(&amp;tasks)<br>	<span class="hljs-comment">// 返回带数量的列表响应</span><br>	<span class="hljs-keyword">return</span> serializer.BuildListResponse(serializer.BuildTasks(tasks), <span class="hljs-type">uint</span>(count))<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>涉及到带数量的列表响应</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//serializer.BuildListResponse:</span><br><span class="hljs-comment">// BulidListResponse 带有总数的列表构建器</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BuildListResponse</span><span class="hljs-params">(items <span class="hljs-keyword">interface</span>&#123;&#125;, total <span class="hljs-type">uint</span>)</span></span> Response &#123;<br>	<span class="hljs-keyword">return</span> Response&#123;<br>		Status: <span class="hljs-number">200</span>,<br>		Data: DataList&#123;<br>			Item:  items,<br>			Total: total,<br>		&#125;,<br>		Msg: <span class="hljs-string">&quot;ok&quot;</span>,<br>	&#125;<br>&#125;<br><br><span class="hljs-comment">// serializer.BuildTasks(tasks)</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BuildTasks</span><span class="hljs-params">(items []model.Task)</span></span> (tasks []Task) &#123;<br>	<span class="hljs-keyword">for</span> _, item := <span class="hljs-keyword">range</span> items &#123;<br>		task := BuildTask(item)<br>		tasks = <span class="hljs-built_in">append</span>(tasks, task)<br>	&#125;<br>	<span class="hljs-keyword">return</span> tasks<br>&#125;<br></code></pre></td></tr></table></figure></blockquote><p>运行结果</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Unicorn-acc/blogimgs/imgs04/image-20230329180527968.png" style="zoom:80%"></p><hr><h2 id="九更新备忘录改">九、更新备忘录（改）</h2><p>和前面相同的步骤</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//routes.go</span><br>authed.PUT(<span class="hljs-string">&quot;task/:id&quot;</span>, api.UpdateTaskById)<br><br><span class="hljs-comment">// api.tasks.go</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">UpdateTaskById</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>	<span class="hljs-keyword">var</span> updateTaskservice service.UpdateTaskService<br>	<span class="hljs-keyword">if</span> err := c.ShouldBind(&amp;updateTaskservice); err == <span class="hljs-literal">nil</span> &#123;<br>		res := updateTaskservice.UpdateById(c.Param(<span class="hljs-string">&quot;id&quot;</span>))<br>		c.JSON(<span class="hljs-number">200</span>, res)<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		c.JSON(<span class="hljs-number">400</span>, err)<br>		log.Println(<span class="hljs-string">&quot;createTask err : &quot;</span>, err)<br>	&#125;<br>&#125;<br><br><span class="hljs-comment">// service.task.go</span><br><span class="hljs-keyword">type</span> UpdateTaskService <span class="hljs-keyword">struct</span> &#123;<br>	Title   <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;title&quot; form:&quot;title&quot;`</span><br>	Content <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;content&quot; form:&quot;content&quot;`</span><br>	Status  <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;status&quot; form:&quot;status&quot;`</span> <span class="hljs-comment">// 0未做 1已做</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(service *UpdateTaskService)</span></span> UpdateById(id <span class="hljs-type">string</span>) serializer.Response &#123;<br>	<span class="hljs-keyword">var</span> task model.Task<br>	model.DB.First(&amp;task, id)<br>	task.Content = service.Content<br>	task.Title = service.Title<br>	task.Status = service.Status<br>	err := model.DB.Save(&amp;task).Error<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-keyword">return</span> serializer.Response&#123;<br>			Status: <span class="hljs-number">400</span>,<br>			Msg:    <span class="hljs-string">&quot;更新失败&quot;</span>,<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> serializer.Response&#123;<br>		Status: <span class="hljs-number">200</span>,<br>		Msg:    <span class="hljs-string">&quot;更新成功&quot;</span>,<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>执行结果：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Unicorn-acc/blogimgs/imgs04/image-20230329211231978.png" style="zoom:80%"></p><hr><h2 id="十查询备忘录查">十、查询备忘录（查）</h2><p>和查询单条备忘录差不多，主要这便是<strong>模糊查询</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// routes.go</span><br>authed.POST(<span class="hljs-string">&quot;search&quot;</span>, api.SearchTask)<br><br><span class="hljs-comment">// api.task.go</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SearchTask</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>	<span class="hljs-keyword">var</span> searchTaskservice service.SearchTaskService<br>	<span class="hljs-comment">// 进行身份的验证</span><br>	claim, _ := util.ParseToken(c.GetHeader(<span class="hljs-string">&quot;Authorization&quot;</span>))<br><br>	<span class="hljs-keyword">if</span> err := c.ShouldBind(&amp;searchTaskservice); err == <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-comment">// claim.Id是token中取到的用户id， c.Param(&quot;id&quot;)是前端传递的参数：备忘录id</span><br>		res := searchTaskservice.Search(claim.Id)<br>		c.JSON(<span class="hljs-number">200</span>, res)<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		c.JSON(<span class="hljs-number">400</span>, err)<br>		log.Println(<span class="hljs-string">&quot;SearchTask err : &quot;</span>, err)<br>	&#125;<br>&#125;<br><br><span class="hljs-comment">// service.tasks.go</span><br><span class="hljs-keyword">type</span> SearchTaskService <span class="hljs-keyword">struct</span> &#123;<br>	Info     <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;info&quot; form:&quot;info&quot;`</span><br>	PageNum  <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;page_num&quot; form:&quot;page_num&quot;`</span><br>	PageSize <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;page_size&quot; form:&quot;page_size&quot;`</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(service *SearchTaskService)</span></span> Search(id <span class="hljs-type">uint</span>) serializer.Response &#123;<br>	<span class="hljs-keyword">if</span> service.PageSize == <span class="hljs-number">0</span> &#123;<br>		service.PageSize = <span class="hljs-number">15</span><br>	&#125;<br>	<span class="hljs-keyword">var</span> tasks []model.Task<br>	<span class="hljs-keyword">var</span> count <span class="hljs-type">int64</span><br>	<span class="hljs-comment">//1. 先预加载用户</span><br>	model.DB.Model(&amp;model.Task&#123;&#125;).Preload(<span class="hljs-string">&quot;User&quot;</span>).Where(<span class="hljs-string">&quot;uid = ?&quot;</span>, id).<br>		<span class="hljs-comment">// 在用户的基础上搜索内容或者标题</span><br>		Where(<span class="hljs-string">&quot;title Like ? OR content like ?&quot;</span>, <span class="hljs-string">&quot;%&quot;</span>+service.Info+<span class="hljs-string">&quot;%&quot;</span>, <span class="hljs-string">&quot;%&quot;</span>+service.Info+<span class="hljs-string">&quot;%&quot;</span>).<br>		<span class="hljs-comment">// 计数 + 分页后赋值到tasks里</span><br>		Count(&amp;count).Limit(service.PageSize).Offset((service.PageNum - <span class="hljs-number">1</span>) * service.PageSize).Find(&amp;tasks)<br>	<span class="hljs-keyword">return</span> serializer.BuildListResponse(serializer.BuildTasks(tasks), <span class="hljs-type">uint</span>(count))<br>&#125;<br></code></pre></td></tr></table></figure><p>执行结果：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Unicorn-acc/blogimgs/imgs04/image-20230329212614938.png"></p><hr><h2 id="十一删除备忘录删">十一、删除备忘录（删）</h2><p>和前面一样</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 路由配置</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewRouter</span><span class="hljs-params">()</span></span> *gin.Engine &#123;<br>	r := gin.Default() <span class="hljs-comment">//生成了一个WSGI应用程序实例</span><br>	store := cookie.NewStore([]<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;something-very-secret&quot;</span>))<br>	r.Use(sessions.Sessions(<span class="hljs-string">&quot;mysession&quot;</span>, store))<br>	<span class="hljs-comment">// 编写分组路由</span><br>	v1 := r.Group(<span class="hljs-string">&quot;/api/v1&quot;</span>)<br>	&#123;<br>		v1.POST(<span class="hljs-string">&quot;user/register&quot;</span>, api.UserRegister)<br>		v1.POST(<span class="hljs-string">&quot;user/login&quot;</span>, api.UserLogin)<br>		authed := v1.Group(<span class="hljs-string">&quot;/&quot;</span>)<br>		authed.Use(middleware.JWT()) <span class="hljs-comment">// 进行权限验证，验证通过才有权限进行访问下面的路由</span><br>		&#123;<br>			authed.POST(<span class="hljs-string">&quot;task&quot;</span>, api.CreateTask)<br>			authed.GET(<span class="hljs-string">&quot;task/:id&quot;</span>, api.GetTaskById)<br>			authed.GET(<span class="hljs-string">&quot;tasks&quot;</span>, api.GetAllTaskById)<br>			authed.PUT(<span class="hljs-string">&quot;task/:id&quot;</span>, api.UpdateTaskById)<br>			authed.POST(<span class="hljs-string">&quot;search&quot;</span>, api.SearchTask)<br>			authed.DELETE(<span class="hljs-string">&quot;task/:id&quot;</span>, api.DeleteTask)<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> r<br>&#125;<br><br><br><span class="hljs-comment">//api.task.go</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DeleteTask</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>	<span class="hljs-keyword">var</span> deleteTaskservice service.DeleteTaskService<br><br>	<span class="hljs-keyword">if</span> err := c.ShouldBind(&amp;deleteTaskservice); err == <span class="hljs-literal">nil</span> &#123;<br>		res := deleteTaskservice.Delete(c.Param(<span class="hljs-string">&quot;id&quot;</span>))<br>		c.JSON(<span class="hljs-number">200</span>, res)<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		c.JSON(<span class="hljs-number">400</span>, err)<br>		log.Println(<span class="hljs-string">&quot;DeleteTask err : &quot;</span>, err)<br>	&#125;<br><br>&#125;<br><br><span class="hljs-comment">// service.task.go</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(service *DeleteTaskService)</span></span> Delete(id <span class="hljs-type">string</span>) serializer.Response &#123;<br>	<span class="hljs-keyword">var</span> task model.Task<br>	err := model.DB.Delete(&amp;task, id).Error<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-keyword">return</span> serializer.Response&#123;<br>			Status: <span class="hljs-number">400</span>,<br>			Msg:    <span class="hljs-string">&quot;删除失败&quot;</span>,<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> serializer.Response&#123;<br>		Status: <span class="hljs-number">200</span>,<br>		Msg:    <span class="hljs-string">&quot;删除成功&quot;</span>,<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Unicorn-acc/blogimgs/imgs04/image-20230329213509861.png"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Unicorn-acc/blogimgs/imgs04/image-20230329213543187.png"></p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://Unicorn-acc.github.io">Miraclo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://unicorn-acc.github.io/posts/43853.html">http://unicorn-acc.github.io/posts/43853.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://Unicorn-acc.github.io" target="_blank">Miraclo</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Golang/">Golang</a></div><div class="post_share"><div class="social-share" data-image="https://w.wallhaven.cc/full/vq/wallhaven-vqmyq3.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/16215.html"><img class="prev-cover" src="https://w.wallhaven.cc/full/zy/wallhaven-zyxvqy.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">【Golang GMP调度模型】协程调度器原理及GMP设计思想</div></div></a></div><div class="next-post pull-right"><a href="/posts/49550.html"><img class="next-cover" src="https://w.wallhaven.cc/full/1p/wallhaven-1pjml1.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">【GoWeb框架-Gorm框架】快速入门、模型定义、增删改查、事务和Hook、socpe\智能选择字段\子查询\关联操作</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/16244.html" title="【Golang 快速入门3】Go Modules + 生态拓展"><img class="cover" src="https://w.wallhaven.cc/full/1p/wallhaven-1pjml1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-24</div><div class="title">【Golang 快速入门3】Go Modules + 生态拓展</div></div></a></div><div><a href="/posts/23688.html" title="【GoWeb框架-Gin框架】路由、请求参数、响应、模板渲染、会话、中间件"><img class="cover" src="https://w.wallhaven.cc/full/zy/wallhaven-zyxvqy.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-28</div><div class="title">【GoWeb框架-Gin框架】路由、请求参数、响应、模板渲染、会话、中间件</div></div></a></div><div><a href="/posts/25056.html" title="【Golang GC垃圾回收机制】三色标记法、混合写屏障机制"><img class="cover" src="https://w.wallhaven.cc/full/kx/wallhaven-kx3p1q.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-26</div><div class="title">【Golang GC垃圾回收机制】三色标记法、混合写屏障机制</div></div></a></div><div><a href="/posts/16215.html" title="【Golang GMP调度模型】协程调度器原理及GMP设计思想"><img class="cover" src="https://w.wallhaven.cc/full/zy/wallhaven-zyxvqy.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-29</div><div class="title">【Golang GMP调度模型】协程调度器原理及GMP设计思想</div></div></a></div><div><a href="/posts/53840.html" title="【Golang 快速入门2】高级语法：反射 + 并发"><img class="cover" src="https://w.wallhaven.cc/full/zy/wallhaven-zyxvqy.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-24</div><div class="title">【Golang 快速入门2】高级语法：反射 + 并发</div></div></a></div><div><a href="/posts/35945.html" title="【Go爬虫】Go爬取静态数据、动态数据、并发爬取"><img class="cover" src="https://w.wallhaven.cc/full/x6/wallhaven-x619o3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-26</div><div class="title">【Go爬虫】Go爬取静态数据、动态数据、并发爬取</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#gingorm%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E5%A4%87%E5%BF%98%E5%BD%95"><span class="toc-text">Gin+Gorm实现简单备忘录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D"><span class="toc-text">项目主要功能介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">一、项目初始化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5"><span class="toc-text">二、项目配置和数据库连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BB%BA%E8%A1%A8"><span class="toc-text">三、数据库建表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E4%B8%8E%E7%99%BB%E5%BD%95"><span class="toc-text">四、用户注册与登录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD"><span class="toc-text">1、用户注册功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95"><span class="toc-text">2、用户登录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94jwt%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">五、JWT中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E5%88%9B%E5%BB%BA%E5%A4%87%E5%BF%98%E5%BD%95%E5%A2%9E"><span class="toc-text">六、创建备忘录（增）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E5%B1%95%E7%A4%BA%E4%B8%80%E6%9D%A1%E5%A4%87%E5%BF%98%E5%BD%95%E6%9F%A5"><span class="toc-text">七、展示一条备忘录（查）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E5%B1%95%E7%A4%BA%E6%89%80%E6%9C%89%E7%9A%84%E5%A4%87%E5%BF%98%E5%BD%95%E6%9F%A5"><span class="toc-text">八、展示所有的备忘录（查）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E6%9B%B4%E6%96%B0%E5%A4%87%E5%BF%98%E5%BD%95%E6%94%B9"><span class="toc-text">九、更新备忘录（改）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E6%9F%A5%E8%AF%A2%E5%A4%87%E5%BF%98%E5%BD%95%E6%9F%A5"><span class="toc-text">十、查询备忘录（查）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E5%88%A0%E9%99%A4%E5%A4%87%E5%BF%98%E5%BD%95%E5%88%A0"><span class="toc-text">十一、删除备忘录（删）</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By Miraclo</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">人只有在走上坡路的时候才会累和迷茫。</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if(window.MathJax)MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset();else{window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"ams"},chtml:{scale:1.1},options:{renderActions:{findScript:[10,t=>{for(const n of document.querySelectorAll('script[type^="math/tex"]')){var e=!!n.type.match(/; *mode=display/),e=new t.options.MathItem(n.textContent,t.inputJax[0],e),a=document.createTextNode("");n.parentNode.replaceChild(a,n),e.start={node:a,delim:"",n:0},e.end={node:a,delim:"",n:0},t.math.push(e)}},""],insertScript:[200,()=>{document.querySelectorAll("mjx-container").forEach(t=>{t.hasAttribute("display")?btf.wrap(t,"div",{class:"mathjax-overflow"}):btf.wrap(t,"span",{class:"mathjax-overflow"})})},"",!1]}}};const a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js",a.id="MathJax-script",a.async=!0,document.head.appendChild(a)}</script></div><link rel="stylesheet" href="/css/Lete.css"><script src="/js/custom.js"></script><script src="/js/mouth.js"></script><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div class="js-pjax"><script async>for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration","1s"),arr[i].setAttribute("data-wow-delay","1ms"),arr[i].setAttribute("data-wow-offset","100"),arr[i].setAttribute("data-wow-iteration","1")</script><script async>for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script></body></html>
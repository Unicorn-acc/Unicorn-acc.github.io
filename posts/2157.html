<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>MySQL_10进阶_索引 | Miraclo</title><meta name="author" content="Miraclo"><meta name="copyright" content="Miraclo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MySQL 索引 在Linux系统上安装MySQL8.0  准备一台Linux服务器  Linux的版本为CentOS7  下载Linux版MySQL安装包   地址    下载完成后，上传MySQL安装包    解压tar文件  123cd &#x2F;opt&#x2F;mysql8.0mkdir mysqltar -xvf mysql-8.0.26-1.el7.x86_64.rpm-bundle.tar -C ."><meta property="og:type" content="article"><meta property="og:title" content="MySQL_10进阶_索引"><meta property="og:url" content="http://unicorn-acc.github.io/posts/2157.html"><meta property="og:site_name" content="Miraclo"><meta property="og:description" content="MySQL 索引 在Linux系统上安装MySQL8.0  准备一台Linux服务器  Linux的版本为CentOS7  下载Linux版MySQL安装包   地址    下载完成后，上传MySQL安装包    解压tar文件  123cd &#x2F;opt&#x2F;mysql8.0mkdir mysqltar -xvf mysql-8.0.26-1.el7.x86_64.rpm-bundle.tar -C ."><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://w.wallhaven.cc/full/1p/wallhaven-1pjml1.jpg"><meta property="article:published_time" content="2022-11-04T18:46:57.000Z"><meta property="article:modified_time" content="2023-03-09T15:12:48.585Z"><meta property="article:author" content="Miraclo"><meta property="article:tag" content="Mysql"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://w.wallhaven.cc/full/1p/wallhaven-1pjml1.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://unicorn-acc.github.io/posts/2157"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:2e3},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:800,languages:{author:"作者: Miraclo",link:"链接: ",source:"来源: Miraclo",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"MySQL_10进阶_索引",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-03-09 15:12:48"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,a){0!==a&&(a=864e5*a,t={value:t,expiry:(new Date).getTime()+a},localStorage.setItem(e,JSON.stringify(t)))},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!((new Date).getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=o=>new Promise((t,e)=>{const a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};e=saveToLocal.get("theme"),"dark"===e?activateDarkMode():"light"===e&&activateLightMode(),e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/mouth.css"><link rel="stylesheet" href="/css/codecolor.css"><link rel="stylesheet" href="//s1.hdslb.com/bfs/static/jinkela/long/font/medium.css"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload='this.media="screen"'><meta name="generator" content="Hexo 6.0.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./img/avatar.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">142</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-film"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i><span></span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://w.wallhaven.cc/full/1p/wallhaven-1pjml1.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Miraclo</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-film"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i><span></span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL_10进阶_索引</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2022-11-04T18:46:57.000Z" title="发表于 2022-11-04 18:46:57">2022-11-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/">关系型数据库</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/1%E3%80%81Mysql/">1、Mysql</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">14k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>59分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="MySQL_10进阶_索引"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="mysql-索引">MySQL 索引</h1><h2 id="在linux系统上安装mysql8.0">在Linux系统上安装MySQL8.0</h2><ol type="1"><li>准备一台Linux服务器</li></ol><p>Linux的版本为CentOS7</p><ol start="2" type="1"><li>下载Linux版MySQL安装包</li></ol><ul><li><a target="_blank" rel="noopener" href="https://downloads.mysql.com/archives/community/">地址</a></li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220922/image-20211031230239760.4lltc4efppk0.webp" alt="image-20211031230239760" style="zoom:80%"></p><ol start="3" type="1"><li>下载完成后，上传MySQL安装包</li></ol><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220922/image.7b1siexp8yw0.webp" alt="image" style="zoom:80%"></p><ol start="4" type="1"><li>解压tar文件</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /opt/mysql8.0<br><span class="hljs-built_in">mkdir</span> mysql<br>tar -xvf mysql-8.0.26-1.el7.x86_64.rpm-bundle.tar -C ./mysql<br></code></pre></td></tr></table></figure><ol start="5" type="1"><li>安装mysql的安装包</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> mysql<br><br>rpm -ivh mysql-community-common-8.0.26-1.el7.x86_64.rpm <br><br>rpm -ivh mysql-community-client-plugins-8.0.26-1.el7.x86_64.rpm <br><br>rpm -ivh mysql-community-libs-8.0.26-1.el7.x86_64.rpm <br><br>rpm -ivh mysql-community-libs-compat-8.0.26-1.el7.x86_64.rpm<br><br>yum install openssl-devel<br><br>rpm -ivh  mysql-community-devel-8.0.26-1.el7.x86_64.rpm<br><br>rpm -ivh mysql-community-client-8.0.26-1.el7.x86_64.rpm<br><br>rpm -ivh  mysql-community-server-8.0.26-1.el7.x86_64.rpm<br></code></pre></td></tr></table></figure><blockquote><p>如果执行报依赖检测失败，在命令后面加<code>--nodeps --force</code></p></blockquote><ol start="6" type="1"><li>MySQL服务</li></ol><ul><li>启动</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start mysqld<br></code></pre></td></tr></table></figure><ul><li>重启</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart mysqld<br></code></pre></td></tr></table></figure><ul><li>关闭</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl stop mysqld<br></code></pre></td></tr></table></figure><ol start="7" type="1"><li>查询自动生成的root用户密码</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">grep <span class="hljs-string">&#x27;temporary password&#x27;</span> /var/log/mysqld.log<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql -u root -p<br></code></pre></td></tr></table></figure><blockquote><p>输入密码</p></blockquote><ol start="8" type="1"><li>修改root用户密码</li></ol><p>登录到MySQL之后，需要将自动生成的不便记忆的密码修改了，修改成自己熟悉的便于记忆的密码。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ALTER  USER  <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span>  IDENTIFIED BY <span class="hljs-string">&#x27;123456&#x27;</span>;<br></code></pre></td></tr></table></figure><p>执行上述的SQL会报错，原因是因为设置的密码太简单，密码复杂度不够。我们可以设置密码的复杂度为简单类型，密码长度为6。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">set</span> global validate_password.policy = 0;<br><span class="hljs-built_in">set</span> global validate_password.length = 6;<br></code></pre></td></tr></table></figure><p>降低密码的校验规则之后，再次执行上述修改密码的指令。</p><ol start="9" type="1"><li>创建用户</li></ol><p>默认的root用户只能当前节点localhost访问，是无法远程访问的，我们还需要创建一个root账户，用户远程访问</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">create user <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED WITH mysql_native_password BY <span class="hljs-string">&#x27;123456&#x27;</span>;<br></code></pre></td></tr></table></figure><ol start="10" type="1"><li>并给root用户分配权限</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">grant all on *.* to <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br></code></pre></td></tr></table></figure><ol start="11" type="1"><li>重新连接MySQL</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql -u root -p<br></code></pre></td></tr></table></figure><blockquote><p>输入密码，登录成功</p></blockquote><ol start="12" type="1"><li>使用Navicat远程连接MySQL</li></ol><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220922/image.5trm4of7da80.webp" alt="image" style="zoom:80%"></p><h2 id="索引介绍">索引介绍</h2><p>索引（index）是帮助MySQL<strong>高效获取数据</strong>的<strong>数据结构</strong>(<strong>有序</strong>)。在数据之外，数据库系统还维护着满足 特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据， 这样就可以在这些数据结构 上实现高级查找算法，这种数据结构就是索引。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220922/image.4ceabfxp7o20.webp" alt="image" style="zoom:80%"></p><p>优缺点：</p><p>优点：</p><ul><li>提高数据检索效率，降低数据库的IO成本</li><li>通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗</li></ul><p>缺点：</p><ul><li>索引列也是要占用空间的</li><li>索引大大提高了查询效率，但降低了更新的速度，比如 INSERT、UPDATE、DELETE</li></ul><h2 id="索引结构">索引结构</h2><table><thead><tr class="header"><th style="text-align:left">索引结构</th><th style="text-align:left">描述</th></tr></thead><tbody><tr class="odd"><td style="text-align:left"><font color="red">B+Tree</font></td><td style="text-align:left"><font color="red">最常见的索引类型，大部分引擎都支持B+树索引</font></td></tr><tr class="even"><td style="text-align:left">Hash</td><td style="text-align:left">底层数据结构是用哈希表实现，只有精确匹配索引列的查询才有效，不支持范围查询</td></tr><tr class="odd"><td style="text-align:left">R-Tree(空间索引)</td><td style="text-align:left">空间索引是 MyISAM 引擎的一个特殊索引类型，主要用于地理空间数据类型，通常使用较少</td></tr><tr class="even"><td style="text-align:left">Full-Text(全文索引)</td><td style="text-align:left">是一种通过建立倒排索引，快速匹配文档的方式，类似于 Lucene, Solr, ES</td></tr></tbody></table><ul><li>上述是MySQL中所支持的所有的索引结构，接下来，我们再来看看不同的存储引擎对于索引结构的支持 情况。</li></ul><table><thead><tr class="header"><th style="text-align:left">索引</th><th style="text-align:left">InnoDB</th><th style="text-align:left">MyISAM</th><th style="text-align:left">Memory</th></tr></thead><tbody><tr class="odd"><td style="text-align:left">B+Tree索引</td><td style="text-align:left">支持</td><td style="text-align:left">支持</td><td style="text-align:left">支持</td></tr><tr class="even"><td style="text-align:left">Hash索引</td><td style="text-align:left">不支持</td><td style="text-align:left">不支持</td><td style="text-align:left">支持</td></tr><tr class="odd"><td style="text-align:left">R-Tree索引</td><td style="text-align:left">不支持</td><td style="text-align:left">支持</td><td style="text-align:left">不支持</td></tr><tr class="even"><td style="text-align:left">Full-text</td><td style="text-align:left">5.6版本之后支持</td><td style="text-align:left">支持</td><td style="text-align:left">不支持</td></tr></tbody></table><blockquote><p>注意： 我们平常所说的索引，如果没有特别指明，都是指B+树结构组织的索引。</p></blockquote><h3 id="二叉树">二叉树</h3><p>假如说MySQL的索引结构采用二叉树的数据结构，比较理想的结构如下：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220922/image.2x5ygpv62bc0.webp" alt="image" style="zoom:80%"></p><p>如果主键是顺序插入的，则会形成一个单向链表，结构如下：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220922/image.11jj75v1pmvk.webp" alt="image" style="zoom:80%"></p><p>所以，如果选择二叉树作为索引结构，会存在以下缺点：</p><ul><li>顺序插入时，会形成一个链表，查询性能大大降低。</li><li>大数据量情况下，层级较深，检索速度慢。</li></ul><p>此时大家可能会想到，我们可以选择红黑树，红黑树是一颗自平衡二叉树，那这样即使是顺序插入数据，最终形成的数据结构也是一颗平衡的二叉树,结构如下:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220922/image.3gnt45t33c80.webp" alt="image" style="zoom:80%"></p><p>但是，即使如此，由于红黑树也是一颗二叉树，所以也会存在一个缺点：</p><ul><li>大数据量情况下，层级较深，检索速度慢。</li></ul><p>所以，在MySQL的索引结构中，并没有选择二叉树或者红黑树，而选择的是B+Tree，那么什么是B+Tree呢？在详解B+Tree之前，先来介绍一个B-Tree。</p><h3 id="b-tree">B-Tree</h3><p>B-Tree，B树是一种<strong>多路</strong>衡查找树，相对于二叉树，B树每个节点可以有多个分支，即多叉。以一颗最大度数（max-degree）为5(5阶)的b-tree为例，那这个B树每个节点最多存储4个key，5个指针：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220922/image.502an5672xg0.webp" alt="image" style="zoom:80%"></p><blockquote><p>树的度数指的是一个节点的子节点个数。</p></blockquote><p>我们可以通过一个数据结构可视化的网站来简单演示一下。<a target="_blank" rel="noopener" href="https://www.cs.usfca.edu/~galles/visualization/BTree.html">B-Tree Visualization (usfca.edu)</a></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220922/image.3ejefb0tmlk0.webp" alt="image" style="zoom:80%"></p><p>插入一组数据： 100 65 169 368 900 556 780 35 215 1200 234 888 158 90 1000 88 120 268 250 。然后观察一些数据插入过程中，节点的变化情况。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220922/image.57f9fwicq8c0.webp" alt="image" style="zoom:80%"></p><p>特点：</p><ul><li>5阶的B树，每一个节点最多存储4个key，对应5个指针。</li><li>一旦节点存储的key数量到达5，就会裂变，中间元素向上分裂。</li><li>在<strong>B树</strong>中，<strong>非叶子节点和叶子节点都会存放数据</strong>。</li></ul><h3 id="btree">B+Tree</h3><p>B+Tree是B-Tree的变种，我们以一颗最大度数（max-degree）为4（4阶）的b+tree为例，来看一下其结构示意图：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220922/image.19jn04aoruqo.webp" alt="image" style="zoom:80%"></p><p>我们可以看到，两部分：</p><ul><li>绿色框框起来的部分，是索引部分，仅仅起到索引数据的作用，不存储数据。</li><li>红色框框起来的部分，是数据存储部分，在其叶子节点中要存储具体的数据。</li></ul><p>我们可以通过一个数据结构可视化的网站来简单演示一下。<a target="_blank" rel="noopener" href="https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html">B+ Tree Visualization (usfca.edu)</a></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220922/image.3ejefb0tmlk0.webp" alt="image" style="zoom:80%"></p><p>插入一组数据： 100 65 169 368 900 556 780 35 215 1200 234 888 158 90 1000 88 120 268 250 。然后观察一些数据插入过程中，节点的变化情况。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220922/image.4sdwnp6ytp40.webp" alt="image" style="zoom:80%"></p><p>最终我们看到，B+Tree 与 B-Tree相比，主要有以下三点区别：</p><ul><li><strong>所有的数据</strong>都会出现在<strong>叶子节点</strong>。</li><li><strong>叶子节点形成</strong>一个<strong>单向链表</strong>。</li><li><strong>非叶子节点</strong>仅仅起到<strong>索引数据作用</strong>，<strong>具体的数据</strong>都是在<strong>叶子节点存放</strong>的。</li></ul><p>上述我们所看到的结构是标准的B+Tree的数据结构，接下来，我们再来看看MySQL中优化之后的B+Tree。</p><p>MySQL索引数据结构对经典的B+Tree进行了优化。在原B+Tree的基础上，增加一个指向相邻叶子节点的链表指针，就形成了带有顺序指针的B+Tree，提高区间访问的性能，利于排序。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220922/image.75isnx49mkw0.webp" alt="image" style="zoom:80%"></p><h3 id="hash">Hash</h3><p>MySQL中除了支持B+Tree索引，还支持一种索引类型---Hash索引。</p><ol type="1"><li>结构</li></ol><p>哈希索引就是采用一定的hash算法，将键值换算成新的hash值，映射到对应的槽位上，然后存储在hash表中。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220922/image.4np8kvtyma00.webp" alt="image" style="zoom:80%"></p><p>如果两个(或多个)键值，映射到一个相同的槽位上，他们就产生了hash冲突（也称为hash碰撞），可以通过链表来解决。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220922/image.1emkfrpfv50.webp" alt="image" style="zoom:80%"></p><ol start="2" type="1"><li>特点</li></ol><ul><li>Hash索引只能用于对等比较(=，in)，不支持范围查询（between，&gt;，&lt; ，...）</li><li>无法利用索引完成排序操作</li><li>查询效率高，通常(不存在hash冲突的情况)只需要一次检索就可以了，效率通常要高于B+tree索引</li></ul><ol start="3" type="1"><li>存储引擎支持</li></ol><p>在MySQL中，支持hash索引的是Memory存储引擎。 而InnoDB中具有自适应hash功能，hash索引是 InnoDB存储引擎根据B+Tree索引在指定条件下自动构建的。</p><blockquote><p>思考题： <strong>为什么InnoDB存储引擎选择使用B+tree索引结构</strong>?</p><ol type="1"><li>相对于二叉树，层级更少，搜索效率高；</li><li>对于B-tree，无论是叶子节点还是非叶子节点，都会保存数据，这样<strong>导致</strong>一页中存储的<strong>键值减少</strong>，<strong>指针跟着减少</strong>，要同样<strong>保存大量数据</strong>，<strong>只能增加树的高度</strong>，导致<strong>性能降低</strong>；</li><li>相对Hash索引，B+tree支持范围匹配及排序操作；</li></ol></blockquote><h2 id="索引的分类">索引的分类</h2><p>在MySQL数据库，将索引的具体类型主要分为以下几类：主键索引、唯一索引、常规索引、全文索引。</p><table><thead><tr class="header"><th style="text-align:left">分类</th><th style="text-align:left">含义</th><th style="text-align:left">特点</th><th style="text-align:left">关键字</th></tr></thead><tbody><tr class="odd"><td style="text-align:left">主键索引</td><td style="text-align:left">针对于表中主键创建的索引</td><td style="text-align:left">默认自动创建，只能有一个</td><td style="text-align:left">PRIMARY</td></tr><tr class="even"><td style="text-align:left">唯一索引</td><td style="text-align:left">避免同一个表中某数据列中的值重复</td><td style="text-align:left">可以有多个</td><td style="text-align:left">UNIQUE</td></tr><tr class="odd"><td style="text-align:left">常规索引</td><td style="text-align:left">快速定位特定数据</td><td style="text-align:left">可以有多个</td><td style="text-align:left"></td></tr><tr class="even"><td style="text-align:left">全文索引</td><td style="text-align:left">全文索引查找的是文本中的关键词，而不是比较索引中的值</td><td style="text-align:left">可以有多个</td><td style="text-align:left">FULLTEXT</td></tr></tbody></table><p>在 InnoDB 存储引擎中，根据索引的存储形式，又可以分为以下两种：</p><table><thead><tr class="header"><th style="text-align:left">分类</th><th style="text-align:left">含义</th><th style="text-align:left">特点</th></tr></thead><tbody><tr class="odd"><td style="text-align:left">聚集索引(Clustered Index)</td><td style="text-align:left">将数据存储与索引放一块，索引结构的叶子节点保存了行数据</td><td style="text-align:left"><strong>必须有，而且只有一个</strong></td></tr><tr class="even"><td style="text-align:left">二级索引(Secondary Index)</td><td style="text-align:left">将数据与索引分开存储，索引结构的叶子节点关联的是对应的主键</td><td style="text-align:left">可以存在多个</td></tr></tbody></table><p>聚集索引选取规则:</p><ul><li>如果<mark>存在主键</mark>，主键索引就是<mark>聚集索引</mark></li><li>如果<mark>不存在主键</mark>，将使用<mark>第一个唯一（UNIQUE）索引作为聚集索引</mark>。</li><li>如果表<mark>没有主键，或没有合适的唯一索引</mark>，则InnoDB会<mark>自动生成一个rowid作为隐藏</mark>的聚集索 引。</li></ul><p>聚集索引和二级索引的具体结构如下：</p><p>演示图：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220924/image.1gn1yrumngio.webp" alt="image" style="zoom:80%"></p><ul><li>聚集索引的叶子节点下挂的是这一行的数据 。</li><li>二级索引的叶子节点下挂的是该字段值对应的主键值。</li></ul><p>接下来，我们来分析一下，当我们执行如下的SQL语句时，具体的查找过程是什么样子的。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220924/image.6wtz50o3aps0.webp" alt="image" style="zoom:80%"></p><p>具体过程如下:</p><ol type="1"><li>由于是根据name字段进行查询，所以先根据name='Arm'到name字段的二级索引中进行匹配查 找。但是在二级索引中只能查找到 Arm 对应的主键值 10。</li><li>由于查询返回的数据是*，所以此时，还需要根据主键值10，到聚集索引中查找10对应的记录，最 终找到10对应的行row。</li><li>最终拿到这一行的数据，直接返回即可。</li></ol><blockquote><p><strong>回表查询</strong>： 这种先到二级索引中查找数据，找到主键值，然后再到聚集索引中根据主键值，获取 数据的方式，就称之为回表查询。</p></blockquote><blockquote><p>思考题：</p><ul><li><p>以下两条SQL语句，那个执行效率高? 为什么?</p><p>A. select * from user where id = 10 ;</p><p>B. select * from user where name = 'Arm' ;</p><p>备注: id为主键，name字段创建的有索引；</p></li></ul><p>解答：</p><ul><li><p>A 语句的执行性能要高于B 语句。</p></li><li><p>因为A语句直接走聚集索引，直接返回数据。 而B语句需要先查询name字段的二级索引，然后再查询聚集索引，也就是需要进行回表查询。</p></li></ul></blockquote><blockquote><p>思考题：</p><ul><li>InnoDB主键索引的B+tree高度为多高呢?</li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220924/image.43mt337llam0.webp" alt="image" style="zoom:80%"></p><p>答：假设一行数据大小为1k，一页中可以存储16行这样的数据。InnoDB 的指针占用6个字节的空间，主键假设为bigint，占用字节数为8. 可得公式：<code>n * 8 + (n + 1) * 6 = 16 * 1024</code>，其中 8 表示 bigint 占用的字节数，n 表示当前节点存储的key的数量，(n + 1) 表示指针数量（比key多一个）。算出n约为1170。</p><p>如果树的高度为2，那么他能存储的数据量大概为：<code>1171 * 16 = 18736</code>； 如果树的高度为3，那么他能存储的数据量大概为：<code>1171 * 1171 * 16 = 21939856</code>。</p><p>另外，如果有成千上万的数据，那么就要考虑分表，涉及运维篇知识</p></blockquote><h2 id="索引语法">索引语法</h2><ol type="1"><li>创建索引</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> [ <span class="hljs-keyword">UNIQUE</span> <span class="hljs-operator">|</span> FULLTEXT ] INDEX index_name <span class="hljs-keyword">ON</span> table_name (index_col_name,... ) ;<br></code></pre></td></tr></table></figure><ol start="2" type="1"><li>查看索引</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> INDEX <span class="hljs-keyword">FROM</span> table_name ;<br></code></pre></td></tr></table></figure><ol start="3" type="1"><li>删除索引</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> INDEX index_name <span class="hljs-keyword">ON</span> table_name ;<br></code></pre></td></tr></table></figure><p>案例演示:</p><p>先来创建一张表 tb_user，并且查询测试数据。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> tb_user(<br>	id <span class="hljs-type">int</span> <span class="hljs-keyword">primary</span> key auto_increment comment <span class="hljs-string">&#x27;主键&#x27;</span>,<br>	name <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;用户名&#x27;</span>,<br>	phone <span class="hljs-type">varchar</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;手机号&#x27;</span>,<br>	email <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) comment <span class="hljs-string">&#x27;邮箱&#x27;</span>,<br>	profession <span class="hljs-type">varchar</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;专业&#x27;</span>,<br>	age tinyint unsigned comment <span class="hljs-string">&#x27;年龄&#x27;</span>,<br>	gender <span class="hljs-type">char</span>(<span class="hljs-number">1</span>) comment <span class="hljs-string">&#x27;性别 , 1: 男, 2: 女&#x27;</span>,<br>	status <span class="hljs-type">char</span>(<span class="hljs-number">1</span>) comment <span class="hljs-string">&#x27;状态&#x27;</span>,<br>	createtime datetime comment <span class="hljs-string">&#x27;创建时间&#x27;</span><br>) comment <span class="hljs-string">&#x27;系统用户表&#x27;</span>;<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;吕布&#x27;</span>, <span class="hljs-string">&#x27;17799990000&#x27;</span>, <span class="hljs-string">&#x27;lvbu666@163.com&#x27;</span>, <span class="hljs-string">&#x27;软件工程&#x27;</span>, <span class="hljs-number">23</span>, <span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;2001-02-02 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;曹操&#x27;</span>, <span class="hljs-string">&#x27;17799990001&#x27;</span>, <span class="hljs-string">&#x27;caocao666@qq.com&#x27;</span>, <span class="hljs-string">&#x27;通讯工程&#x27;</span>, <span class="hljs-number">33</span>,<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-03-05 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;赵云&#x27;</span>, <span class="hljs-string">&#x27;17799990002&#x27;</span>, <span class="hljs-string">&#x27;17799990@139.com&#x27;</span>, <span class="hljs-string">&#x27;英语&#x27;</span>, <span class="hljs-number">34</span>, <span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;2002-03-02 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;孙悟空&#x27;</span>, <span class="hljs-string">&#x27;17799990003&#x27;</span>, <span class="hljs-string">&#x27;17799990@sina.com&#x27;</span>, <span class="hljs-string">&#x27;工程造价&#x27;</span>, <span class="hljs-number">54</span>,<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-07-02 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;花木兰&#x27;</span>, <span class="hljs-string">&#x27;17799990004&#x27;</span>, <span class="hljs-string">&#x27;19980729@sina.com&#x27;</span>, <span class="hljs-string">&#x27;软件工程&#x27;</span>, <span class="hljs-number">23</span>,<span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2001-04-22 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;大乔&#x27;</span>, <span class="hljs-string">&#x27;17799990005&#x27;</span>, <span class="hljs-string">&#x27;daqiao666@sina.com&#x27;</span>, <span class="hljs-string">&#x27;舞蹈&#x27;</span>, <span class="hljs-number">22</span>, <span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-02-07 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status, createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;露娜&#x27;</span>, <span class="hljs-string">&#x27;17799990006&#x27;</span>, <span class="hljs-string">&#x27;luna_love@sina.com&#x27;</span>, <span class="hljs-string">&#x27;应用数学&#x27;</span>, <span class="hljs-number">24</span>,<span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-02-08 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;程咬金&#x27;</span>, <span class="hljs-string">&#x27;17799990007&#x27;</span>, <span class="hljs-string">&#x27;chengyaojin@163.com&#x27;</span>, <span class="hljs-string">&#x27;化工&#x27;</span>, <span class="hljs-number">38</span>,<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;2001-05-23 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;项羽&#x27;</span>, <span class="hljs-string">&#x27;17799990008&#x27;</span>, <span class="hljs-string">&#x27;xiaoyu666@qq.com&#x27;</span>, <span class="hljs-string">&#x27;金属材料&#x27;</span>, <span class="hljs-number">43</span>,<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-09-18 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;白起&#x27;</span>, <span class="hljs-string">&#x27;17799990009&#x27;</span>, <span class="hljs-string">&#x27;baiqi666@sina.com&#x27;</span>, <span class="hljs-string">&#x27;机械工程及其自动化&#x27;</span>, <span class="hljs-number">27</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;2001-08-16 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;韩信&#x27;</span>, <span class="hljs-string">&#x27;17799990010&#x27;</span>, <span class="hljs-string">&#x27;hanxin520@163.com&#x27;</span>, <span class="hljs-string">&#x27;无机非金属材料工程&#x27;</span>, <span class="hljs-number">27</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-06-12 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;荆轲&#x27;</span>, <span class="hljs-string">&#x27;17799990011&#x27;</span>, <span class="hljs-string">&#x27;jingke123@163.com&#x27;</span>, <span class="hljs-string">&#x27;会计&#x27;</span>, <span class="hljs-number">29</span>, <span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-05-11 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;兰陵王&#x27;</span>, <span class="hljs-string">&#x27;17799990012&#x27;</span>, <span class="hljs-string">&#x27;lanlinwang666@126.com&#x27;</span>, <span class="hljs-string">&#x27;工程造价&#x27;</span>,<span class="hljs-number">44</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2001-04-09 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;狂铁&#x27;</span>, <span class="hljs-string">&#x27;17799990013&#x27;</span>, <span class="hljs-string">&#x27;kuangtie@sina.com&#x27;</span>, <span class="hljs-string">&#x27;应用数学&#x27;</span>, <span class="hljs-number">43</span>,<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;2001-04-10 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;貂蝉&#x27;</span>, <span class="hljs-string">&#x27;17799990014&#x27;</span>, <span class="hljs-string">&#x27;84958948374@qq.com&#x27;</span>, <span class="hljs-string">&#x27;软件工程&#x27;</span>, <span class="hljs-number">40</span>,<span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;2001-02-12 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;妲己&#x27;</span>, <span class="hljs-string">&#x27;17799990015&#x27;</span>, <span class="hljs-string">&#x27;2783238293@qq.com&#x27;</span>, <span class="hljs-string">&#x27;软件工程&#x27;</span>, <span class="hljs-number">31</span>,<span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-01-30 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;芈月&#x27;</span>, <span class="hljs-string">&#x27;17799990016&#x27;</span>, <span class="hljs-string">&#x27;xiaomin2001@sina.com&#x27;</span>, <span class="hljs-string">&#x27;工业经济&#x27;</span>, <span class="hljs-number">35</span>,<span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2000-05-03 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;嬴政&#x27;</span>, <span class="hljs-string">&#x27;17799990017&#x27;</span>, <span class="hljs-string">&#x27;8839434342@qq.com&#x27;</span>, <span class="hljs-string">&#x27;化工&#x27;</span>, <span class="hljs-number">38</span>, <span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2001-08-08 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;狄仁杰&#x27;</span>, <span class="hljs-string">&#x27;17799990018&#x27;</span>, <span class="hljs-string">&#x27;jujiamlm8166@163.com&#x27;</span>, <span class="hljs-string">&#x27;国际贸易&#x27;</span>,<span class="hljs-number">30</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2007-03-12 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;安琪拉&#x27;</span>, <span class="hljs-string">&#x27;17799990019&#x27;</span>, <span class="hljs-string">&#x27;jdodm1h@126.com&#x27;</span>, <span class="hljs-string">&#x27;城市规划&#x27;</span>, <span class="hljs-number">51</span>,<span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-08-15 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;典韦&#x27;</span>, <span class="hljs-string">&#x27;17799990020&#x27;</span>, <span class="hljs-string">&#x27;ycaunanjian@163.com&#x27;</span>, <span class="hljs-string">&#x27;城市规划&#x27;</span>, <span class="hljs-number">52</span>,<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;2000-04-12 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;廉颇&#x27;</span>, <span class="hljs-string">&#x27;17799990021&#x27;</span>, <span class="hljs-string">&#x27;lianpo321@126.com&#x27;</span>, <span class="hljs-string">&#x27;土木工程&#x27;</span>, <span class="hljs-number">19</span>,<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;2002-07-18 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;后羿&#x27;</span>, <span class="hljs-string">&#x27;17799990022&#x27;</span>, <span class="hljs-string">&#x27;altycj2000@139.com&#x27;</span>, <span class="hljs-string">&#x27;城市园林&#x27;</span>, <span class="hljs-number">20</span>,<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2002-03-10 00:00:00&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user (name, phone, email, profession, age, gender, status,createtime) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;姜子牙&#x27;</span>, <span class="hljs-string">&#x27;17799990023&#x27;</span>, <span class="hljs-string">&#x27;37483844@qq.com&#x27;</span>, <span class="hljs-string">&#x27;工程造价&#x27;</span>, <span class="hljs-number">29</span>,<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;2003-05-26 00:00:00&#x27;</span>);<br></code></pre></td></tr></table></figure><p>表结构中插入的数据如下：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220924/image.2c74rg41jaas.webp" alt="image" style="zoom:80%"></p><p>数据准备好了之后，接下来，我们就来完成如下需求：</p><ol type="1"><li>name字段为姓名字段，该字段的值可能会重复，为该字段创建索引。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> INDEX idx_user_name <span class="hljs-keyword">ON</span> tb_user(name);<br></code></pre></td></tr></table></figure><ol start="2" type="1"><li>phone手机号字段的值，是非空，且唯一的，为该字段创建唯一索引。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> INDEX idx_user_phone <span class="hljs-keyword">ON</span> tb_user(phone);<br></code></pre></td></tr></table></figure><ol start="3" type="1"><li>为profession、age、status创建联合索引。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> INDEX idx_user_pro_age_sta <span class="hljs-keyword">ON</span> tb_user(profession,age,status);<br></code></pre></td></tr></table></figure><ol start="4" type="1"><li>为email建立合适的索引来提升查询效率</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> INDEX idx_email <span class="hljs-keyword">ON</span> tb_user(email);<br></code></pre></td></tr></table></figure><p>完成上述的需求之后，我们再查看tb_user表的所有的索引数据。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> tb_user;<br></code></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220924/image.35xc5gst9wi0.webp" alt="image" style="zoom:80%"></p><h2 id="sql-性能分析">SQL 性能分析</h2><h3 id="sql-执行频率">SQL 执行频率</h3><p>MySQL 客户端连接成功后，通过 show [session|global] status 命令可以提供服务器状态信息。通过如下指令，可以查看当前数据库的INSERT、UPDATE、DELETE、SELECT的访问频次：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- session 是查看当前会话 ;</span><br><span class="hljs-comment">-- global 是查询全局数据 ;</span><br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">GLOBAL</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;Com_______&#x27;</span>;<br></code></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220924/image.19b65pth8a00.webp" alt="image" style="zoom:80%"></p><p>Com_delete: 删除次数</p><p>Com_insert: 插入次数</p><p>Com_select: 查询次数</p><p>Com_update: 更新次数</p><p>我们可以在当前数据库再执行几次查询操作，然后再次查看执行频次，看看 Com_select 参数会不会变化。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220924/image.6g270hk9wf80.webp" alt="image" style="zoom:80%"></p><blockquote><p>通过上述指令，我们可以查看到当前数据库到底是以查询为主，还是以增删改为主，从而为数据库优化提供参考依据。 如果是以增删改为主，我们可以考虑不对其进行索引的优化。 如果是以查询为主，那么就要考虑对数据库的索引进行优化了。</p></blockquote><p>那么通过查询SQL的执行频次，我们就能够知道当前数据库到底是增删改为主，还是查询为主。 那假如说是以查询为主，我们又该如何定位针对于那些查询语句进行优化呢？ 次数我们可以借助于慢查询日志。</p><p>接下来，我们就来介绍一下MySQL中的慢查询日志。</p><h3 id="慢查询日志">慢查询日志</h3><p>慢查询日志记录了所有执行时间超过指定参数（long_query_time，单位：秒，默认10秒）的所有 SQL语句的日志。</p><p>MySQL的慢查询日志默认没有开启，我们可以查看一下系统变量 slow_query_log。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;slow_query_log&#x27;</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;slow_query_log&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+-------+</span><br><span class="hljs-operator">|</span> Variable_name  <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+-------+</span><br><span class="hljs-operator">|</span> slow_query_log <span class="hljs-operator">|</span> OFF   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure><p>如果要开启慢查询日志，需要在MySQL的配置文件（/etc/my.cnf）中配置如下信息：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 开启MySQL慢日志查询开关</span><br><br>slow_query_log=1<br><br><span class="hljs-comment"># 设置慢日志的时间为2秒，SQL语句执行时间超过2秒，就会视为慢查询，记录慢查询日志</span><br><br>long_query_time=2<br></code></pre></td></tr></table></figure><p>配置完毕之后，通过以下指令重新启动MySQL服务器进行测试，查看慢日志文件中记录的信息<code>/var/lib/mysql/localhost-slow.log</code>。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart mysqld<br></code></pre></td></tr></table></figure><p>然后，再次查看开关情况，慢查询日志就已经打开了。</p><figure class="highlight sql"><figcaption><span>&#123;1&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;slow_query_log&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+-------+</span><br><span class="hljs-operator">|</span> Variable_name  <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+-------+</span><br><span class="hljs-operator">|</span> slow_query_log <span class="hljs-operator">|</span> <span class="hljs-keyword">ON</span>    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>测试：</p><ol type="1"><li>执行如下SQL语句 ：</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user; <span class="hljs-comment">-- 这条SQL执行效率比较高, 执行耗时 0.00sec</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> tb_sku; <span class="hljs-comment">-- 由于tb_sku表中, 预先存入了1000w的记录, count一次,耗时13.35sec</span><br></code></pre></td></tr></table></figure><ol start="2" type="1"><li>检查慢查询日志 ：</li></ol><p>最终我们发现，在慢查询日志中，只会记录执行时间超多我们预设时间（2s）的SQL，执行较快的SQL是不会记录的。</p><p>那这样，通过慢查询日志，就可以定位出执行效率比较低的SQL，从而有针对性的进行优化。</p><h3 id="profile详情">profile详情</h3><p>show profiles 能够在做SQL优化时帮助我们了解时间都耗费到哪里去了。通过have_profiling参数，能够看到当前MySQL是否支持profile操作：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@have</span>_profiling;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@have</span>_profiling;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> @<span class="hljs-variable">@have</span>_profiling <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> YES              <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> @<span class="hljs-variable">@profiling</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------+</span><br><span class="hljs-operator">|</span> @<span class="hljs-variable">@profiling</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------+</span><br><span class="hljs-operator">|</span>           <span class="hljs-number">0</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>可以看到，当前MySQL是支持 profile操作的，但是开关是关闭的。可以通过set语句在session/global级别开启profiling：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">SET profiling = 1;<br></code></pre></td></tr></table></figure><p>开关已经打开了，接下来，我们所执行的SQL语句，都会被MySQL记录，并记录执行时间消耗到哪儿去了。 我们直接执行如下的SQL语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user;<br><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;白起&#x27;</span>;<br><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> tb_sku;<br></code></pre></td></tr></table></figure><p>执行一系列的业务SQL的操作，然后通过如下指令查看指令的执行耗时：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查看每一条SQL的耗时基本情况</span><br><span class="hljs-keyword">show</span> profiles;<br><br><span class="hljs-comment">-- 查看指定query_id的SQL语句各个阶段的耗时情况</span><br><span class="hljs-keyword">show</span> profile <span class="hljs-keyword">for</span> query query_id;<br><br><span class="hljs-comment">-- 查看指定query_id的SQL语句CPU的使用情况</span><br><span class="hljs-keyword">show</span> profile cpu <span class="hljs-keyword">for</span> query query_id;<br></code></pre></td></tr></table></figure><p>查看每一条SQL的耗时情况:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> profiles;<br><span class="hljs-operator">+</span><span class="hljs-comment">----------+------------+---------------------------------------------+</span><br><span class="hljs-operator">|</span> Query_ID <span class="hljs-operator">|</span> Duration   <span class="hljs-operator">|</span> Query                                       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+------------+---------------------------------------------+</span><br><span class="hljs-operator">|</span>        <span class="hljs-number">1</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.00035925</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">select</span> @<span class="hljs-variable">@profiling</span>                          <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>        <span class="hljs-number">2</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.00047950</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user                       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>        <span class="hljs-number">3</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.00028925</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>          <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>        <span class="hljs-number">4</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.00047600</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;白起&#x27;</span>   <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>        <span class="hljs-number">5</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.00074075</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> tb_sku                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+------------+---------------------------------------------+</span><br><span class="hljs-number">5</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>查看指定SQL各个阶段的耗时情况 :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> profile <span class="hljs-keyword">for</span> query <span class="hljs-number">4</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------+----------+</span><br><span class="hljs-operator">|</span> Status                         <span class="hljs-operator">|</span> Duration <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------+----------+</span><br><span class="hljs-operator">|</span> starting                       <span class="hljs-operator">|</span> <span class="hljs-number">0.000089</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> Executing hook <span class="hljs-keyword">on</span> transaction  <span class="hljs-operator">|</span> <span class="hljs-number">0.000006</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> starting                       <span class="hljs-operator">|</span> <span class="hljs-number">0.000007</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> checking permissions           <span class="hljs-operator">|</span> <span class="hljs-number">0.000005</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> Opening tables                 <span class="hljs-operator">|</span> <span class="hljs-number">0.000032</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> init                           <span class="hljs-operator">|</span> <span class="hljs-number">0.000004</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">System</span> lock                    <span class="hljs-operator">|</span> <span class="hljs-number">0.000007</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> optimizing                     <span class="hljs-operator">|</span> <span class="hljs-number">0.000061</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> statistics                     <span class="hljs-operator">|</span> <span class="hljs-number">0.000182</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> preparing                      <span class="hljs-operator">|</span> <span class="hljs-number">0.000015</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> executing                      <span class="hljs-operator">|</span> <span class="hljs-number">0.000030</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">end</span>                            <span class="hljs-operator">|</span> <span class="hljs-number">0.000003</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> query <span class="hljs-keyword">end</span>                      <span class="hljs-operator">|</span> <span class="hljs-number">0.000003</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> waiting <span class="hljs-keyword">for</span> handler <span class="hljs-keyword">commit</span>     <span class="hljs-operator">|</span> <span class="hljs-number">0.000006</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> closing tables                 <span class="hljs-operator">|</span> <span class="hljs-number">0.000005</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> freeing items                  <span class="hljs-operator">|</span> <span class="hljs-number">0.000010</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> cleaning up                    <span class="hljs-operator">|</span> <span class="hljs-number">0.000011</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------+----------+</span><br><span class="hljs-number">17</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>查看指定query_id的SQL语句CPU的使用情况:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> profile cpu <span class="hljs-keyword">for</span> query <span class="hljs-number">4</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------+----------+----------+------------+</span><br><span class="hljs-operator">|</span> Status                         <span class="hljs-operator">|</span> Duration <span class="hljs-operator">|</span> CPU_user <span class="hljs-operator">|</span> CPU_system <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------+----------+----------+------------+</span><br><span class="hljs-operator">|</span> starting                       <span class="hljs-operator">|</span> <span class="hljs-number">0.000089</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.000026</span> <span class="hljs-operator">|</span>   <span class="hljs-number">0.000061</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> Executing hook <span class="hljs-keyword">on</span> transaction  <span class="hljs-operator">|</span> <span class="hljs-number">0.000006</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.000001</span> <span class="hljs-operator">|</span>   <span class="hljs-number">0.000002</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> starting                       <span class="hljs-operator">|</span> <span class="hljs-number">0.000007</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.000002</span> <span class="hljs-operator">|</span>   <span class="hljs-number">0.000005</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> checking permissions           <span class="hljs-operator">|</span> <span class="hljs-number">0.000005</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.000001</span> <span class="hljs-operator">|</span>   <span class="hljs-number">0.000004</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> Opening tables                 <span class="hljs-operator">|</span> <span class="hljs-number">0.000032</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.000010</span> <span class="hljs-operator">|</span>   <span class="hljs-number">0.000022</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> init                           <span class="hljs-operator">|</span> <span class="hljs-number">0.000004</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.000001</span> <span class="hljs-operator">|</span>   <span class="hljs-number">0.000003</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">System</span> lock                    <span class="hljs-operator">|</span> <span class="hljs-number">0.000007</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.000002</span> <span class="hljs-operator">|</span>   <span class="hljs-number">0.000005</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> optimizing                     <span class="hljs-operator">|</span> <span class="hljs-number">0.000061</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.000000</span> <span class="hljs-operator">|</span>   <span class="hljs-number">0.000062</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> statistics                     <span class="hljs-operator">|</span> <span class="hljs-number">0.000182</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.000000</span> <span class="hljs-operator">|</span>   <span class="hljs-number">0.000202</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> preparing                      <span class="hljs-operator">|</span> <span class="hljs-number">0.000015</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.000000</span> <span class="hljs-operator">|</span>   <span class="hljs-number">0.000014</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> executing                      <span class="hljs-operator">|</span> <span class="hljs-number">0.000030</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.000000</span> <span class="hljs-operator">|</span>   <span class="hljs-number">0.000030</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">end</span>                            <span class="hljs-operator">|</span> <span class="hljs-number">0.000003</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.000000</span> <span class="hljs-operator">|</span>   <span class="hljs-number">0.000003</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> query <span class="hljs-keyword">end</span>                      <span class="hljs-operator">|</span> <span class="hljs-number">0.000003</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.000000</span> <span class="hljs-operator">|</span>   <span class="hljs-number">0.000003</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> waiting <span class="hljs-keyword">for</span> handler <span class="hljs-keyword">commit</span>     <span class="hljs-operator">|</span> <span class="hljs-number">0.000006</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.000000</span> <span class="hljs-operator">|</span>   <span class="hljs-number">0.000006</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> closing tables                 <span class="hljs-operator">|</span> <span class="hljs-number">0.000005</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.000000</span> <span class="hljs-operator">|</span>   <span class="hljs-number">0.000005</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> freeing items                  <span class="hljs-operator">|</span> <span class="hljs-number">0.000010</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.000000</span> <span class="hljs-operator">|</span>   <span class="hljs-number">0.000011</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> cleaning up                    <span class="hljs-operator">|</span> <span class="hljs-number">0.000011</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.000000</span> <span class="hljs-operator">|</span>   <span class="hljs-number">0.000010</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------+----------+----------+------------+</span><br><span class="hljs-number">17</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h3 id="explain">explain</h3><p>EXPLAIN 或者 DESC命令获取 MySQL 如何执行 SELECT 语句的信息，包括在 SELECT 语句执行过程中表如何连接和连接的顺序。</p><p>语法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 直接在select语句之前加上关键字 explain / desc</span><br>EXPLAIN <span class="hljs-keyword">SELECT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表名 <span class="hljs-keyword">WHERE</span> 条件 ;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> EXPLAIN <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+---------------+---------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type  <span class="hljs-operator">|</span> possible_keys <span class="hljs-operator">|</span> key     <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>   <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+---------------+---------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span> <span class="hljs-keyword">PRIMARY</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">PRIMARY</span> <span class="hljs-operator">|</span> <span class="hljs-number">4</span>       <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+---------------+---------+---------+-------+------+----------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>Explain 执行计划中各个字段的含义:</p><table><colgroup><col style="width:16%"><col style="width:83%"></colgroup><thead><tr class="header"><th>字段</th><th>含义</th></tr></thead><tbody><tr class="odd"><td>id</td><td>select查询的序列号，表示查询中执行select子句或者是操作表的顺序<br>(id相同，执行顺序从上到下；id不同，值越大，越先执行)。</td></tr><tr class="even"><td>select_type</td><td>表示 SELECT 的类型，常见的取值有 SIMPLE（简单表，即不使用表连接或者子查询）、PRIMARY（主查询，即外层的查询）、UNION（UNION 中的第二个或者后面的查询语句）、SUBQUERY（SELECT/WHERE之后包含了子查询）等</td></tr><tr class="odd"><td>type</td><td>表示连接类型，性能由好到差的连接类型为NULL、system、const、eq_ref、ref、range、 index、all 。</td></tr><tr class="even"><td>possible_key</td><td>显示可能应用在这张表上的索引，一个或多个。</td></tr><tr class="odd"><td>key</td><td>实际使用的索引，如果为NULL，则没有使用索引。</td></tr><tr class="even"><td>key_len</td><td>表示索引中使用的字节数， 该值为索引字段最大可能长度，并非实际使用长度，在不损失精确性的前提下， 长度越短越好 。</td></tr><tr class="odd"><td>rows</td><td>MySQL认为必须要执行查询的行数，在innodb引擎的表中，是一个估计值，可能并不总是准确的。</td></tr><tr class="even"><td>filtered</td><td>表示返回结果的行数占需读取行数的百分比， filtered 的值越大越好。</td></tr></tbody></table><h2 id="索引使用">索引使用</h2><h3 id="验证索引效率">验证索引效率</h3><p>在讲解索引的使用原则之前，先通过一个简单的案例，来验证一下索引，看看是否能够通过索引来提升数据查询性能。在演示的时候，我们还是使用之前准备的一张表 tb_sku , 在这张表中准备了1000w的记录。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220924/image.3ujwo1rofe60.webp" alt="image" style="zoom:80%"></p><p>这张表中id为主键，有主键索引，而其他字段是没有建立索引的。 我们先来查询其中的一条记录，看 看里面的字段情况，执行如下SQL：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_sku here id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>\G;<br></code></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220924/image.5pxymt5v6bc0.webp" alt="image" style="zoom:80%"></p><p>可以看到即使有1000w的数据,根据id进行数据查询,性能依然很快，因为主键id是有索引的。 那么接下来，我们再来根据 sn 字段进行查询，执行如下SQL：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> tb_sku <span class="hljs-keyword">WHERE</span> sn <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;100000003145001&#x27;</span>;<br></code></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220924/image.5d77uumxdec0.webp" alt="image" style="zoom:80%"></p><p>我们可以看到根据sn字段进行查询，查询返回了一条数据，结果耗时 20.78sec，就是因为sn没有索引，而造成查询效率很低。</p><p>那么我们可以针对于sn字段，建立一个索引，建立了索引之后，我们再次根据sn进行查询，再来看一下查询耗时情况。</p><p>创建索引：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> index idx_sku_sn <span class="hljs-keyword">on</span> tb_sku(sn) ;<br></code></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220924/image.6ilv4sirfj80.webp" alt="image" style="zoom:80%"></p><p>然后再次执行相同的SQL语句，再次查看SQL的耗时。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> tb_sku <span class="hljs-keyword">WHERE</span> sn <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;100000003145001&#x27;</span>;<br></code></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220924/image.xt14skcxe7k.webp" alt="image" style="zoom:80%"></p><p>我们明显会看到，sn字段建立了索引之后，查询性能大大提升。建立索引前后，查询耗时都不是一个数量级的。</p><h3 id="最左前缀法则">最左前缀法则</h3><p>如果索引关联了多列（联合索引），要遵守最左前缀法则，最左前缀法则指的是查询从索引的最左列开始，并且不跳过索引中的列。如果跳跃某一列，<mark>索引将部分失效（后面的字段索引失效）</mark>。</p><p>以 tb_user 表为例，我们先来查看一下之前 tb_user 表所创建的索引。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> tb_user;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">Table</span>   <span class="hljs-operator">|</span> Non_unique <span class="hljs-operator">|</span> Key_name             <span class="hljs-operator">|</span> Seq_in_index <span class="hljs-operator">|</span> Column_name <span class="hljs-operator">|</span> <span class="hljs-keyword">Collation</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Cardinality</span> <span class="hljs-operator">|</span> Sub_part <span class="hljs-operator">|</span> Packed <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Index_type <span class="hljs-operator">|</span> Comment <span class="hljs-operator">|</span> Index_comment <span class="hljs-operator">|</span> Visible <span class="hljs-operator">|</span> Expression <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">0</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">PRIMARY</span>              <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> id          <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">23</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>      <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">0</span> <span class="hljs-operator">|</span> idx_user_phone       <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> phone       <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>      <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_name        <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> name        <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>      <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> profession  <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">16</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span>            <span class="hljs-number">2</span> <span class="hljs-operator">|</span> age         <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">22</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span>            <span class="hljs-number">3</span> <span class="hljs-operator">|</span> status      <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_email            <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> email       <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br><span class="hljs-number">7</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure><p>在 tb_user 表中，有一个联合索引，这个联合索引涉及到三个字段，顺序分别为：profession，age，status。</p><p>对于最左前缀法则指的是，查询时，最左变的列，也就是profession必须存在，否则索引全部失效。而且中间不能跳过某一列，否则该列后面的字段索引将失效。 接下来，我们来演示几组案例，看一下具体的执行计划：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">explain select * from tb_user <span class="hljs-built_in">where</span> profession = <span class="hljs-string">&#x27;软件工程&#x27;</span> and age = 31 and status = <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------------------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys        <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>               <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------------------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">54</span>      <span class="hljs-operator">|</span> const,const,const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> index <span class="hljs-keyword">condition</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------------------+------+----------+-----------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------------+------+----------+-------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys        <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>         <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------------+------+----------+-------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">49</span>      <span class="hljs-operator">|</span> const,const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------------+------+----------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys        <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>   <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">47</span>      <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span>    <span class="hljs-number">4</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------+------+----------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>以上的这三组测试中，我们发现只要联合索引最左边的字段 profession存在，索引就会生效，只不过索引的长度不同。 而且由以上三组测试，我们也可以推测出profession字段索引长度为47、age字段索引长度为2、status字段索引长度为5。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys <span class="hljs-operator">|</span> key  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ALL</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>          <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-number">4.17</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys <span class="hljs-operator">|</span> key  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+--------+-------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ALL</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>          <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-number">24</span> <span class="hljs-operator">|</span>    <span class="hljs-number">10.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>而通过上面的这两组测试，我们也可以看到索引并未生效，原因是因为不满足最左前缀法则，联合索引最左边的列profession不存在。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys        <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>   <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">47</span>      <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span>    <span class="hljs-number">4</span> <span class="hljs-operator">|</span>    <span class="hljs-number">10.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> index <span class="hljs-keyword">condition</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------+------+----------+-----------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>上述的SQL查询时，存在profession字段，最左边的列是存在的，索引满足最左前缀法则的基本条件。但是查询时，跳过了age这个列，所以后面的列索引是不会使用的，也就是索引部分生效，所以索引的长度就是47。</p><blockquote><p>思考题:</p><p>当执行SQL语句: explain select * from tb_user where age = 31 and status = '0' and profession = '软件工程'； 时，是否满足最左前缀法则，走不走上述的联合索引，索引长度？</p><figure class="highlight sql"><figcaption><span>&#123;5&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">and</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------------------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys        <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>               <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------------------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">54</span>      <span class="hljs-operator">|</span> const,const,const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> index <span class="hljs-keyword">condition</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------------------+------+----------+-----------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>可以看到，是完全满足最左前缀法则的，索引长度54，联合索引是生效的。</p><p>注意 ： 最左前缀法则中指的最左边的列，是指在查询时，联合索引的最左边的字段(即是第一个字段)必须存在，与我们编写SQL时，条件编写的先后顺序无关。</p></blockquote><h3 id="范围查询">范围查询</h3><p>联合索引中，出现范围查询(&gt;,&lt;)，范围查询右侧的列索引失效。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">30</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">30</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------------+----------------------+---------+------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type  <span class="hljs-operator">|</span> possible_keys        <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------------+----------------------+---------+------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">range</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">49</span>      <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>    <span class="hljs-number">2</span> <span class="hljs-operator">|</span>    <span class="hljs-number">10.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> index <span class="hljs-keyword">condition</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------------+----------------------+---------+------+------+----------+-----------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>当范围查询使用&gt; 或 &lt; 时，走联合索引了，但是索引的长度为49，就说明<mark>范围查询右边的status字段是没有走索引</mark>的。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">&gt;=</span> <span class="hljs-number">30</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">&gt;=</span> <span class="hljs-number">30</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------------+----------------------+---------+------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type  <span class="hljs-operator">|</span> possible_keys        <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------------+----------------------+---------+------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">range</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">54</span>      <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>    <span class="hljs-number">2</span> <span class="hljs-operator">|</span>    <span class="hljs-number">10.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> index <span class="hljs-keyword">condition</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------------+----------------------+---------+------+------+----------+-----------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>当范围查询使用&gt;= 或 &lt;= 时，走联合索引了，但是索引的长度为54，就说明所有的字段都是走索引的。</p><p>所以，在业务允许的情况下，尽可能的使用类似于 &gt;= 或 &lt;= 这类的范围查询，而避免使用 &gt; 或 &lt;</p><h3 id="索引失效情况">索引失效情况</h3><h4 id="索引列运算">索引列运算</h4><p><mark>不要在索引列上进行运算操作， 索引将失效</mark>。</p><p>在tb_user表中，除了前面介绍的联合索引之外，还有一个索引，是phone字段的单列索引。</p><figure class="highlight sql"><figcaption><span>&#123;6&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> tb_user;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">Table</span>   <span class="hljs-operator">|</span> Non_unique <span class="hljs-operator">|</span> Key_name             <span class="hljs-operator">|</span> Seq_in_index <span class="hljs-operator">|</span> Column_name <span class="hljs-operator">|</span> <span class="hljs-keyword">Collation</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Cardinality</span> <span class="hljs-operator">|</span> Sub_part <span class="hljs-operator">|</span> Packed <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Index_type <span class="hljs-operator">|</span> Comment <span class="hljs-operator">|</span> Index_comment <span class="hljs-operator">|</span> Visible <span class="hljs-operator">|</span> Expression <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">0</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">PRIMARY</span>              <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> id          <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">23</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>      <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">0</span> <span class="hljs-operator">|</span> idx_user_phone       <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> phone       <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>      <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_name        <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> name        <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>      <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> profession  <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">16</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span>            <span class="hljs-number">2</span> <span class="hljs-operator">|</span> age         <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">22</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span>            <span class="hljs-number">3</span> <span class="hljs-operator">|</span> status      <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_email            <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> email       <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br><span class="hljs-number">7</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><ol type="1"><li>当根据phone字段进行等值匹配查询时, 索引生效。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990015&#x27;</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990015&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------+----------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type  <span class="hljs-operator">|</span> possible_keys  <span class="hljs-operator">|</span> key            <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>   <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------+----------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span> idx_user_phone <span class="hljs-operator">|</span> idx_user_phone <span class="hljs-operator">|</span> <span class="hljs-number">46</span>      <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------+----------------+---------+-------+------+----------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><ol start="2" type="1"><li>当根据phone字段进行函数运算操作之后，索引失效。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> <span class="hljs-built_in">substring</span>(phone,<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;15&#x27;</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> <span class="hljs-built_in">substring</span>(phone,<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;15&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys <span class="hljs-operator">|</span> key  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ALL</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>          <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-number">24</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h4 id="字符串不加引号">字符串不加引号</h4><p><mark>字符串类型字段使用时，不加引号，索引将失效</mark>。</p><p>接下来，我们通过两组示例，来看看对于字符串类型的字段，加单引号与不加单引号的区别：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5,13&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------------------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys        <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>               <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------------------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">54</span>      <span class="hljs-operator">|</span> const,const,const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> index <span class="hljs-keyword">condition</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------------------+------+----------+-----------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys        <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>         <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">49</span>      <span class="hljs-operator">|</span> const,const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>    <span class="hljs-number">10.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> index <span class="hljs-keyword">condition</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------------+------+----------+-----------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">2</span> warnings (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990015&#x27;</span>;<br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-number">17799990015</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5,13&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990015&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------+----------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type  <span class="hljs-operator">|</span> possible_keys  <span class="hljs-operator">|</span> key            <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>   <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------+----------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span> idx_user_phone <span class="hljs-operator">|</span> idx_user_phone <span class="hljs-operator">|</span> <span class="hljs-number">46</span>      <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------+----------------+---------+-------+------+----------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-number">17799990015</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys  <span class="hljs-operator">|</span> key  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ALL</span>  <span class="hljs-operator">|</span> idx_user_phone <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-number">24</span> <span class="hljs-operator">|</span>    <span class="hljs-number">10.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">3</span> warnings (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>经过上面两组示例，我们会明显的发现，如果字符串不加单引号，对于查询结果，没什么影响，但是数据库存在隐式类型转换，索引将失效。</p><h4 id="模糊查询">模糊查询</h4><p><mark>如果仅仅是尾部模糊匹配，索引不会失效。如果是头部模糊匹配，索引失效</mark>。</p><p>接下来，我们来看一下这三条SQL语句的执行效果，查看一下其执行计划：</p><p>由于下面查询语句中，都是根据profession字段查询，符合最左前缀法则，联合索引是可以生效的，</p><p>我们主要看一下，模糊查询时，%加在关键字之前，和加在关键字之后的影响。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;软件%&#x27;</span>;<br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%工程&#x27;</span>;<br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%工%&#x27;</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5,13,21&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;软件%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------------+----------------------+---------+------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type  <span class="hljs-operator">|</span> possible_keys        <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------------+----------------------+---------+------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">range</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">47</span>      <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>    <span class="hljs-number">4</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> index <span class="hljs-keyword">condition</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------------+----------------------+---------+------+------+----------+-----------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%工程&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys <span class="hljs-operator">|</span> key  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ALL</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>          <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-number">24</span> <span class="hljs-operator">|</span>    <span class="hljs-number">11.11</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%工%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys <span class="hljs-operator">|</span> key  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ALL</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>          <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-number">24</span> <span class="hljs-operator">|</span>    <span class="hljs-number">11.11</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>经过上述的测试，我们发现，在like模糊查询中，在关键字后面加%，索引可以生效。而如果在关键字前面加了%，索引将会失效。</p><h4 id="or连接条件">or连接条件</h4><p><mark>用or分割开的条件， 如果or前的条件中的列有索引，而后面的列中没有索引，那么涉及的索引都不会被用到</mark>。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;<br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990017&#x27;</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5,13&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys <span class="hljs-operator">|</span> key  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ALL</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">PRIMARY</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-number">24</span> <span class="hljs-operator">|</span>    <span class="hljs-number">13.91</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990017&#x27;</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys  <span class="hljs-operator">|</span> key  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ALL</span>  <span class="hljs-operator">|</span> idx_user_phone <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-number">24</span> <span class="hljs-operator">|</span>    <span class="hljs-number">13.75</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>由于age没有索引，所以即使id、phone有索引，索引也会失效。所以需要针对于age也要建立索引。</p><p>然后，我们可以对age字段建立索引。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> index idx_user_age <span class="hljs-keyword">on</span> tb_user(age);<br></code></pre></td></tr></table></figure><p>建立了索引之后，我们再次执行上述的SQL语句，看看前后执行计划的变化。</p><figure class="highlight sql"><figcaption><span>&#123;5,13&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------------+----------------------+----------------------+---------+------+------+----------+------------------------------------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type        <span class="hljs-operator">|</span> possible_keys        <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra                                          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------------+----------------------+----------------------+---------+------+------+----------+------------------------------------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> index_merge <span class="hljs-operator">|</span> <span class="hljs-keyword">PRIMARY</span>,idx_user_age <span class="hljs-operator">|</span> <span class="hljs-keyword">PRIMARY</span>,idx_user_age <span class="hljs-operator">|</span> <span class="hljs-number">4</span>,<span class="hljs-number">2</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>    <span class="hljs-number">3</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">union</span>(<span class="hljs-keyword">PRIMARY</span>,idx_user_age); <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------------+----------------------+----------------------+---------+------+------+----------+------------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990017&#x27;</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------------+-----------------------------+-----------------------------+---------+------+------+----------+-------------------------------------------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type        <span class="hljs-operator">|</span> possible_keys               <span class="hljs-operator">|</span> key                         <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra                                                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------------+-----------------------------+-----------------------------+---------+------+------+----------+-------------------------------------------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> index_merge <span class="hljs-operator">|</span> idx_user_phone,idx_user_age <span class="hljs-operator">|</span> idx_user_phone,idx_user_age <span class="hljs-operator">|</span> <span class="hljs-number">46</span>,<span class="hljs-number">2</span>    <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>    <span class="hljs-number">3</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">union</span>(idx_user_phone,idx_user_age); <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------------+-----------------------------+-----------------------------+---------+------+------+----------+-------------------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure><p>最终，我们发现，当or连接的条件，左右两侧字段都有索引时，索引才会生效。</p><h4 id="数据分布影响">数据分布影响</h4><p><mark>如果MySQL评估使用索引比全表更慢，则不使用索引</mark>。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">&gt;=</span> <span class="hljs-string">&#x27;17799990005&#x27;</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">&gt;=</span> <span class="hljs-string">&#x27;17799990015&#x27;</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5,13&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">&gt;=</span> <span class="hljs-string">&#x27;17799990005&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys  <span class="hljs-operator">|</span> key  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ALL</span>  <span class="hljs-operator">|</span> idx_user_phone <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-number">24</span> <span class="hljs-operator">|</span>    <span class="hljs-number">79.17</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">&gt;=</span> <span class="hljs-string">&#x27;17799990015&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------+----------------+---------+------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type  <span class="hljs-operator">|</span> possible_keys  <span class="hljs-operator">|</span> key            <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------+----------------+---------+------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">range</span> <span class="hljs-operator">|</span> idx_user_phone <span class="hljs-operator">|</span> idx_user_phone <span class="hljs-operator">|</span> <span class="hljs-number">46</span>      <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>    <span class="hljs-number">9</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> index <span class="hljs-keyword">condition</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------+----------------+---------+------+------+----------+-----------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>经过测试我们发现，相同的SQL语句，只是传入的字段值不同，最终的执行计划也完全不一样，这是为什么呢？</p><blockquote><p>就是因为MySQL在查询时，会评估使用索引的效率与走全表扫描的效率，如果走全表扫描更快，则放弃索引，走全表扫描。 因为索引是用来索引少量数据的，如果通过索引查询返回大批量的数据，则还不如走全表扫描来的快，此时索引就会失效。</p></blockquote><p>接下来，我们再来看看 is null 与 is not null 操作是否走索引。 执行如下两条语句 ：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>;<br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5,13&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys        <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>   <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">47</span>      <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> index <span class="hljs-keyword">condition</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------+------+----------+-----------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys        <span class="hljs-operator">|</span> key  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ALL</span>  <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-number">24</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>接下来，我们做一个操作将profession字段值全部更新为null。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> tb_user <span class="hljs-keyword">set</span> profession <span class="hljs-operator">=</span> <span class="hljs-keyword">null</span>;<br></code></pre></td></tr></table></figure><p>然后，再次执行上述的两条SQL，查看SQL语句的执行计划。</p><figure class="highlight sql"><figcaption><span>&#123;5,13&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys        <span class="hljs-operator">|</span> key  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ALL</span>  <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-number">24</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+------+---------+------+------+----------+-------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------------+----------------------+---------+------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type  <span class="hljs-operator">|</span> possible_keys        <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------------+----------------------+---------+------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">range</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">47</span>      <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> index <span class="hljs-keyword">condition</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+----------------------+----------------------+---------+------+------+----------+-----------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h3 id="sql提示">SQL提示</h3><p>目前tb_user表的数据情况如下:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-----------+-------------+-----------------------+-----------------------------+------+--------+--------+---------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name      <span class="hljs-operator">|</span> phone       <span class="hljs-operator">|</span> email                 <span class="hljs-operator">|</span> profession                  <span class="hljs-operator">|</span> age  <span class="hljs-operator">|</span> gender <span class="hljs-operator">|</span> status <span class="hljs-operator">|</span> createtime          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-----------+-------------+-----------------------+-----------------------------+------+--------+--------+---------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> 吕布      <span class="hljs-operator">|</span> <span class="hljs-number">17799990000</span> <span class="hljs-operator">|</span> lvbu666<span class="hljs-variable">@163</span>.com       <span class="hljs-operator">|</span> 软件工程                    <span class="hljs-operator">|</span>   <span class="hljs-number">23</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">6</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-02</span><span class="hljs-number">-02</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> 曹操      <span class="hljs-operator">|</span> <span class="hljs-number">17799990001</span> <span class="hljs-operator">|</span> caocao666<span class="hljs-variable">@qq</span>.com      <span class="hljs-operator">|</span> 通讯工程                    <span class="hljs-operator">|</span>   <span class="hljs-number">33</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">0</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-03</span><span class="hljs-number">-05</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> 赵云      <span class="hljs-operator">|</span> <span class="hljs-number">17799990002</span> <span class="hljs-operator">|</span> <span class="hljs-number">17799990</span><span class="hljs-variable">@139</span>.com      <span class="hljs-operator">|</span> 英语                        <span class="hljs-operator">|</span>   <span class="hljs-number">34</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2002</span><span class="hljs-number">-03</span><span class="hljs-number">-02</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">4</span> <span class="hljs-operator">|</span> 孙悟空    <span class="hljs-operator">|</span> <span class="hljs-number">17799990003</span> <span class="hljs-operator">|</span> <span class="hljs-number">17799990</span><span class="hljs-variable">@sina</span>.com     <span class="hljs-operator">|</span> 工程造价                    <span class="hljs-operator">|</span>   <span class="hljs-number">54</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">0</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-07</span><span class="hljs-number">-02</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">5</span> <span class="hljs-operator">|</span> 花木兰    <span class="hljs-operator">|</span> <span class="hljs-number">17799990004</span> <span class="hljs-operator">|</span> <span class="hljs-number">19980729</span><span class="hljs-variable">@sina</span>.com     <span class="hljs-operator">|</span> 软件工程                    <span class="hljs-operator">|</span>   <span class="hljs-number">23</span> <span class="hljs-operator">|</span> <span class="hljs-number">2</span>      <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-04</span><span class="hljs-number">-22</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">6</span> <span class="hljs-operator">|</span> 大乔      <span class="hljs-operator">|</span> <span class="hljs-number">17799990005</span> <span class="hljs-operator">|</span> daqiao666<span class="hljs-variable">@sina</span>.com    <span class="hljs-operator">|</span> 舞蹈                        <span class="hljs-operator">|</span>   <span class="hljs-number">22</span> <span class="hljs-operator">|</span> <span class="hljs-number">2</span>      <span class="hljs-operator">|</span> <span class="hljs-number">0</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-02</span><span class="hljs-number">-07</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">7</span> <span class="hljs-operator">|</span> 露娜      <span class="hljs-operator">|</span> <span class="hljs-number">17799990006</span> <span class="hljs-operator">|</span> luna_love<span class="hljs-variable">@sina</span>.com    <span class="hljs-operator">|</span> 应用数学                    <span class="hljs-operator">|</span>   <span class="hljs-number">24</span> <span class="hljs-operator">|</span> <span class="hljs-number">2</span>      <span class="hljs-operator">|</span> <span class="hljs-number">0</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-02</span><span class="hljs-number">-08</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">8</span> <span class="hljs-operator">|</span> 程咬金    <span class="hljs-operator">|</span> <span class="hljs-number">17799990007</span> <span class="hljs-operator">|</span> chengyaojin<span class="hljs-variable">@163</span>.com   <span class="hljs-operator">|</span> 化工                        <span class="hljs-operator">|</span>   <span class="hljs-number">38</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">5</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-05</span><span class="hljs-number">-23</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">9</span> <span class="hljs-operator">|</span> 项羽      <span class="hljs-operator">|</span> <span class="hljs-number">17799990008</span> <span class="hljs-operator">|</span> xiaoyu666<span class="hljs-variable">@qq</span>.com      <span class="hljs-operator">|</span> 金属材料                    <span class="hljs-operator">|</span>   <span class="hljs-number">43</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">0</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-09</span><span class="hljs-number">-18</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">10</span> <span class="hljs-operator">|</span> 白起      <span class="hljs-operator">|</span> <span class="hljs-number">17799990009</span> <span class="hljs-operator">|</span> baiqi666<span class="hljs-variable">@sina</span>.com     <span class="hljs-operator">|</span> 机械工程及其自动化          <span class="hljs-operator">|</span>   <span class="hljs-number">27</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-08</span><span class="hljs-number">-16</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">11</span> <span class="hljs-operator">|</span> 韩信      <span class="hljs-operator">|</span> <span class="hljs-number">17799990010</span> <span class="hljs-operator">|</span> hanxin520<span class="hljs-variable">@163</span>.com     <span class="hljs-operator">|</span> 无机非金属材料工程          <span class="hljs-operator">|</span>   <span class="hljs-number">27</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">0</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-06</span><span class="hljs-number">-12</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">12</span> <span class="hljs-operator">|</span> 荆轲      <span class="hljs-operator">|</span> <span class="hljs-number">17799990011</span> <span class="hljs-operator">|</span> jingke123<span class="hljs-variable">@163</span>.com     <span class="hljs-operator">|</span> 会计                        <span class="hljs-operator">|</span>   <span class="hljs-number">29</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">0</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-05</span><span class="hljs-number">-11</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">13</span> <span class="hljs-operator">|</span> 兰陵王    <span class="hljs-operator">|</span> <span class="hljs-number">17799990012</span> <span class="hljs-operator">|</span> lanlinwang666<span class="hljs-variable">@126</span>.com <span class="hljs-operator">|</span> 工程造价                    <span class="hljs-operator">|</span>   <span class="hljs-number">44</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-04</span><span class="hljs-number">-09</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">14</span> <span class="hljs-operator">|</span> 狂铁      <span class="hljs-operator">|</span> <span class="hljs-number">17799990013</span> <span class="hljs-operator">|</span> kuangtie<span class="hljs-variable">@sina</span>.com     <span class="hljs-operator">|</span> 应用数学                    <span class="hljs-operator">|</span>   <span class="hljs-number">43</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-04</span><span class="hljs-number">-10</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">15</span> <span class="hljs-operator">|</span> 貂蝉      <span class="hljs-operator">|</span> <span class="hljs-number">17799990014</span> <span class="hljs-operator">|</span> <span class="hljs-number">84958948374</span><span class="hljs-variable">@qq</span>.com    <span class="hljs-operator">|</span> 软件工程                    <span class="hljs-operator">|</span>   <span class="hljs-number">40</span> <span class="hljs-operator">|</span> <span class="hljs-number">2</span>      <span class="hljs-operator">|</span> <span class="hljs-number">3</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-02</span><span class="hljs-number">-12</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">16</span> <span class="hljs-operator">|</span> 妲己      <span class="hljs-operator">|</span> <span class="hljs-number">17799990015</span> <span class="hljs-operator">|</span> <span class="hljs-number">2783238293</span><span class="hljs-variable">@qq</span>.com     <span class="hljs-operator">|</span> 软件工程                    <span class="hljs-operator">|</span>   <span class="hljs-number">31</span> <span class="hljs-operator">|</span> <span class="hljs-number">2</span>      <span class="hljs-operator">|</span> <span class="hljs-number">0</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-01</span><span class="hljs-number">-30</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">17</span> <span class="hljs-operator">|</span> 芈月      <span class="hljs-operator">|</span> <span class="hljs-number">17799990016</span> <span class="hljs-operator">|</span> xiaomin2001<span class="hljs-variable">@sina</span>.com  <span class="hljs-operator">|</span> 工业经济                    <span class="hljs-operator">|</span>   <span class="hljs-number">35</span> <span class="hljs-operator">|</span> <span class="hljs-number">2</span>      <span class="hljs-operator">|</span> <span class="hljs-number">0</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2000</span><span class="hljs-number">-05</span><span class="hljs-number">-03</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">18</span> <span class="hljs-operator">|</span> 嬴政      <span class="hljs-operator">|</span> <span class="hljs-number">17799990017</span> <span class="hljs-operator">|</span> <span class="hljs-number">8839434342</span><span class="hljs-variable">@qq</span>.com     <span class="hljs-operator">|</span> 化工                        <span class="hljs-operator">|</span>   <span class="hljs-number">38</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-08</span><span class="hljs-number">-08</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">19</span> <span class="hljs-operator">|</span> 狄仁杰    <span class="hljs-operator">|</span> <span class="hljs-number">17799990018</span> <span class="hljs-operator">|</span> jujiamlm8166<span class="hljs-variable">@163</span>.com  <span class="hljs-operator">|</span> 国际贸易                    <span class="hljs-operator">|</span>   <span class="hljs-number">30</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">0</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2007</span><span class="hljs-number">-03</span><span class="hljs-number">-12</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">20</span> <span class="hljs-operator">|</span> 安琪拉    <span class="hljs-operator">|</span> <span class="hljs-number">17799990019</span> <span class="hljs-operator">|</span> jdodm1h<span class="hljs-variable">@126</span>.com       <span class="hljs-operator">|</span> 城市规划                    <span class="hljs-operator">|</span>   <span class="hljs-number">51</span> <span class="hljs-operator">|</span> <span class="hljs-number">2</span>      <span class="hljs-operator">|</span> <span class="hljs-number">0</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">21</span> <span class="hljs-operator">|</span> 典韦      <span class="hljs-operator">|</span> <span class="hljs-number">17799990020</span> <span class="hljs-operator">|</span> ycaunanjian<span class="hljs-variable">@163</span>.com   <span class="hljs-operator">|</span> 城市规划                    <span class="hljs-operator">|</span>   <span class="hljs-number">52</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2000</span><span class="hljs-number">-04</span><span class="hljs-number">-12</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">22</span> <span class="hljs-operator">|</span> 廉颇      <span class="hljs-operator">|</span> <span class="hljs-number">17799990021</span> <span class="hljs-operator">|</span> lianpo321<span class="hljs-variable">@126</span>.com     <span class="hljs-operator">|</span> 土木工程                    <span class="hljs-operator">|</span>   <span class="hljs-number">19</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">3</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2002</span><span class="hljs-number">-07</span><span class="hljs-number">-18</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">23</span> <span class="hljs-operator">|</span> 后羿      <span class="hljs-operator">|</span> <span class="hljs-number">17799990022</span> <span class="hljs-operator">|</span> altycj2000<span class="hljs-variable">@139</span>.com    <span class="hljs-operator">|</span> 城市园林                    <span class="hljs-operator">|</span>   <span class="hljs-number">20</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">0</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2002</span><span class="hljs-number">-03</span><span class="hljs-number">-10</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">24</span> <span class="hljs-operator">|</span> 姜子牙    <span class="hljs-operator">|</span> <span class="hljs-number">17799990023</span> <span class="hljs-operator">|</span> <span class="hljs-number">37483844</span><span class="hljs-variable">@qq</span>.com       <span class="hljs-operator">|</span> 工程造价                    <span class="hljs-operator">|</span>   <span class="hljs-number">29</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">4</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2003</span><span class="hljs-number">-05</span><span class="hljs-number">-26</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-----------+-------------+-----------------------+-----------------------------+------+--------+--------+---------------------+</span><br><span class="hljs-number">24</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>索引情况如下:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> tb_user;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">Table</span>   <span class="hljs-operator">|</span> Non_unique <span class="hljs-operator">|</span> Key_name             <span class="hljs-operator">|</span> Seq_in_index <span class="hljs-operator">|</span> Column_name <span class="hljs-operator">|</span> <span class="hljs-keyword">Collation</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Cardinality</span> <span class="hljs-operator">|</span> Sub_part <span class="hljs-operator">|</span> Packed <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Index_type <span class="hljs-operator">|</span> Comment <span class="hljs-operator">|</span> Index_comment <span class="hljs-operator">|</span> Visible <span class="hljs-operator">|</span> Expression <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">0</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">PRIMARY</span>              <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> id          <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">23</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>      <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">0</span> <span class="hljs-operator">|</span> idx_user_phone       <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> phone       <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>      <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_name        <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> name        <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>      <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> profession  <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">16</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span>            <span class="hljs-number">2</span> <span class="hljs-operator">|</span> age         <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">22</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span>            <span class="hljs-number">3</span> <span class="hljs-operator">|</span> status      <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_email            <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> email       <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_age         <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> age         <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">19</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br><span class="hljs-number">8</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><ol type="1"><li>执行SQL : explain select * from tb_user where profession = '软件工程';</li></ol><figure class="highlight sql"><figcaption><span>&#123;5&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys        <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>   <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">47</span>      <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span>    <span class="hljs-number">4</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------+------+----------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><ol start="2" type="1"><li>执行SQL，创建profession的单列索引：create index idx_user_pro on tb_user(profession);</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> index idx_user_pro <span class="hljs-keyword">on</span> tb_user(profession);<br></code></pre></td></tr></table></figure><ol start="3" type="1"><li>创建单列索引后，再次执行1中的SQL语句，查看执行计划，看看到底走哪个索引。</li></ol><figure class="highlight sql"><figcaption><span>&#123;5&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+-----------------------------------+----------------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys                     <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>   <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+-----------------------------------+----------------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_pro_age_sta,idx_user_pro <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">47</span>      <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span>    <span class="hljs-number">4</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+-----------------------------------+----------------------+---------+-------+------+----------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>测试结果，我们可以看到，possible_keys中 idx_user_pro_age_sta,idx_user_pro 这两个索引都可能用到，最终MySQL选择了idx_user_pro_age_sta索引。这是MySQL自动选择的结果。</p><p>那么，我们能不能在查询的时候，自己来指定使用哪个索引呢？ 答案是肯定的，此时就可以借助于MySQL的SQL提示来完成。 接下来，介绍一下SQL提示。</p><p>SQL提示，是优化数据库的一个重要手段，简单来说，就是在SQL语句中加入一些人为的提示来达到优化操作的目的。</p><ol type="1"><li><code>use index</code>： 建议MySQL使用哪一个索引完成此次查询（仅仅是建议，mysql内部还会再次进行评估）。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user use index(idx_user_pro) <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure><ol start="2" type="1"><li><code>ignore index</code> ： 忽略指定的索引。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user ignore index(idx_user_pro) <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure><ol start="3" type="1"><li><code>force index</code> ： 强制使用索引。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user force index(idx_user_pro) <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure><p>示例演示：</p><p>A. use index</p><figure class="highlight sql"><figcaption><span>&#123;5&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user use index(idx_user_pro) <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+--------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys <span class="hljs-operator">|</span> key          <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>   <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+--------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_pro  <span class="hljs-operator">|</span> idx_user_pro <span class="hljs-operator">|</span> <span class="hljs-number">47</span>      <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span>    <span class="hljs-number">4</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+--------------+---------+-------+------+----------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>B. ignore index</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user ignore index(idx_user_pro) <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys        <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>   <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">47</span>      <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span>    <span class="hljs-number">4</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+----------------------+----------------------+---------+-------+------+----------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>C. force index</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user force index(idx_user_pro) <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+--------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys <span class="hljs-operator">|</span> key          <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>   <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+--------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_pro  <span class="hljs-operator">|</span> idx_user_pro <span class="hljs-operator">|</span> <span class="hljs-number">47</span>      <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span>    <span class="hljs-number">4</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+--------------+---------+-------+------+----------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h3 id="覆盖索引">覆盖索引</h3><p>尽量使用覆盖索引，减少select *。 那么什么是覆盖索引呢？ 覆盖索引是指<mark>查询使用了索引，并且需要返回的列，在该索引中已经全部能够找到</mark> 。</p><p>接下来，我们来看一组SQL的执行计划，看看执行计划的差别，然后再来具体做一个解析。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> id, profession <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span> ;<br>explain <span class="hljs-keyword">select</span> id,profession,age, status <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span> ;<br>explain <span class="hljs-keyword">select</span> id,profession,age, status, name <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span> ;<br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure><p>把上述的 idx_user_age, idx_email 这两个之前测试使用过的索引直接删除。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> index idx_user_age <span class="hljs-keyword">on</span> tb_user;<br><span class="hljs-keyword">drop</span> index idx_email <span class="hljs-keyword">on</span> tb_user;<br></code></pre></td></tr></table></figure><ul><li>查看上述SQL执行计划</li></ul><figure class="highlight sql"><figcaption><span>&#123;5,13,21,29&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> id, profession <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span> ;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+-----------------------------------+----------------------+---------+-------------------+------+----------+--------------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys                     <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>               <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra                    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+-----------------------------------+----------------------+---------+-------------------+------+----------+--------------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_pro_age_sta,idx_user_pro <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">54</span>      <span class="hljs-operator">|</span> const,const,const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span>; <span class="hljs-keyword">Using</span> index <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+-----------------------------------+----------------------+---------+-------------------+------+----------+--------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> id,profession,age, status <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span> ;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+-----------------------------------+----------------------+---------+-------------------+------+----------+--------------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys                     <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>               <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra                    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+-----------------------------------+----------------------+---------+-------------------+------+----------+--------------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_pro_age_sta,idx_user_pro <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">54</span>      <span class="hljs-operator">|</span> const,const,const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span>; <span class="hljs-keyword">Using</span> index <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+-----------------------------------+----------------------+---------+-------------------+------+----------+--------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> id,profession,age, status, name <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span> ;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+-----------------------------------+----------------------+---------+-------------------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys                     <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>               <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+-----------------------------------+----------------------+---------+-------------------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_pro_age_sta,idx_user_pro <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">54</span>      <span class="hljs-operator">|</span> const,const,const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> index <span class="hljs-keyword">condition</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+-----------------------------------+----------------------+---------+-------------------+------+----------+-----------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+-----------------------------------+----------------------+---------+-------------------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys                     <span class="hljs-operator">|</span> key                  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>               <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+-----------------------------------+----------------------+---------+-------------------+------+----------+-----------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_pro_age_sta,idx_user_pro <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span> <span class="hljs-number">54</span>      <span class="hljs-operator">|</span> const,const,const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> index <span class="hljs-keyword">condition</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+-----------------------------------+----------------------+---------+-------------------+------+----------+-----------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>从上述的执行计划我们可以看到，这四条SQL语句的执行计划前面所有的指标都是一样的，看不出来差异。但是此时，我们主要关注的是后面的Extra(额外的，补充的)，前面两条SQL的结果为 Using where; UsingIndex ; 而后面两条SQL的结果为: Using index condition 。</p><table><thead><tr class="header"><th>Extra</th><th>含义</th></tr></thead><tbody><tr class="odd"><td>Using where; Using Index</td><td>查找使用了索引，但是需要的数据都在索引列中能找到，所以不需要回表查询数据</td></tr><tr class="even"><td>Using index condition</td><td>查找使用了索引，但是需要回表查询数据</td></tr></tbody></table><p>因为，在tb_user表中有一个联合索引 idx_user_pro_age_sta，该索引关联了三个字段profession、age、status，而这个索引也是一个二级索引，所以叶子节点下面挂的是这一行的主键id。 所以当我们查询返回的数据在 id、profession、age、status 之中，则直接走二级索引直接返回数据了。 如果超出这个范围，就需要拿到主键id，再去扫描聚集索引，再获取额外的数据了，这个过程就是回表。 而我们如果一直使用select * 查询返回所有字段值，很容易就会造成回表查询（除非是根据主键查询，此时只会扫描聚集索引）。</p><p>为了大家更清楚的理解，什么是覆盖索引，什么是回表查询，我们一起再来看下面的这组SQL的执行过程。</p><p>A. 表结构及索引示意图:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220924/image.klqugp2zs1o.webp" alt="image" style="zoom:80%"></p><p>id是主键，是一个聚集索引。 name字段建立了普通索引，是一个二级索引（辅助索引）。</p><p>B. 执行SQL : select * from tb_user where id = 2;</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220924/image.1ltqq3m3ctds.webp" alt="image" style="zoom:80%"></p><p>根据id查询，直接走聚集索引查询，一次索引扫描，直接返回数据，性能高。</p><p>C. 执行SQL：selet id,name from tb_user where name = 'Arm';</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220924/image.1ghxn35m2hxc.webp" alt="image" style="zoom:80%"></p><p>虽然是根据name字段查询，查询二级索引，但是由于查询返回在字段为 id，name，在name的二级索引中，这两个值都是可以直接获取到的，因为覆盖索引，所以不需要回表查询，性能高。</p><p>D. 执行SQL：selet id,name,gender from tb_user where name = 'Arm';</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220924/image.4o7ct08gz180.webp" alt="image" style="zoom:80%"></p><p>由于在name的二级索引中，不包含gender，所以，需要两次索引扫描，也就是需要回表查询，性能相对较差一点。</p><blockquote><p>思考题：</p><p>一张表, 有四个字段(id, username, password, status), 由于数据量大, 需要对以下SQL语句进行优化, 该如何进行才是最优方案:</p><p><code>select id,username,password from tb_user where username = 'itcast';</code></p><p>答案: 针对于 username, password建立联合索引, sql为: <code>create index idx_user_name_pass on tb_user(username,password);</code></p><p>这样可以避免上述的SQL语句，在查询的过程中，出现回表查询。</p></blockquote><h3 id="前缀索引">前缀索引</h3><p>当字段类型为字符串（varchar，text，longtext等）时，有时候需要索引很长的字符串，这会让索引变得很大，查询时，浪费大量的磁盘IO， 影响查询效率。此时可以只将字符串的一部分前缀，建立索引，这样可以大大节约索引空间，从而提高索引效率。</p><ol type="1"><li>语法</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> index idx_xxxx <span class="hljs-keyword">on</span> table_name(<span class="hljs-keyword">column</span>(n));<br></code></pre></td></tr></table></figure><p>示例:</p><p>为tb_user表的email字段，建立长度为5的前缀索引。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> index idx_email_5 <span class="hljs-keyword">on</span> tb_user(email(<span class="hljs-number">5</span>));<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;12&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> tb_user;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">Table</span>   <span class="hljs-operator">|</span> Non_unique <span class="hljs-operator">|</span> Key_name             <span class="hljs-operator">|</span> Seq_in_index <span class="hljs-operator">|</span> Column_name <span class="hljs-operator">|</span> <span class="hljs-keyword">Collation</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Cardinality</span> <span class="hljs-operator">|</span> Sub_part <span class="hljs-operator">|</span> Packed <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Index_type <span class="hljs-operator">|</span> Comment <span class="hljs-operator">|</span> Index_comment <span class="hljs-operator">|</span> Visible <span class="hljs-operator">|</span> Expression <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">0</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">PRIMARY</span>              <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> id          <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">23</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>      <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">0</span> <span class="hljs-operator">|</span> idx_user_phone       <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> phone       <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>      <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_name        <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> name        <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>      <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> profession  <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">16</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span>            <span class="hljs-number">2</span> <span class="hljs-operator">|</span> age         <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">22</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span>            <span class="hljs-number">3</span> <span class="hljs-operator">|</span> status      <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_pro         <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> profession  <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">16</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_email_5          <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> email       <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">23</span> <span class="hljs-operator">|</span>        <span class="hljs-number">5</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br><span class="hljs-number">8</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.03</span> sec)<br></code></pre></td></tr></table></figure><ol start="2" type="1"><li>前缀长度</li></ol><p>可以根据索引的选择性来决定，而选择性是指不重复的索引值（基数）和数据表的记录总数的比值，索引选择性越高则查询效率越高， 唯一索引的选择性是1，这是最好的索引选择性，性能也是最好的。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> email) <span class="hljs-operator">/</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> tb_user;<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> <span class="hljs-built_in">substring</span>(email,<span class="hljs-number">1</span>,<span class="hljs-number">5</span>)) <span class="hljs-operator">/</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> tb_user;<br></code></pre></td></tr></table></figure><ol start="3" type="1"><li>前缀索引的查询流程</li></ol><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220925/image.6pmpxlo2yiw0.webp" alt="image" style="zoom:80%"></p><h3 id="单列索引与联合索引">单列索引与联合索引</h3><p>单列索引：即一个索引只包含单个列。</p><p>联合索引：即一个索引包含了多个列。</p><p>我们先来看看 tb_user 表中目前的索引情况:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> tb_user;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">Table</span>   <span class="hljs-operator">|</span> Non_unique <span class="hljs-operator">|</span> Key_name             <span class="hljs-operator">|</span> Seq_in_index <span class="hljs-operator">|</span> Column_name <span class="hljs-operator">|</span> <span class="hljs-keyword">Collation</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Cardinality</span> <span class="hljs-operator">|</span> Sub_part <span class="hljs-operator">|</span> Packed <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Index_type <span class="hljs-operator">|</span> Comment <span class="hljs-operator">|</span> Index_comment <span class="hljs-operator">|</span> Visible <span class="hljs-operator">|</span> Expression <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">0</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">PRIMARY</span>              <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> id          <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">23</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>      <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">0</span> <span class="hljs-operator">|</span> idx_user_phone       <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> phone       <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>      <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_name        <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> name        <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>      <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> profession  <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">16</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span>            <span class="hljs-number">2</span> <span class="hljs-operator">|</span> age         <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">22</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_pro_age_sta <span class="hljs-operator">|</span>            <span class="hljs-number">3</span> <span class="hljs-operator">|</span> status      <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">24</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_user_pro         <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> profession  <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">16</span> <span class="hljs-operator">|</span>     <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span>          <span class="hljs-number">1</span> <span class="hljs-operator">|</span> idx_email_5          <span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span> email       <span class="hljs-operator">|</span> A         <span class="hljs-operator">|</span>          <span class="hljs-number">23</span> <span class="hljs-operator">|</span>        <span class="hljs-number">5</span> <span class="hljs-operator">|</span>   <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span> BTREE      <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>               <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br><span class="hljs-number">8</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>在查询出来的索引中，既有单列索引，又有联合索引。</p><p>接下来，我们来执行一条SQL语句，看看其执行计划：</p><figure class="highlight sql"><figcaption><span>&#123;1,13&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990010&#x27;</span> <span class="hljs-keyword">and</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;韩信&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------+-------------+-------------------+-----------------------------+------+--------+--------+---------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name   <span class="hljs-operator">|</span> phone       <span class="hljs-operator">|</span> email             <span class="hljs-operator">|</span> profession                  <span class="hljs-operator">|</span> age  <span class="hljs-operator">|</span> gender <span class="hljs-operator">|</span> status <span class="hljs-operator">|</span> createtime          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------+-------------+-------------------+-----------------------------+------+--------+--------+---------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">11</span> <span class="hljs-operator">|</span> 韩信   <span class="hljs-operator">|</span> <span class="hljs-number">17799990010</span> <span class="hljs-operator">|</span> hanxin520<span class="hljs-variable">@163</span>.com <span class="hljs-operator">|</span> 无机非金属材料工程          <span class="hljs-operator">|</span>   <span class="hljs-number">27</span> <span class="hljs-operator">|</span> <span class="hljs-number">1</span>      <span class="hljs-operator">|</span> <span class="hljs-number">0</span>      <span class="hljs-operator">|</span> <span class="hljs-number">2001</span><span class="hljs-number">-06</span><span class="hljs-number">-12</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------+-------------+-------------------+-----------------------------+------+--------+--------+---------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990010&#x27;</span> <span class="hljs-keyword">and</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;韩信&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+------------------------------+----------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type  <span class="hljs-operator">|</span> possible_keys                <span class="hljs-operator">|</span> key            <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>   <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+------------------------------+----------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span> idx_user_phone,idx_user_name <span class="hljs-operator">|</span> idx_user_phone <span class="hljs-operator">|</span> <span class="hljs-number">46</span>      <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+------------------------------+----------------+---------+-------+------+----------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>通过上述执行计划我们可以看出来，在and连接的两个字段 phone、name上都是有单列索引的，但是最终mysql只会选择一个索引，也就是说，只能走一个字段的索引，此时是会回表查询的。</p><p>紧接着，我们再来创建一个phone和name字段的联合索引来查询一下执行计划。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">unique</span> index idx_user_phone_name <span class="hljs-keyword">on</span> tb_user(phone,name);<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990010&#x27;</span> <span class="hljs-keyword">and</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;韩信&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+--------------------------------------------------+----------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type  <span class="hljs-operator">|</span> possible_keys                                    <span class="hljs-operator">|</span> key            <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>   <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+--------------------------------------------------+----------------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span> idx_user_phone,idx_user_phone_name,idx_user_name <span class="hljs-operator">|</span> idx_user_phone <span class="hljs-operator">|</span> <span class="hljs-number">46</span>      <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+-------+--------------------------------------------------+----------------+---------+-------+------+----------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><figcaption><span>&#123;5&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user use index(idx_user_name) <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990010&#x27;</span> <span class="hljs-keyword">and</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;韩信&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+---------------+---------+-------+------+----------+-------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>   <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys <span class="hljs-operator">|</span> key           <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>   <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+---------------+---------+-------+------+----------+-------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> tb_user <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> idx_user_name <span class="hljs-operator">|</span> idx_user_name <span class="hljs-operator">|</span> <span class="hljs-number">202</span>     <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>     <span class="hljs-number">5.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+---------+------------+------+---------------+---------------+---------+-------+------+----------+-------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>此时，查询时，就走了联合索引，而在联合索引中包含 phone、name的信息，在叶子节点下挂的是对应的主键id，所以查询是无需回表查询的。</p><blockquote><p>在业务场景中，如果存在多个查询条件，考虑针对于查询字段建立索引时，建议建立联合索引，而非单列索引。</p></blockquote><p>如果查询使用的是联合索引，具体的结构示意图如下：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220925/image.137p0h70od40.webp" alt="image" style="zoom:80%"></p><h2 id="索引设计原则">索引设计原则</h2><ol type="1"><li>针对于数据量较大，且查询比较频繁的表建立索引。</li><li>针对于常作为查询条件（where）、排序（order by）、分组（group by）操作的字段建立索引。</li><li>尽量选择区分度高的列作为索引，尽量建立唯一索引，区分度越高，使用索引的效率越高。</li><li>如果是字符串类型的字段，字段的长度较长，可以针对于字段的特点，建立前缀索引。</li><li>尽量使用联合索引，减少单列索引，查询时，联合索引很多时候可以覆盖索引，节省存储空间，避免回表，提高查询效率。</li><li>要控制索引的数量，索引并不是多多益善，索引越多，维护索引结构的代价也就越大，会影响增删改的效率。</li><li>如果索引列不能存储NULL值，请在创建表时使用NOT NULL约束它。当优化器知道每列是否包含NULL值时，它可以更好地确定哪个索引最有效地用于查询。</li></ol></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://Unicorn-acc.github.io">xustudyxu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://frxcat.fun/">https://frxcat.fun/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">转载自xustudyxu</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Mysql/">Mysql</a></div><div class="post_share"><div class="social-share" data-image="https://w.wallhaven.cc/full/1p/wallhaven-1pjml1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/8298.html"><img class="prev-cover" src="https://w.wallhaven.cc/full/x6/wallhaven-x619o3.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MySQL_15进阶_管理工具</div></div></a></div><div class="next-post pull-right"><a href="/posts/55286.html"><img class="next-cover" src="https://w.wallhaven.cc/full/p9/wallhaven-p9273e.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MySQL_11进阶_SQL优化</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/11178.html" title="MySQL_04基础_多表查询"><img class="cover" src="https://w.wallhaven.cc/full/kx/wallhaven-kx3p1q.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-01</div><div class="title">MySQL_04基础_多表查询</div></div></a></div><div><a href="/posts/52716.html" title="MySQL_02基础_CRUD"><img class="cover" src="https://w.wallhaven.cc/full/vq/wallhaven-vqmyq3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-01</div><div class="title">MySQL_02基础_CRUD</div></div></a></div><div><a href="/posts/57704.html" title="MySQL_05基础_约束与自增长"><img class="cover" src="https://w.wallhaven.cc/full/d6/wallhaven-d65mzm.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-01</div><div class="title">MySQL_05基础_约束与自增长</div></div></a></div><div><a href="/posts/9826.html" title="MySQL_03基础_函数"><img class="cover" src="https://w.wallhaven.cc/full/vq/wallhaven-vqmyq3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-01</div><div class="title">MySQL_03基础_函数</div></div></a></div><div><a href="/posts/20424.html" title="MySQL_01_简介"><img class="cover" src="https://w.wallhaven.cc/full/vq/wallhaven-vqmyq3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-01</div><div class="title">MySQL_01_简介</div></div></a></div><div><a href="/posts/39434.html" title="MySQL_06基础_索引与事务"><img class="cover" src="https://w.wallhaven.cc/full/kx/wallhaven-kx3p1q.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-01</div><div class="title">MySQL_06基础_索引与事务</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#mysql-%E7%B4%A2%E5%BC%95"><span class="toc-text">MySQL 索引</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8linux%E7%B3%BB%E7%BB%9F%E4%B8%8A%E5%AE%89%E8%A3%85mysql8.0"><span class="toc-text">在Linux系统上安装MySQL8.0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%BB%8B%E7%BB%8D"><span class="toc-text">索引介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84"><span class="toc-text">索引结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E5%8F%89%E6%A0%91"><span class="toc-text">二叉树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b-tree"><span class="toc-text">B-Tree</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#btree"><span class="toc-text">B+Tree</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hash"><span class="toc-text">Hash</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-text">索引的分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E8%AF%AD%E6%B3%95"><span class="toc-text">索引语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sql-%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-text">SQL 性能分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sql-%E6%89%A7%E8%A1%8C%E9%A2%91%E7%8E%87"><span class="toc-text">SQL 执行频率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-text">慢查询日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#profile%E8%AF%A6%E6%83%85"><span class="toc-text">profile详情</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#explain"><span class="toc-text">explain</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%BD%BF%E7%94%A8"><span class="toc-text">索引使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%B4%A2%E5%BC%95%E6%95%88%E7%8E%87"><span class="toc-text">验证索引效率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80%E6%B3%95%E5%88%99"><span class="toc-text">最左前缀法则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2"><span class="toc-text">范围查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E6%83%85%E5%86%B5"><span class="toc-text">索引失效情况</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%88%97%E8%BF%90%E7%AE%97"><span class="toc-text">索引列运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8D%E5%8A%A0%E5%BC%95%E5%8F%B7"><span class="toc-text">字符串不加引号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-text">模糊查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#or%E8%BF%9E%E6%8E%A5%E6%9D%A1%E4%BB%B6"><span class="toc-text">or连接条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E5%B8%83%E5%BD%B1%E5%93%8D"><span class="toc-text">数据分布影响</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sql%E6%8F%90%E7%A4%BA"><span class="toc-text">SQL提示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95"><span class="toc-text">覆盖索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95"><span class="toc-text">前缀索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E5%88%97%E7%B4%A2%E5%BC%95%E4%B8%8E%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95"><span class="toc-text">单列索引与联合索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-text">索引设计原则</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By Miraclo</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">人只有在走上坡路的时候才会累和迷茫。</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if(window.MathJax)MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset();else{window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"ams"},chtml:{scale:1.1},options:{renderActions:{findScript:[10,t=>{for(const n of document.querySelectorAll('script[type^="math/tex"]')){var e=!!n.type.match(/; *mode=display/),e=new t.options.MathItem(n.textContent,t.inputJax[0],e),a=document.createTextNode("");n.parentNode.replaceChild(a,n),e.start={node:a,delim:"",n:0},e.end={node:a,delim:"",n:0},t.math.push(e)}},""],insertScript:[200,()=>{document.querySelectorAll("mjx-container").forEach(t=>{t.hasAttribute("display")?btf.wrap(t,"div",{class:"mathjax-overflow"}):btf.wrap(t,"span",{class:"mathjax-overflow"})})},"",!1]}}};const a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js",a.id="MathJax-script",a.async=!0,document.head.appendChild(a)}</script></div><link rel="stylesheet" href="/css/Lete.css"><script src="/js/custom.js"></script><script src="/js/mouth.js"></script><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div class="js-pjax"><script async>for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration","1s"),arr[i].setAttribute("data-wow-delay","1ms"),arr[i].setAttribute("data-wow-offset","100"),arr[i].setAttribute("data-wow-iteration","1")</script><script async>for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script></body></html>